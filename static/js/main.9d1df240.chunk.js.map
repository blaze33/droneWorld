{"version":3,"sources":["modules/index.js","textures/Rock_08_UV_H_CM_1.jpg","textures/Rock_08_UV_H_CM_1_normal.jpg","textures/GrassGreenTexture0003.jpg","textures/GrassGreenTexture0003_normal.jpg","textures/Water_1_M_Normal.jpg","textures/Water_2_M_Normal.jpg","terrain/terrain.worker.js","terrain/shaders/meshphysical_vert.glsl","terrain/shaders/meshphysical_frag.glsl","terrain/shaders/meshstandard_vert.glsl","terrain/shaders/meshstandard_frag.glsl","ocean/water_frag.glsl","ocean/water_vert.glsl","ocean/underwater_frag.glsl","ocean/underwater_vert.glsl","textures/lensflare/lensflare3.png","textures/Explosion_002_Tile_8x8_256x256.png","textures/smokeparticle.png","textures/spark.png","textures/bullet.png","sound/impact1.ogg","sound/impact2.ogg","sound/impact3.ogg","sound/impact4.ogg","sound/gatling.ogg","sound/missile.ogg","sound/explosion1.ogg","sound/explosion2.ogg","events/index.js","modules/Sky.js","lights.js","sky/index.js","terrain/shaders/material.js","terrain/shaders/materialBasic.js","terrain/index.js","loops/tileBuilder.js","postprocessing/BokehShader2.js","postprocessing/CopyShader.js","postprocessing/Pass.js","postprocessing/ShaderPass.js","postprocessing/MaskPass.js","postprocessing/EffectComposer.js","postprocessing/RenderPass.js","postprocessing/dof.js","modules/Lensflare.js","postprocessing/lensflares.js","postprocessing/MotionBlur.js","utils/index.js","hud/index.js","hud/crosshair.js","particles/index.js","drones/loader.js","drones/init.js","drones/index.js","modules/FlyControls.js","controls/index.js","utils/isMobile.js","sound/index.js","ocean/index.js","index.js","modules/WindowResize.js"],"names":["global","__webpack_require__","d","__webpack_exports__","GLTFLoader","EffectComposer","ShaderPass","RenderPass","GlitchPass","Reflector","Water","three__WEBPACK_IMPORTED_MODULE_0__","THREE","require","Sky","Octree","BlendShader","CopyShader","WaterRefractionShader","BokehShader","SavePass","Lensflare","LensflareElement","Refractor","SimplifyModifier","MarchingCubes","module","exports","p","Worker","PubSub","shader","SkyShader","material","ShaderMaterial","fragmentShader","vertexShader","uniforms","UniformsUtils","clone","side","BackSide","Mesh","call","this","SphereBufferGeometry","prototype","Object","create","luminance","value","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","Vector3","dirLight","DirectionalLight","window","hemishpereLight","HemisphereLight","position","set","up","needsUpdate","ambientLight","AmbientLight","updateDirLightPosition","copy","normalize","multiplyScalar","add","drone","initSky","scene","gui","sky","scale","setScalar","skyGeo","SphereGeometry","i","faces","length","face","temp","a","c","MeshBasicMaterial","opacity","skyDome","effectController","inclination","azimuth","sun","guiChanged","theta","Math","PI","phi","x","distance","cos","z","sin","y","folder","addFolder","onChange","textureLoader","TextureLoader","setCrossOrigin","rockTexture","load","rockTextureNormal","grassTexture","grassTextureNormal","wrapS","wrapT","RepeatWrapping","offset","repeat","lon","zoom","materialBasic","options","objectSpread","roughness","metalness","UniformsLib","common","lights","envmap","normalmap","fog","defines","STANDARD","USE_MAP","USE_NORMALMAP","extensions","derivatives","wireframe","map","normalMap","isShaderMaterial","isMeshStandardMaterial","uvTransform","Matrix3","MaterialBasic","chamonix","pow","lat","log","tan","lat2tile","setTilePosition","geometry","key","zxyijs","split","parseInt","size","offsetAtZ","clearCoat","clearCoatRoughness","specularMap","aomap","lightmap","emissivemap","bumpmap","displacementmap","roughnessmap","metalnessmap","gradientmap","points","PHYSICAL","USE_ENVMAP","ENVMAP_TYPE_CUBE","ENVMAP_BLENDING_MULTIPLY","TONE_MAPPING","toneMappingExposure","toneMappingWhitePoint","lightMapIntensity","aoMapIntensity","emissiveIntensity","envMapIntensity","refractionRatio","bumpscale","normalScale","Vector2","reflectivity","isMeshPhysicalMaterial","Material","buildTileFromWorker","event","BufferGeometry","positions","Float32Array","data","normals","index","IndexArrayClass","2","Uint16Array","4","Uint32Array","bpe","indices","uv","n","sqrt","_","floor","addAttribute","BufferAttribute","setIndex","computeBoundingBox","terrainMaterial","PBR","plane","castShadow","receiveShadow","renderer","shadowMap","workerPool","workerPoolSize","navigator","hardwareConcurrency","worker","onmessage","push","currentWorker","postMessage","args","lastCameraPosition","currentKeysArray","tiles","pngs","camVec","textureWidth","textureHeight","focalDepth","focalLength","fstop","tColor","tDepth","maxblur","showFocus","manualdof","vignetting","depthblur","threshold","gain","bias","fringe","znear","zfar","noise","dithering","pentagon","shaderFocus","focusCoords","tDiffuse","join","Pass","enabled","needsSwap","clear","renderToScreen","assign","setSize","width","height","render","writeBuffer","readBuffer","delta","maskActive","console","error","textureID","undefined","camera","OrthographicCamera","Scene","quad","PlaneBufferGeometry","frustumCulled","constructor","texture","MaskPass","inverse","writeValue","clearValue","context","state","buffers","color","setMask","depth","setLocked","stencil","setTest","setOp","REPLACE","setFunc","ALWAYS","setClear","EQUAL","KEEP","ClearMaskPass","renderTarget","parameters","minFilter","LinearFilter","magFilter","format","RGBAFormat","stencilBuffer","getDrawingBufferSize","WebGLRenderTarget","name","renderTarget1","renderTarget2","passes","copyPass","swapBuffers","tmp","addPass","pass","insertPass","splice","il","stencilFunc","NOTEQUAL","reset","dispose","overrideMaterial","clearColor","clearAlpha","clearDepth","oldClearColor","oldClearAlpha","oldAutoClear","autoClear","getClearColor","getHex","getClearAlpha","setClearColor","initDoF","composerDepth","renderPassDepth","MeshDepthMaterial","composer","renderPass","bokeh","innerWidth","innerHeight","RINGS","SAMPLES","shaderPass","matChanger","e","near","far","setFocalLength","renderDepth","Geometry","transparent","type","renderOrder","Infinity","positionScreen","tempMap","DataTexture","Uint8Array","RGBFormat","NearestFilter","ClampToEdgeWrapping","occlusionMap","material1a","RawShaderMaterial","screenPosition","depthTest","depthWrite","material1b","mesh1","elements","Shader","material2","Color","blending","AdditiveBlending","mesh2","addElement","element","screenPositionPixels","validArea","Box2","viewport","Vector4","onBeforeRender","getCurrentViewport","invAspect","w","halfViewportWidth","halfViewportHeight","min","max","setFromMatrixPosition","matrixWorld","applyMatrix4","matrixWorldInverse","projectionMatrix","containsPoint","copyFramebufferToTexture","renderBufferDirect","vecX","vecY","l","uniformsNeedUpdate","isLensflare","float32Array","interleavedBuffer","InterleavedBuffer","InterleavedBufferAttribute","textureFlare3","lensFlare","motionBlurShader","velocityFactor","clipToWorldMatrix","Matrix4","previousWorldToClipMatrix","cameraMove","pilotDrone","horizonStyle","focalStyle","screenXYclamped","vec3","vector","widthHalf","heightHalf","project","screenXY","Crosshair","react_default","createElement","props","viewBox","cx","cy","r","PureComponent","targets","targetsInSight","Set","targetsInFront","screenCenter","subscribe","msg","rendererSize","HUD","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","time","gunHeat","lockLevel","pilot","publish","gunClock","running","getDelta","stop","_this2","times","forEach","target","lockClock","apply","timestamp","newState","setState","lock","userData","_this3","targetsData","id","style","altitude","toFixed","speed","className","crosshair","fill","stroke","strokeWidth","strokeDasharray","transform","concat","strokeLinecap","gunHud","hudPosition","direction","gunTarget","fillOpacity","strokeOpacity","hud","life","arrow","innerHTML","Component","targetDistance2D","targetDistance3D","targetVector2D","targetVector3D","targetDirection","targetLoop","hudElement","mounted","borderColor","borderBottomColor","sub","angle","destroyed","start","delete","ZONE","velocity","targetToDestroy","remove","filter","item","forceUpdate","localX","localY","rollAngle","pitch","rollAngleDegree","hudLoop","applyQuaternion","quaternion","angleTo","sign","dot","getWorldDirection","boxShadow","update","selectNearestGunTarget","distances","sort","b","ReactDOM","hud_HUD","document","getElementById","fireGroupOptions","frames","loop","maxParticleCount","pointsGroupOptions","NormalBlending","debrisGroupOptions","bulletGroupOptions","shockwaveOptions","particleCount","SPE","distributions","DISC","radius","spread","maxAge","duration","activeMultiplier","rotation","axis","static","debrisOptions","SPHERE","acceleration","distribution","BOX","wiggle","drag","fireOptions","mistOptions","flashOptions","smokeOptions","smokeLightOptions","bulletOptions","sparkOptions","flashGroup","Group","fireGroup","debrisGroup","shockGroup","mistGroup","smokeGroup","smokeLightGroup","bulletGroup","sparkGroup","addPool","groups","group","mesh","triggerSingleEmitter","follow","arguments","velocityFunction","emitter","getFromPool","initialPositions","params","velocities","collisions","bulletLine","targetVec3","chunkReducer","chunkSize","ar","it","ix","attributes","typedArray","array","slice","attributeOffset","activationEnd","reduce","paramsArray","param","construct","toConsumableArray","pos","Line3","closestPointToPoint","triggerSmallExplosion","alive","disable","releaseIntoPool","enable","setTimeout","triggerExplosion","smoking","missile","smokeEmitter","triggerLightSmoke","tmpVec1","targetVector","gunEmitter","droneMesh","loader","loadDroneAssets","gltf","children","droneFactory","ready","droneController","droneFolder","initDroneGui","initDroneFactory","targetPosition","targetPositionFinal","Clock","NaN","lastPosition","terrainTiles","raycaster","Raycaster","downVector","offsetVector","lastTimestamp","loops","lookAt","intersectObjects","terrainTileUnder","groundNormal","normal","spawnDrone","circle","phase","droneLoop","deadDrone","random","FlyControls","object","domElement","nipple","pointer","setAttribute","movementSpeed","rollSpeed","dragToLook","autoForward","on","nipplemove","updateMovementVector","pointerElement","zone","movements","dims","getContainerDimensions","left","top","pointerVector","move","dx","dy","mousemove","pageX","pageY","bind","scope","fn","contextmenu","preventDefault","mockEvent","radian","tmpQuaternion","Quaternion","moveState","down","right","forward","back","pitchUp","pitchDown","yawLeft","yawRight","rollLeft","rollRight","moveVector","rotationVector","keydown","altKey","keyCode","movementSpeedMultiplier","updateRotationVector","keyup","container","halfWidth","halfHeight","deltaVelocity","deltaPosition","rotMult","multiply","setFromQuaternion","order","offsetWidth","offsetHeight","offsetLeft","offsetTop","removeEventListener","_keydown","_keyup","addEventListener","controls","setAcceleration","isMobile","check","userAgent","vendor","opera","test","substr","mobileAndTabletcheck","display","touchPaneLeft","getElementsByClassName","nippleLook","nipplejs","mode","Array","from","el","buttonX","pressX","fireBullet","button","keyboardJS","autoRotate","bullet","MeshPhongMaterial","distanceTo","selectNearestTargetInSight","fire","callback","vec","newDir","tmpVec","terrainNormal","reflect","worldToLocal","audioLoader","AudioLoader","impacts","url","weapons","explosions","audioMapper","sound","buffer","setupSound","listener","AudioListener","PositionalAudio","setBuffer","setRefDistance","play","playExplosion","gatlingSound","Audio","setLoop","missileSound","WaterShader","surface","tReflectionMap","tRefractionMap","tNormalMap0","tNormalMap1","textureMatrix","config","waterVertexShader","waterFragmentShader","UnderwaterShader","waterLevel","tReflectionDepth","worldToClipMatrix","cameraPosition","underwaterVertexShader","underwaterFragmentShader","src_renderer","src_scene","src_camera","src_drone","src_sunPosition","src_gui","src_options","queryStringOptions","queryString","parse","location","search","shadows","postprocessing","PerspectiveCamera","cubeCamera","CubeCamera","cube","WebGLRenderer","antialias","alpha","gammaInput","gammaOutput","PCFSoftShadowMap","autoUpdate","physicallyCorrectLights","toneMapping","Uncharted2ToneMapping","body","appendChild","dat","GUI","autoPlace","closed","rendererFolder","rendererController","low","href","pathname","stringify","lowShadow","lowShadowDoF","high","FogExp2","visible","envMapScene","sky2","updatePosition","shadow","mapSize","bottom","initLights","waterParameters","waterGeometry","water","flowDirection","normalMap0","normalMap1","clipBias","flowSpeed","waterTarget","depthMaterial","depthBuffer","depthTexture","DepthTexture","__folders","isWater","underwaterReflector","getRenderTarget","ref","updateMatrixWorld","setupDrones","particleGroups","shakeCamera","abs","zoomDelta","currentTileSize","x0","round","y0","segments0","segments1","cutOffDistance","distanceVector","cameraXY","objectXY","visibleKeysArray","visibleKeysString","k","toString","currentKeysString","potentialUnderKeys","potentialUnderTiles","child","includes","tileToCamera","tile","subVectors","terrainKeysUnder","newKeys","indexOf","existingKeys","newKey","segments","j","distanceToCamera","markedForDeletion","deleteTile","tick","glitch","motionPass","underwaterPass","wigglePass","removeLoop","unshift","dofEffect","upass","previousMatrixWorldInverse","previousProjectionMatrix","previousCameraPosition","tmpMatrix","setPixelRatio","stats","Stats","dom","mainLoop","requestAnimationFrame","envMap","getInverse","dimension","aspect","updateProjectionMatrix","WindowResize"],"mappings":"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","file":"static/js/main.9d1df240.chunk.js","sourcesContent":["import * as THREE from 'three'\n\nglobal.THREE = THREE\n\nrequire('three/examples/js/loaders/GLTFLoader')\nrequire('three/examples/js/objects/Sky.js')\n\nrequire('three/examples/js/Octree.js')\n\nrequire('three/examples/js/objects/Lensflare.js')\n\nrequire('three/examples/js/objects/Reflector.js')\nrequire('three/examples/js/objects/Refractor.js')\nrequire('three/examples/js/objects/Water2.js')\n\nrequire('three/examples/js/shaders/BokehShader2.js')\nrequire('three/examples/js/shaders/CopyShader.js')\nrequire('three/examples/js/shaders/BlendShader.js')\nrequire('three/examples/js/shaders/WaterRefractionShader.js')\nrequire('three/examples/js/postprocessing/EffectComposer.js')\nrequire('three/examples/js/postprocessing/ShaderPass.js')\nrequire('three/examples/js/postprocessing/RenderPass.js')\nrequire('three/examples/js/postprocessing/SavePass.js')\nrequire('three/examples/js/shaders/DigitalGlitch.js')\nrequire('three/examples/js/postprocessing/GlitchPass.js')\n\nrequire('three/examples/js/modifiers/SimplifyModifier.js')\n\nrequire('three/examples/js/MarchingCubes.js')\n\nconst GLTFLoader = global.THREE.GLTFLoader\nconst Sky = global.THREE.Sky\n\nconst Octree = global.THREE.Octree\nconst BlendShader = global.THREE.BlendShader\nconst CopyShader = global.THREE.CopyShader\nconst WaterRefractionShader = global.THREE.WaterRefractionShader\n\nconst BokehShader = global.THREE.BokehShader\nconst EffectComposer = global.THREE.EffectComposer\nconst ShaderPass = global.THREE.ShaderPass\nconst RenderPass = global.THREE.RenderPass\nconst SavePass = global.THREE.SavePass\nconst GlitchPass = global.THREE.GlitchPass\n\nconst Lensflare = global.THREE.Lensflare\nconst LensflareElement = global.THREE.LensflareElement\n\nconst Reflector = global.THREE.Reflector\nconst Refractor = global.THREE.Refractor\nconst Water = global.THREE.Water\n\nconst SimplifyModifier = global.THREE.SimplifyModifier\n\nconst MarchingCubes = global.THREE.MarchingCubes\n\nexport {\n  GLTFLoader,\n  Sky,\n  Octree,\n  BlendShader,\n  CopyShader,\n  WaterRefractionShader,\n\n  BokehShader,\n  EffectComposer,\n  ShaderPass,\n  RenderPass,\n  SavePass,\n  GlitchPass,\n\n  Lensflare,\n  LensflareElement,\n\n  Reflector,\n  Refractor,\n  Water,\n\n  SimplifyModifier,\n\n  MarchingCubes\n}\n","module.exports = __webpack_public_path__ + \"static/media/Rock_08_UV_H_CM_1.da494a88.jpg\";","module.exports = __webpack_public_path__ + \"static/media/Rock_08_UV_H_CM_1_normal.6085c2f7.jpg\";","module.exports = __webpack_public_path__ + \"static/media/GrassGreenTexture0003.78621f63.jpg\";","module.exports = __webpack_public_path__ + \"static/media/GrassGreenTexture0003_normal.002f20c3.jpg\";","module.exports = __webpack_public_path__ + \"static/media/Water_1_M_Normal.a33d50da.jpg\";","module.exports = __webpack_public_path__ + \"static/media/Water_2_M_Normal.639428cf.jpg\";","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"38ac1dece4b7088e71bc.worker.js\");\n};","module.exports = \"#define PHYSICAL\\n\\nvarying vec3 vViewPosition;\\n\\n#ifndef FLAT_SHADED\\n\\n\\tvarying vec3 vNormal;\\n\\tvarying vec3 vNormal2;\\n\\n#endif\\n\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\n#include <envmap_pars_vertex>\\n\\nvoid main() {\\n\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\\n\\n\\tvNormal = normalize( transformedNormal );\\n\\n#endif\\n\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\n\\tvViewPosition = - mvPosition.xyz;\\n\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n\\t#include <envmap_vertex>\\n\\n\\tvNormal2 = normal;\\n}\\n\"","module.exports = \"#define PHYSICAL\\n\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float roughness;\\nuniform float metalness;\\nuniform float opacity;\\n\\n// ####### custom uniforms #########\\nuniform sampler2D rockTexture;\\nuniform sampler2D rockTextureNormal;\\n// #################################\\n\\n#ifndef STANDARD\\n\\tuniform float clearCoat;\\n\\tuniform float clearCoatRoughness;\\n#endif\\n\\nvarying vec3 vViewPosition;\\nvarying vec3 vWorldPosition;\\nvarying vec3 vNormal2;\\n\\n#ifndef FLAT_SHADED\\n\\n\\tvarying vec3 vNormal;\\n\\n#endif\\n\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <cube_uv_reflection_fragment>\\n#include <lights_pars_begin>\\n#include <lights_pars_maps>\\n#include <lights_physical_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <roughnessmap_pars_fragment>\\n#include <metalnessmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\n\\nvec4 physicalColor(sampler2D map, sampler2D normalMap, float roughness, float metalness) {\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <roughnessmap_fragment>\\n\\t#include <metalnessmap_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\t#include <emissivemap_fragment>\\n\\n\\t// accumulation\\n\\t#include <lights_physical_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\n\\t// modulation\\n\\t#include <aomap_fragment>\\n\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\t// #include <specularmap_fragment>\\n\\t// #include <envmap_fragment>\\n\\t// return vec4(envColor.rgb, 1.0);\\n\\treturn vec4(outgoingLight, diffuseColor.a);\\n}\\n\\nvoid main() {\\n\\n\\t#include <clipping_planes_fragment>\\n\\n\\tvec4 grassColor = physicalColor(map, normalMap, roughness, metalness);\\n\\tvec4 rockColor = physicalColor(rockTexture, rockTextureNormal, 0.4, 0.15);\\n\\tvec3 normal = normalize( vNormal2 );\\n\\tnormal = perturbNormal2Arb( -vViewPosition, normal );\\n\\tfloat flatness = dot(normal, vec3(0.0, 0.0, 1.0));\\n\\tvec4 colorTerrain = mix(\\n\\t\\trockColor,\\n\\t\\t// rockColor,\\n\\t\\tgrassColor,\\n\\t\\tsmoothstep(0.6, 0.7, flatness)\\n\\t);\\n\\tgl_FragColor = colorTerrain;\\n\\t// gl_FragColor = vec4(vec3(vWorldPosition.z/100.0), 1.0);\\n\\tvec3 outgoingLight = gl_FragColor.rgb;\\n\\t#include <specularmap_fragment>\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4(outgoingLight.rgb, gl_FragColor.a);\\n\\n\\n\\t// gl_FragColor = vec4(material.specularColor, 1.0);\\n\\t// gl_FragColor = vec4(reflectedLight.indirectDiffuse, 1.0);\\n\\t// gl_FragColor = vec4(directLight.direction, 1.0);\\n\\t// // gl_FragColor = texture2D(map, vUv);\\n\\t// gl_FragColor = vec4(normal, 1.0);\\n\\t// gl_FragColor = vec4(material.diffuseColor, 1.0);\\n\\t// gl_FragColor = vec4(metalness, metalness, metalness, 1.0);\\n\\t// gl_FragColor = vec4(diffuseColor.rgb * ( 1.0 - metalnessFactor ), 1.0);\\n\\t// gl_FragColor = vec4(outgoingLight, diffuseColor.a);\\n\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\n\\t//  FOG\\n\\t// #include <fog_fragment>\\n\\treflectVec = refract( cameraToVertex, worldNormal, 1.0 );\\n\\tvec4 fogColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\\n\\tfogFactor = mix(fogFactor, fogFactor / 10.0, smoothstep(100.0, 300.0, vWorldPosition.z));\\n\\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor.rgb, fogFactor );\\n\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n\\n}\\n\"","module.exports = \"#define STANDARD\\n\\nvarying vec3 vViewPosition;\\n\\n#ifndef FLAT_SHADED\\n\\n\\tvarying vec3 vNormal;\\n\\n#endif\\n\\nvarying vec3 vNormal2;\\nvarying float flatness;\\n\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\n\\nvoid main() {\\n\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\\n\\n\\tvNormal = normalize( transformedNormal );\\n\\n#endif\\n\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\n\\tvViewPosition = - mvPosition.xyz;\\n\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n\\n\\tvNormal2 = normalize(normal);\\n\\tflatness = dot(normal, vec3(0.0, 0.0, 1.0));\\n}\\n\"","module.exports = \"#define STANDARD\\n\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float roughness;\\nuniform float metalness;\\nuniform float opacity;\\n\\n// ####### custom uniforms #########\\nuniform sampler2D rockTexture;\\nuniform sampler2D rockTextureNormal;\\n// #################################\\n\\n#ifndef STANDARD\\n\\tuniform float clearCoat;\\n\\tuniform float clearCoatRoughness;\\n#endif\\n\\nvarying vec3 vViewPosition;\\nvarying vec3 vWorldPosition;\\nvarying vec3 vNormal2;\\nvarying float flatness;\\n\\n#ifndef FLAT_SHADED\\n\\n\\tvarying vec3 vNormal;\\n\\n#endif\\n\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <cube_uv_reflection_fragment>\\n#include <lights_pars_begin>\\n#include <lights_pars_maps>\\n#include <lights_physical_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n\\n// #include <normalmap_pars_fragment>\\n#ifdef USE_NORMALMAP\\n\\n\\tuniform sampler2D normalMap;\\n\\tuniform vec2 normalScale;\\n\\n\\t// Per-Pixel Tangent Space Normal Mapping\\n\\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\\n\\n\\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm) {\\n\\n\\t\\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\\n\\n\\t\\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\\n\\t\\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\\n\\t\\tvec2 st0 = dFdx( vUv.st );\\n\\t\\tvec2 st1 = dFdy( vUv.st );\\n\\n\\t\\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\\n\\t\\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\\n\\t\\tvec3 N = normalize( surf_norm );\\n\\n\\t\\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\\t\\tmapN.xy = normalScale * mapN.xy;\\n\\t\\tmat3 tsn = mat3( S, T, N );\\n\\t\\treturn normalize( tsn * mapN );\\n\\n\\t}\\n\\n#endif\\n\\n#include <roughnessmap_pars_fragment>\\n#include <metalnessmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\n\\nvec4 physicalColor(sampler2D map, sampler2D normalMap, float roughness, float metalness) {\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <roughnessmap_fragment>\\n\\t#include <metalnessmap_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\n\\t#include <emissivemap_fragment>\\n\\n\\t// accumulation\\n\\t#include <lights_physical_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\n\\t// modulation\\n\\t#include <aomap_fragment>\\n\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\t// #include <specularmap_fragment>\\n\\t// #include <envmap_fragment>\\n\\t// return vec4(envColor.rgb, 1.0);\\n\\treturn vec4(outgoingLight, diffuseColor.a);\\n}\\n\\nvoid main() {\\n\\n\\t#include <clipping_planes_fragment>\\n\\n\\tvec4 grassColor = physicalColor(map, normalMap, roughness, metalness);\\n\\tvec4 rockColor = physicalColor(rockTexture, rockTextureNormal, 0.4, 0.15);\\n\\tvec4 colorTerrain = mix(\\n\\t\\trockColor,\\n\\t\\tgrassColor,\\n\\t\\tsmoothstep(0.6, 0.7, flatness)\\n\\t);\\n\\tgl_FragColor = colorTerrain;\\n\\t// gl_FragColor = vec4(vec3(vWorldPosition.z/100.0), 1.0);\\n\\tvec3 outgoingLight = gl_FragColor.rgb;\\n\\t#include <specularmap_fragment>\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4(outgoingLight.rgb, gl_FragColor.a);\\n\\n\\n\\t// gl_FragColor = vec4(material.specularColor, 1.0);\\n\\t// gl_FragColor = vec4(reflectedLight.indirectDiffuse, 1.0);\\n\\t// gl_FragColor = vec4(directLight.direction, 1.0);\\n\\t// // gl_FragColor = texture2D(map, vUv);\\n\\t// gl_FragColor = vec4(normal, 1.0);\\n\\t// gl_FragColor = vec4(material.diffuseColor, 1.0);\\n\\t// gl_FragColor = vec4(metalness, metalness, metalness, 1.0);\\n\\t// gl_FragColor = vec4(diffuseColor.rgb * ( 1.0 - metalnessFactor ), 1.0);\\n\\t// gl_FragColor = vec4(outgoingLight, diffuseColor.a);\\n\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\n\\t#include <fog_fragment>\\n\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n\\n\\t// gl_FragColor = vec4(normal, 1.0);\\n\\n}\\n\"","module.exports = \"#include <common>\\n#include <fog_pars_fragment>\\n\\nuniform sampler2D tReflectionMap;\\nuniform sampler2D tRefractionMap;\\nuniform sampler2D tNormalMap0;\\nuniform sampler2D tNormalMap1;\\nuniform sampler2D tDepth;\\n\\n#ifdef USE_FLOWMAP\\nuniform sampler2D tFlowMap;\\n#else\\nuniform vec2 flowDirection;\\n#endif\\n\\nuniform vec3 color;\\nuniform float reflectivity;\\nuniform float surface;\\nuniform vec4 config;\\nuniform mat4 clipToWorldMatrix;\\n\\nvarying vec4 vCoord;\\nvarying vec2 vUv;\\nvarying vec3 vToEye;\\n\\nvec3 surfaceColor = vec3(0.0078, 0.5176, 0.7);\\nvec3 shoreColor = vec3(0.0078, 0.5176, 0.7);\\nvec3 depthColor = vec3(0.0039, 0.00196, 0.145);\\n// Description : Water color based on water depth and color extinction\\n//\\n// based on Rendering Water as a Post-process Effect by Wojciech Toman\\n//\\n\\n// waterTransparency - x = , y = water visibility along eye vector,\\n// waterDepthValues - x = water depth in world space, y = view/accumulated water depth in world space\\nvec3 DepthRefraction(float waterDepth, float viewWaterDepth, vec3 refractionColor)\\n{\\n  float waterClarity = 0.75;\\n  float visibility = 200.;\\n  float shoreRange = 50.;\\n  float horizontalExtinction = 200.;\\n\\n  float accDepth = viewWaterDepth * waterClarity; // accumulated water depth\\n  float accDepthExp = saturate(accDepth / (2.5 * visibility));\\n  accDepthExp *= (1.0 - accDepthExp) * accDepthExp * accDepthExp + 1.0; // out cubic\\n\\n  surfaceColor = mix(shoreColor, surfaceColor, saturate(waterDepth / shoreRange));\\n  vec3 waterColor = mix(surfaceColor, depthColor, saturate(waterDepth / horizontalExtinction));\\n\\n  refractionColor = mix(refractionColor, surfaceColor * waterColor, saturate(accDepth / visibility));\\n  refractionColor = mix(refractionColor, depthColor, accDepthExp);\\n  refractionColor = mix(refractionColor, depthColor * waterColor, saturate(waterDepth / horizontalExtinction));\\n  return refractionColor;\\n}\\n\\nvoid main() {\\n\\n  float flowMapOffset0 = config.x;\\n  float flowMapOffset1 = config.y;\\n  float halfCycle = config.z;\\n  float scale = config.w;\\n\\n  vec3 toEye = normalize( vToEye );\\n  vec3 surfacePosition = cameraPosition - vToEye;\\n\\n  // determine flow direction\\n  vec2 flow;\\n  #ifdef USE_FLOWMAP\\n  flow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;\\n  #else\\n  flow = flowDirection;\\n  #endif\\n  flow.x *= - 1.0;\\n\\n  // sample normal maps (distort uvs with flowdata)\\n  vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );\\n  vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );\\n\\n  // linear interpolate to get the final normal color\\n  float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;\\n  vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\\n\\n  // calculate normal vector\\n  //  vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\\n  vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0,  normalColor.g * 2.0 - 1.0, normalColor.b ));\\n\\n  // calculate the fresnel term to blend reflection and refraction maps\\n  float theta = max( dot( toEye, normal ), 0.0 );\\n  float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );\\n\\n  // calculate final uv coords\\n  vec3 coord = vCoord.xyz / vCoord.w;\\n  vec2 uv = coord.xy + coord.z * normal.xy * 0.1;\\n\\n  vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );\\n  vec4 refractColor = texture2D( tRefractionMap, uv );\\n\\n  // water depth\\n\\n  float zOverW = texture2D(tDepth, coord.xy).x;\\n  // clipPosition is the viewport position at this pixel in the range -1 to 1.\\n  vec4 clipPosition = vec4(coord.xy * 2. - 1., zOverW * 2. - 1., 1.);\\n  vec4 worldPosition = clipToWorldMatrix * clipPosition;\\n  worldPosition /= worldPosition.w;\\n\\n  float waterDepth = surfacePosition.z - worldPosition.z;\\n  float viewWaterDepth = length(surfacePosition - worldPosition.xyz);\\n\\n  float depthDensity = 0.01;\\n  float depthFactor = whiteCompliment( exp2( - depthDensity * depthDensity * viewWaterDepth * viewWaterDepth * LOG2 ) );\\n  refractColor.rgb = mix( refractColor.rgb, depthColor, depthFactor );\\n  // refractColor.rgb = DepthRefraction(waterDepth, viewWaterDepth, refractColor.rgb);\\n\\n  // multiply water color with the mix of both textures\\n  gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );\\n  // gl_FragColor = refractColor;\\n  // gl_FragColor = vec4(vec3(waterDepth/500.), 1.0);\\n\\n  // #include <tonemapping_fragment>\\n  // #include <encodings_fragment>\\n  // #include <fog_fragment>\\n\\n}\"","module.exports = \"#include <fog_pars_vertex>\\n\\nuniform mat4 textureMatrix;\\n\\nvarying vec4 vCoord;\\nvarying vec2 vUv;\\nvarying vec3 vToEye;\\n\\nvoid main() {\\n\\n  vUv = uv;\\n  vCoord = textureMatrix * vec4( position, 1.0 );\\n\\n  vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\\n  vToEye = cameraPosition - worldPosition.xyz;\\n\\n  vec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex\\n  gl_Position = projectionMatrix * mvPosition;\\n\\n  #include <fog_vertex>\\n\\n}\"","module.exports = \"#include <common>\\n#include <packing>\\n#include <fog_pars_fragment>\\n\\nuniform sampler2D tDiffuse;\\nuniform sampler2D tDepth;\\nuniform sampler2D tReflectionMap;\\nuniform sampler2D tReflectionDepth;\\nuniform sampler2D tNormalMap0;\\nuniform sampler2D tNormalMap1;\\n\\n#ifdef USE_FLOWMAP\\nuniform sampler2D tFlowMap;\\n#else\\nuniform vec2 flowDirection;\\n#endif\\n\\nuniform vec3 color;\\nuniform float reflectivity;\\nuniform float time;\\nuniform float waterLevel;\\nuniform vec4 config;\\nuniform vec3 sunPosition;\\nuniform mat4 clipToWorldMatrix;\\nuniform mat4 worldToClipMatrix;\\n\\nvarying vec4 vCoord;\\nvarying vec2 vUv;\\nvarying vec3 vToEye;\\n\\n// vec3 depthColor = vec3(0.0039, 0.00196, 0.145);\\nvec3 depthColor = vec3(0.0117, 0.0117, 0.325);\\n\\n#define TAU 6.28318530718\\n#define MAX_ITER 5\\nvec3 caustic(vec2 uv) {\\n  vec2 p = mod(uv*TAU, TAU)-250.0;\\n\\n  vec2 i = vec2(p);\\n  float c = 1.0;\\n  float inten = .005;\\n\\n  for (int n = 0; n < MAX_ITER; n++) {\\n    float t = time * (1.0 - (3.5 / float(n+1)));\\n    i = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));\\n    c += 1.0/length(vec2(p.x / (sin(i.x+t)/inten),p.y / (cos(i.y+t)/inten)));\\n  }\\n\\n  c /= float(MAX_ITER);\\n  c = 1.17-pow(c, 1.4);\\n  vec3 color = vec3(pow(abs(c), 8.0));\\n  // color = clamp(color + vec3(0.0, 0.35, 0.5), 0.0, 1.0);\\n  color = mix(color, vec3(1.0,1.0,1.0),0.5);\\n\\n  return color;\\n}\\n\\nfloat causticX(float x, float power, float gtime) {\\n  float p = mod(x*TAU, TAU)-250.0;\\n\\n  float i = p;;\\n  float c = 1.0;\\n  float inten = .005;\\n\\n  for (int n = 0; n < MAX_ITER/2; n++) {\\n    float t = gtime * (1.0 - (3.5 / float(n+1)));\\n    i = p + cos(t - i) + sin(t + i);\\n    c += 1.0/length(p / (sin(i+t)/inten));\\n  }\\n  c /= float(MAX_ITER);\\n  c = 1.17-pow(c, power);\\n\\n  return c;\\n}\\n\\nfloat GodRays(vec2 uv) {\\n  float light = 0.0;\\n  vec4 uvSun = worldToClipMatrix * vec4(sunPosition, 1.);\\n  uvSun /= uvSun.w;\\n  uvSun = uvSun / 2. + 0.5;\\n  vec2 uv2 = vec2(\\n    dot(normalize(uv - uvSun.xy), vec2(1., 0.)),\\n    length(uv - uvSun.xy)\\n  );\\n\\n  light += pow(causticX((uv2.x + 0.08 * uv2.y) / 1.7 + 0.5, 1.8, time * 0.65), 10.0) * 0.05;\\n  light += pow(causticX(sin(uv2.x), 0.3, time * 0.7), 9.0) * 0.4;\\n  light += pow(causticX(cos(uv2.x * 2.3), 0.3, time * 1.3), 4.0) * 0.1;\\n\\n  light *= smoothstep(0., .3, uv2.y) * smoothstep(0., .3, uv2.y);\\n  light = clamp(light, 0.0, 1.0);\\n\\n  return light;\\n}\\n\\n#define HASHSCALE1 .1031\\n#define HASHSCALE3 vec3(.1031, .1030, .0973)\\nfloat hash11(float p)\\n{\\n  vec3 p3  = fract(vec3(p) * HASHSCALE1);\\n    p3 += dot(p3, p3.yzx + 19.19);\\n    return fract((p3.x + p3.y) * p3.z);\\n}\\nvec3 hash33(vec3 p3)\\n{\\n  p3 = fract(p3 * HASHSCALE3);\\n    p3 += dot(p3, p3.yxz+19.19);\\n    return fract((p3.xxy + p3.yxx)*p3.zyx);\\n}\\n\\nconst int   STAR_VOXEL_STEPS = 8;\\nconst float STAR_VOXEL_STEP_SIZE = 3.;\\n\\nfloat distanceRayPoint(vec3 ro, vec3 rd, vec3 p, out float h) {\\n    h = dot(p - ro, rd);\\n    return length(p - ro - rd * h);\\n}\\nvec3 getDotColour(float t)\\n{\\n  return vec3(t*.57,t*.3,t*.05);\\n  return vec3(t*.9,t*.9,t*.9);\\n  return vec3(t*.3,t*.6,t*.5);\\n}\\n\\n// This code is the starfield stuff from iapafoto\\n// https://www.shadertoy.com/view/Xl2BRR\\nvec4 detritus(in vec3 ro, in vec3 rd, in float tmax) {\\n\\n  float d =  0.;\\n\\n  vec3 ros = ro + rd*d;\\n  ros /= STAR_VOXEL_STEP_SIZE;\\n  vec3 pos = floor(ros),\\n       mm, ri = 1./rd,\\n       rs = sign(rd),\\n       dis = (pos - ros + 0.5 + rs * 0.5) * ri;\\n\\n  float dint;\\n  vec3 offset, id;\\n  vec4 col = vec4(0);\\n  vec4 sum = vec4(0);\\n\\n  for(int i = 0; i < STAR_VOXEL_STEPS; i++) {\\n    id = hash33(pos);\\n    float size  = hash11(float(i))*.02 + .005;\\n    offset = clamp(id + .2 * cos(id + id.x * time), size, 1. - size);\\n    d = distanceRayPoint(ros, rd, pos + offset, dint);\\n\\n    if (dint > 0. && dint * STAR_VOXEL_STEP_SIZE < tmax) {\\n      col = vec4(getDotColour(id.x), .8) * smoothstep(size, 0.0, d);\\n      col.a *= smoothstep(float(STAR_VOXEL_STEPS), 0., dint);\\n      col.rgb *= col.a / dint;\\n      sum += (1. - sum.a) * col;\\n      if (sum.a>.99) break;\\n    }\\n\\n    mm = step(dis.xyz, dis.yxy) * step(dis.xyz, dis.zzx);\\n    dis += mm * rs * ri;\\n    pos += mm * rs;\\n  }\\n\\n  return sum * .75;\\n}\\n\\n\\nvoid main() {\\n\\n  float flowMapOffset0 = config.x;\\n  float flowMapOffset1 = config.y;\\n  float halfCycle = config.z;\\n  float scale = config.w;\\n\\n  float depth = texture2D(tDepth, vUv).x;\\n  float w;\\n  // float logDepthBufFC = 2.0 / log2( 1000000. + 1.0 );\\n  // float w = pow(2.0, (2. * depth / logDepthBufFC)) - 1.0;\\n  // depth = viewZToPerspectiveDepth(-w, 1., 1000000.);\\n\\n  vec4 world = clipToWorldMatrix * vec4(vUv * 2. - 1., depth * 2. - 1., 1.0);\\n  world /= world.w;\\n  float worldDistance = length(world.xyz - cameraPosition);\\n\\n  vec3 dir = normalize(world.xyz - cameraPosition);\\n  vec3 hitPoint = linePlaneIntersect(cameraPosition, dir, vec3(0., 0., waterLevel), vec3(0., 0., -1.));\\n  float hitDirection = dot(hitPoint - cameraPosition, dir);\\n  float hitDistance = hitDirection > 0. ? length(hitPoint - cameraPosition) : 1e7;\\n\\n  float dist = min(hitDistance, worldDistance);\\n  float fogDensity = 0.007;\\n  float fogFactor;\\n  vec3 nearestPoint = dist == hitDistance ? hitPoint : world.xyz;\\n  float waterDepth = waterLevel - nearestPoint.z;\\n\\n  // sample normal maps (distort uvs with flowdata)\\n  vec2 nUV = fract(hitPoint.xy / 15.);\\n  vec2 flow = vec2(1., 1.);\\n  vec4 normalColor0 = texture2D( tNormalMap0, nUV + flow * time / 10.);\\n  vec4 normalColor1 = texture2D( tNormalMap1, nUV + flow * time / 10.);\\n\\n  // linear interpolate to get the final normal color\\n  float flowLerp = sin(time) / 2. + 0.5;\\n  vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\\n\\n  // calculate normal vector\\n  vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0,  normalColor.g * 2.0 - 1.0, -normalColor.b ));\\n  vec3 waterNormal = normalize(normal);\\n  vec4 coord = worldToClipMatrix * vec4(hitPoint.xy + waterNormal.xy * waterNormal.z * 3., hitPoint.z, 1.0);\\n  coord /= coord.w;\\n  coord = coord / 2.0 + 0.5;\\n  // coord.xy = vUv;\\n\\n  if (worldDistance < hitDistance) {\\n    gl_FragColor = texture2D(tDiffuse, vUv);\\n    gl_FragColor.rgb *= caustic(nearestPoint.xy / 10.);\\n  } else {\\n\\n    // calculate the fresnel term to blend reflection and refraction maps\\n    float theta = max( dot( -dir, waterNormal ), 0.0 );\\n    float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );\\n    reflectance = (1. - length(refract(dir, waterNormal, 1.33))) * reflectance;\\n    reflectance = clamp(reflectance, 0.15, 0.85);\\n\\n    vec4 reflectColor = texture2D( tReflectionMap, vec2(1. - coord.x, coord.y) );\\n    vec4 reflectDepth = texture2D( tReflectionDepth, vec2(1.0 - coord.x, coord.y) );\\n    vec4 refractColor = texture2D( tDiffuse, coord.xy );\\n\\n    // w = pow(2.0, (2. * reflectDepth.x / logDepthBufFC)) - 1.0;\\n    // w = -perspectiveDepthToViewZ(reflectDepth.x, 1., 1000000.);\\n    // reflectDepth.x = viewZToPerspectiveDepth(-w, 1., 1000000.);\\n    w = 500. * reflectDepth.x + dist;\\n\\n    fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * w * w * LOG2 ) );\\n    reflectColor.rgb = mix(reflectColor.rgb, depthColor, fogFactor);\\n\\n    // multiply water color with the mix of both textures\\n    gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );\\n    // gl_FragColor = vec4(vec3(reflectance), 1.0);\\n    // gl_FragColor = reflectColor;\\n    // gl_FragColor = reflectDepth;\\n    // gl_FragColor = vec4(vec3(w/500.), 1.0);\\n    // gl_FragColor = vec4(vec3(w/100.), 1.0);\\n\\n}\\n\\n// float fogDepth = dist + waterDepth * min(1., waterDepth / 100.);\\nfloat fogDepth = dist + clamp(waterLevel - cameraPosition.z, 0., 100.);\\nfogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\\ngl_FragColor.rgb = mix(gl_FragColor.rgb, depthColor, fogFactor);\\n\\ngl_FragColor.rgb += GodRays(vUv) * (1. - smoothstep(0., 100., waterLevel - cameraPosition.z));\\n\\nvec4 star = detritus(cameraPosition, dir,  min(40., dist / STAR_VOXEL_STEP_SIZE));\\ngl_FragColor.rgb = gl_FragColor.rgb * (1.0 - star.a)+star.rgb;\\n\\n\\n// gl_FragColor = texture2D(tReflectionMap, vec2(1.0 - vUv.x, vUv.y));\\n// gl_FragColor = vec4(dir, 1.);\\n// gl_FragColor = vec4( vec3(dist /1000.), 1.0 );\\n// gl_FragColor = vec4( vec3(hitDistance/100.), 1.0 );\\n// gl_FragColor = vec4( vec3(dist/100.), 1.0 );\\n\\n}\"","module.exports = \" #include <fog_pars_vertex>\\n\\nuniform mat4 textureMatrix;\\n\\nvarying vec4 vCoord;\\nvarying vec2 vUv;\\nvarying vec3 vToEye;\\n\\nvoid main() {\\n\\nvUv = uv;\\nvCoord = textureMatrix * vec4( position, 1.0 );\\n\\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\\nvToEye = cameraPosition - worldPosition.xyz;\\n\\nvec4 mvPosition = viewMatrix * worldPosition; // used in fog_vertex\\ngl_Position = projectionMatrix * mvPosition;\\n\\n#include <fog_vertex>\\n\\n}\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAIAAABMXPacAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6Qzk3MDg1MDY1MzMzMTFFMDkwN0M4OEMxQ0JGNjFGQkIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6Qzk3MDg1MDc1MzMzMTFFMDkwN0M4OEMxQ0JGNjFGQkIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDOTcwODUwNDUzMzMxMUUwOTA3Qzg4QzFDQkY2MUZCQiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDOTcwODUwNTUzMzMxMUUwOTA3Qzg4QzFDQkY2MUZCQiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Po4pkJAAAA9KSURBVHja7F0JdqMw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\"","module.exports = __webpack_public_path__ + \"static/media/Explosion_002_Tile_8x8_256x256.d28fc70f.png\";","module.exports = __webpack_public_path__ + \"static/media/smokeparticle.4939a8d2.png\";","module.exports = \"data:image/png;base64,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\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gIBEhghhPTbNQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAABF0lEQVQ4y62TsU7DQBBE39opHKS4AuUrkjKlC/qUlPxcSij5A5cuyVdYSZVIGCGZoRlLF8sBJDjpdNZ6Zm92bzaYWJKW/hzOFiAi2jE2JshroAJWwNzhDtgDdUS8XiSQFBEh37oBHnzeAYVx78ABaIBnoBnUzJJkG+ARuAdKIE8UFsACuE2SvgySQ9Ja0k7SUVIv6fPK7o3ZuVRmblRlBWVy67g/cqw0tpLUZv6xcs35teYmsdzYFUBmBXPXNkWcSlSYs8z448psks5PpV9wZGwHtIOCvd+5T0BTRIw5mENmQ9Q2ySkBarSH2MnY+sLakraSnvzOHyM/9I4djdkOvNSJTWLbH638f8P0zTgvgBuH3oDz1Dh/AWVJt7banagAAAAAAElFTkSuQmCC\"","module.exports = __webpack_public_path__ + \"static/media/impact1.db06d2c4.ogg\";","module.exports = __webpack_public_path__ + \"static/media/impact2.7d720129.ogg\";","module.exports = __webpack_public_path__ + \"static/media/impact3.7a5b4e82.ogg\";","module.exports = __webpack_public_path__ + \"static/media/impact4.43348926.ogg\";","module.exports = __webpack_public_path__ + \"static/media/gatling.b8ff47f4.ogg\";","module.exports = __webpack_public_path__ + \"static/media/missile.f0faf674.ogg\";","module.exports = __webpack_public_path__ + \"static/media/explosion1.2f1ab236.ogg\";","module.exports = __webpack_public_path__ + \"static/media/explosion2.752472e3.ogg\";","import PubSub from 'pubsub-js'\n\n// PubSub.subscribe('x', (msg, data) => console.log(msg, data))\n\nexport default PubSub\n","/**\n * @author zz85 / https://github.com/zz85\n *\n * Based on \"A Practical Analytic Model for Daylight\"\n * aka The Preetham Model, the de facto standard analytic skydome model\n * http://www.cs.utah.edu/~shirley/papers/sunsky/sunsky.pdf\n *\n * First implemented by Simon Wallner\n * http://www.simonwallner.at/projects/atmospheric-scattering\n *\n * Improved by Martin Upitis\n * http://blenderartists.org/forum/showthread.php?245954-preethams-sky-impementation-HDR\n *\n * Three.js integration by zz85 http://twitter.com/blurspline\n*/\nimport {\n  ShaderMaterial,\n  SphereBufferGeometry,\n  Mesh,\n  Vector3,\n  UniformsUtils,\n  BackSide\n} from 'three'\n\nconst Sky = function () {\n  var shader = Sky.SkyShader\n\n  var material = new ShaderMaterial({\n    fragmentShader: shader.fragmentShader,\n    vertexShader: shader.vertexShader,\n    uniforms: UniformsUtils.clone(shader.uniforms),\n    side: BackSide\n  })\n\n  Mesh.call(this, new SphereBufferGeometry(1, 32, 15), material)\n}\n\nSky.prototype = Object.create(Mesh.prototype)\n\nSky.SkyShader = {\n\n  uniforms: {\n    luminance: { value: 1 },\n    turbidity: { value: 2 },\n    rayleigh: { value: 1 },\n    mieCoefficient: { value: 0.005 },\n    mieDirectionalG: { value: 0.8 },\n    sunPosition: { value: new Vector3() }\n  },\n\n  vertexShader: `\n        uniform vec3 sunPosition;\n        uniform float rayleigh;\n        uniform float turbidity;\n        uniform float mieCoefficient;\n\n        varying vec3 vWorldPosition;\n        varying vec3 vSunDirection;\n        varying float vSunfade;\n        varying vec3 vBetaR;\n        varying vec3 vBetaM;\n        varying float vSunE;\n\n        const vec3 up = vec3( 0.0, 0.0, 1.0 );\n\n        // constants for atmospheric scattering\n        const float e = 2.71828182845904523536028747135266249775724709369995957;\n        const float pi = 3.141592653589793238462643383279502884197169;\n\n        // wavelength of used primaries, according to preetham\n        const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\n        // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\n        // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\n        const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\n\n        // mie stuff\n        // K coefficient for the primaries\n        const float v = 4.0;\n        const vec3 K = vec3( 0.686, 0.678, 0.666 );\n        // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\n        const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\n\n        // earth shadow hack\n        // cutoffAngle = pi / 1.95;\n        const float cutoffAngle = 1.6110731556870734;\n        const float steepness = 1.5;\n        const float EE = 1000.0;\n\n        float sunIntensity( float zenithAngleCos ) {\n        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\n        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\n        }\n\n        vec3 totalMie( float T ) {\n        float c = ( 0.2 * T ) * 10E-18;\n        return 0.434 * c * MieConst;\n        }\n\n        void main() {\n\n        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n        vWorldPosition = worldPosition.xyz;\n\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n        vSunDirection = normalize( sunPosition );\n\n        vSunE = sunIntensity( dot( vSunDirection, up ) );\n\n        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.z / 450000.0 ) ), 0.0, 1.0 );\n\n        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\n\n        // extinction (absorbtion + out scattering)\n        // rayleigh coefficients\n        vBetaR = totalRayleigh * rayleighCoefficient;\n\n        // mie coefficients\n        vBetaM = totalMie( turbidity ) * mieCoefficient;\n\n        }\n    `,\n\n  fragmentShader: `\n        varying vec3 vWorldPosition;\n        varying vec3 vSunDirection;\n        varying float vSunfade;\n        varying vec3 vBetaR;\n        varying vec3 vBetaM;\n        varying float vSunE;\n\n        uniform float luminance;\n        uniform float mieDirectionalG;\n\n        const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );\n\n        // constants for atmospheric scattering\n        const float pi = 3.141592653589793238462643383279502884197169;\n\n        const float n = 1.0003; // refractive index of air\n        const float N = 2.545E25; // number of molecules per unit volume for air at\n                                    // 288.15K and 1013mb (sea level -45 celsius)\n\n        // optical length at zenith for molecules\n        const float rayleighZenithLength = 8.4E3;\n        const float mieZenithLength = 1.25E3;\n        const vec3 up = vec3( 0.0, 0.0, 1.0 );\n        // 66 arc seconds -> degrees, and the cosine of that\n        const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\n\n        // 3.0 / ( 16.0 * pi )\n        const float THREE_OVER_SIXTEENPI = 0.05968310365946075;\n        // 1.0 / ( 4.0 * pi )\n        const float ONE_OVER_FOURPI = 0.07957747154594767;\n\n        float rayleighPhase( float cosTheta ) {\n        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\n        }\n\n        float hgPhase( float cosTheta, float g ) {\n        float g2 = pow( g, 2.0 );\n        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\n        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\n        }\n\n        // Filmic ToneMapping http://filmicgames.com/archives/75\n        const float A = 0.15;\n        const float B = 0.50;\n        const float C = 0.10;\n        const float D = 0.20;\n        const float E = 0.02;\n        const float F = 0.30;\n\n        const float whiteScale = 1.0748724675633854; // 1.0 / Uncharted2Tonemap(1000.0)\n\n        vec3 Uncharted2Tonemap( vec3 x ) {\n        return ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;\n        }\n\n\n        void main() {\n        // optical length\n        // cutoff angle at 90 to avoid singularity in next formula.\n        float zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );\n        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\n        float sR = rayleighZenithLength * inverse;\n        float sM = mieZenithLength * inverse;\n\n        // combined extinction factor\n        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\n\n        // in scattering\n        float cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );\n\n        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\n        vec3 betaRTheta = vBetaR * rPhase;\n\n        float mPhase = hgPhase( cosTheta, mieDirectionalG );\n        vec3 betaMTheta = vBetaM * mPhase;\n\n        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\n        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\n\n        // nightsky\n        vec3 direction = normalize( vWorldPosition - cameraPos );\n        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]\n        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]\n        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\n        vec3 L0 = vec3( 0.1 ) * Fex;\n\n        // composition + solar disc\n        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\n        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;\n\n        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\n\n        vec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );\n        vec3 color = curr * whiteScale;\n\n        vec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\n\n        gl_FragColor = vec4( retColor, 1.0 );\n\n        }`\n\n}\n\nexport {Sky}\n","import {\n  DirectionalLight,\n  HemisphereLight,\n  AmbientLight\n} from 'three'\nimport {drone} from './index'\n\nconst dirLight = new DirectionalLight(0xffffff, 4)\nwindow.dirLight = dirLight\nconst hemishpereLight = new HemisphereLight(0xffffbb, 0x080820, 0.1)\nhemishpereLight.position.set(0, 0, 1)\nhemishpereLight.up.set(0, 0, 1)\nhemishpereLight.needsUpdate = true\nconst ambientLight = new AmbientLight(0x404040, 0.1) // soft white light\n\nconst updateDirLightPosition = () => {\n  dirLight.position.copy(dirLight.sunPosition)\n  dirLight.position.normalize()\n  dirLight.position.multiplyScalar(1600.0)\n  dirLight.position.add(drone.position)\n}\n\nconst initLights = (scene, sunPosition) => {\n  dirLight.sunPosition = sunPosition\n  dirLight.updatePosition = updateDirLightPosition\n  dirLight.updatePosition()\n  dirLight.up.set(0, 0, 1)\n  dirLight.name = 'sunlight'\n\n  dirLight.castShadow = true\n  dirLight.shadow.mapSize.width = dirLight.shadow.mapSize.height = 1024\n  const d = 1024\n  dirLight.shadow.camera.left = -d\n  dirLight.shadow.camera.right = d\n  dirLight.shadow.camera.top = d\n  dirLight.shadow.camera.bottom = -d\n\n  dirLight.shadow.camera.far = 3200\n  dirLight.shadow.bias = -0.0001\n  dirLight.needsUpdate = true\n\n  scene.add(dirLight)\n  scene.add(hemishpereLight)\n  scene.add(ambientLight)\n}\n\nexport {initLights, dirLight, hemishpereLight, ambientLight}\n","import {\n  Mesh,\n  // SphereBufferGeometry,\n  SphereGeometry,\n  MeshBasicMaterial,\n  BackSide\n} from 'three'\nimport {Sky} from '../modules/Sky'\nimport {dirLight} from '../lights'\n\nfunction initSky (scene, sunPosition, gui) {\n  // Add Sky\n  const sky = new Sky()\n  sky.scale.setScalar(450000)\n  scene.add(sky)\n\n  // Add Sun Helper\n  // const sunSphere = new Mesh(\n  //     new SphereBufferGeometry( 20000, 16, 8 ),\n  //     new MeshBasicMaterial( { color: 0xffffff } )\n  // );\n  // sunSphere.position.y = - 700000;\n  // sunSphere.visible = false;\n  // scene.add( sunSphere );\n\n  var skyGeo = new SphereGeometry(1e5, 8, 8)\n  // flip faces so that overrideMaterial MeshDepthMatrial renders the skydome\n  // cf. https://stackoverflow.com/a/21485105/343834\n  for (let i = 0; i < skyGeo.faces.length; i++) {\n    const face = skyGeo.faces[i]\n    const temp = face.a\n    face.a = face.c\n    face.c = temp\n  }\n  var material = new MeshBasicMaterial({\n    opacity: 0\n  })\n  var skyDome = new Mesh(skyGeo, material)\n  skyDome.material.side = BackSide\n  scene.add(skyDome)\n\n  /// GUI\n\n  var effectController = {\n    turbidity: 10,\n    rayleigh: 2,\n    mieCoefficient: 0.005,\n    mieDirectionalG: 0.8,\n    luminance: 1,\n    inclination: 0.32, // elevation / inclination\n    azimuth: 0.2, // Facing front,\n    sun: !true\n  }\n\n  if (gui) {\n    var distance = 400000\n    function guiChanged () { // eslint-disable-line\n      var uniforms = sky.material.uniforms\n      uniforms.turbidity.value = effectController.turbidity\n      uniforms.rayleigh.value = effectController.rayleigh\n      uniforms.luminance.value = effectController.luminance\n      uniforms.mieCoefficient.value = effectController.mieCoefficient\n      uniforms.mieDirectionalG.value = effectController.mieDirectionalG\n\n      var theta = Math.PI * (effectController.inclination - 0.5)\n      var phi = 2 * Math.PI * (effectController.azimuth - 0.5)\n\n      sunPosition.x = distance * Math.cos(phi)\n      sunPosition.z = distance * Math.sin(phi) * Math.sin(theta)\n      sunPosition.y = distance * Math.sin(phi) * Math.cos(theta)\n\n        // sunSphere.visible = effectController.sun;\n\n      uniforms.sunPosition.value.copy(sunPosition)\n      sunPosition.copy(sunPosition)\n\n      dirLight.position.copy(sunPosition)\n      dirLight.position.normalize()\n      dirLight.position.multiplyScalar(2000.0)\n    }\n\n    const folder = gui.addFolder('Sun, sky and ocean')\n    folder.add(effectController, 'turbidity', 1.0, 20.0, 0.1).onChange(guiChanged)\n    folder.add(effectController, 'rayleigh', 0.0, 4, 0.001).onChange(guiChanged)\n    folder.add(effectController, 'mieCoefficient', 0.0, 0.1, 0.001).onChange(guiChanged)\n    folder.add(effectController, 'mieDirectionalG', 0.0, 1, 0.001).onChange(guiChanged)\n    folder.add(effectController, 'luminance', 0.0, 2).onChange(guiChanged)\n    folder.add(effectController, 'inclination', 0, 1, 0.0001).onChange(guiChanged)\n    folder.add(effectController, 'azimuth', 0, 1, 0.0001).onChange(guiChanged)\n    folder.add(effectController, 'sun').onChange(guiChanged)\n\n    guiChanged()\n  }\n\n  return sky\n}\n\nexport {initSky}\n","import {\n  ShaderMaterial,\n  TextureLoader,\n  RepeatWrapping,\n  UniformsLib,\n  Vector2,\n  Matrix3\n} from 'three'\nimport vertexShader from './meshphysical_vert.glsl'\nimport fragmentShader from './meshphysical_frag.glsl'\n\nconst textureLoader = new TextureLoader().setCrossOrigin('anonymous')\n\nconst rockTexture = textureLoader.load(require('../../textures/Rock_08_UV_H_CM_1.jpg'))\nconst rockTextureNormal = textureLoader.load(require('../../textures/Rock_08_UV_H_CM_1_normal.jpg'))\n// const rockTexture = textureLoader.load(require('../../textures/rock_brown_1600.jpg'))\nconst grassTexture = textureLoader.load(require('../../textures/GrassGreenTexture0003.jpg'))\nconst grassTextureNormal = textureLoader.load(require('../../textures/GrassGreenTexture0003_normal.jpg'))\n// const grassTexture = textureLoader.load(require('../../textures/rainforest512.jpg'))\n// const grassTexture2 = textureLoader.load(require('../../textures/Grass_01_UV_H_CM_1.jpg'))\n// const icyTexture = textureLoader.load(require('../../textures/snow_scuffed_ground_1.jpg'))\n// const snowTexture = textureLoader.load(require('../../textures/Snow_01_UV_H_CM_1.jpg'))\n// const envmapTexture = textureLoader.load(require('../../textures/envmap.jpg'))\nrockTexture.wrapS = rockTexture.wrapT = RepeatWrapping\nrockTexture.offset.set(0, 0)\nrockTexture.repeat.set(20, 20)\nrockTextureNormal.wrapS = rockTextureNormal.wrapT = RepeatWrapping\ngrassTexture.wrapS = grassTexture.wrapT = RepeatWrapping\ngrassTextureNormal.wrapS = grassTextureNormal.wrapT = RepeatWrapping\n// grassTexture2.wrapS = grassTexture2.wrapT = RepeatWrapping\n// icyTexture.wrapS = icyTexture.wrapT = RepeatWrapping\n// snowTexture.wrapS = snowTexture.wrapT = RepeatWrapping\n\nconst Material = (options, uniforms) => {\n  const material = new ShaderMaterial({\n    uniforms: {\n      opacity: {value: 1.0},\n      clearCoat: {value: 0.0},\n      clearCoatRoughness: {value: 0.0},\n      roughness: {value: 0.0},\n      metalness: {value: 0.0},\n      ...UniformsLib.common,\n      ...UniformsLib.lights,\n      ...UniformsLib.specularMap,\n      ...UniformsLib.envmap,\n      ...UniformsLib.aomap,\n      ...UniformsLib.lightmap,\n      ...UniformsLib.emissivemap,\n      ...UniformsLib.bumpmap,\n      ...UniformsLib.normalmap,\n      ...UniformsLib.displacementmap,\n      ...UniformsLib.roughnessmap,\n      ...UniformsLib.metalnessmap,\n      ...UniformsLib.gradientmap,\n      ...UniformsLib.fog,\n      ...UniformsLib.points,\n      // spectral: {value: spectralTexture},\n      rockTexture: {value: rockTexture},\n      rockTextureNormal: {value: rockTextureNormal},\n      // grassTexture: {value: grassTexture},\n      // grassTextureNormal: {value: grassTextureNormal},\n      // icyTexture: {value: icyTexture},\n      // snowTexture: {value: snowTexture},\n      // sunPosition: {value: sunPosition},\n      ...uniforms\n    },\n    defines: {\n      PHYSICAL: '',\n      USE_MAP: '',\n      USE_NORMALMAP: '',\n      USE_ENVMAP: '',\n      ENVMAP_TYPE_CUBE: '',\n      ENVMAP_BLENDING_MULTIPLY: '',\n      TONE_MAPPING: ''\n    },\n    vertexShader,\n    fragmentShader,\n    extensions: {\n      derivatives: true\n    },\n    wireframe: false,\n    lights: true,\n    fog: true\n    // transparent: true,\n    // ...options,\n  })\n  material.uniforms.map.value = grassTexture\n  material.uniforms.normalMap.value = grassTextureNormal\n  // material.uniforms.envMap.value = envmapTexture\n  material.uniforms.toneMappingExposure = {value: 3}\n  material.uniforms.toneMappingWhitePoint = {value: 5}\n  // material.uniforms.normalScale = {value: 5}\n  material.opacity = 1.0\n  material.roughness = 1\n  material.metalness = 0\n  material.lightMapIntensity = 1.0\n  material.aoMapIntensity = 1.0\n  material.emissiveIntensity = 1.0\n  material.envMapIntensity = 1\n  material.refractionRatio = 0.98\n  material.bumpscale = 1.0\n  material.normalScale = new Vector2(5, 5)\n  material.uniforms.reflectivity.value = 0.5\n  material.clearCoatRoughness = 0.0\n\n  // needed for WebGLProgram to unroll loops\n  // cf. https://github.com/mrdoob/three.js/pull/12323\n  material.isShaderMaterial = false\n  material.isMeshStandardMaterial = true\n  material.isMeshPhysicalMaterial = true\n  // repeat the texture 20 times\n  material.uniforms.uvTransform.value = new Matrix3().multiplyScalar(20)\n\n  material.needsUpdate = true\n  return material\n}\n\nexport {Material}\n","import {\n  ShaderMaterial,\n  TextureLoader,\n  RepeatWrapping,\n  UniformsLib,\n  Matrix3\n} from 'three'\nimport vertexShader from './meshstandard_vert.glsl'\nimport fragmentShader from './meshstandard_frag.glsl'\n\nconst textureLoader = new TextureLoader().setCrossOrigin('anonymous')\n\nconst rockTexture = textureLoader.load(require('../../textures/Rock_08_UV_H_CM_1.jpg'))\nconst rockTextureNormal = textureLoader.load(require('../../textures/Rock_08_UV_H_CM_1_normal.jpg'))\n// const rockTexture = textureLoader.load(require('../../textures/rock_brown_1600.jpg'))\nconst grassTexture = textureLoader.load(require('../../textures/GrassGreenTexture0003.jpg'))\nconst grassTextureNormal = textureLoader.load(require('../../textures/GrassGreenTexture0003_normal.jpg'))\n// const grassTexture = textureLoader.load(require('../../textures/rainforest512.jpg'))\n// const grassTexture2 = textureLoader.load(require('../../textures/Grass_01_UV_H_CM_1.jpg'))\n// const icyTexture = textureLoader.load(require('../../textures/snow_scuffed_ground_1.jpg'))\n// const snowTexture = textureLoader.load(require('../../textures/Snow_01_UV_H_CM_1.jpg'))\n// const envmapTexture = textureLoader.load(require('../../textures/envmap.jpg'))\nrockTexture.wrapS = rockTexture.wrapT = RepeatWrapping\nrockTexture.offset.set(0, 0)\nrockTexture.repeat.set(20, 20)\nrockTextureNormal.wrapS = rockTextureNormal.wrapT = RepeatWrapping\ngrassTexture.wrapS = grassTexture.wrapT = RepeatWrapping\ngrassTextureNormal.wrapS = grassTextureNormal.wrapT = RepeatWrapping\n// grassTexture.offset.set(0, 0);\n// grassTexture.repeat.set( 20, 20 );\n// grassTexture2.wrapS = grassTexture2.wrapT = RepeatWrapping\n// icyTexture.wrapS = icyTexture.wrapT = RepeatWrapping\n// snowTexture.wrapS = snowTexture.wrapT = RepeatWrapping\n\nconst MaterialBasic = (options, uniforms) => {\n  const material = new ShaderMaterial({\n    uniforms: {\n      // opacity: {value: 1.0},\n      // clearCoat: {value: 0.0},\n      // clearCoatRoughness: {value: 0.0},\n      roughness: {value: 0.7},\n      metalness: {value: 0.0},\n      ...UniformsLib.common,\n      ...UniformsLib.lights,\n      // ...UniformsLib.specularMap,\n      ...UniformsLib.envmap,\n      // ...UniformsLib.aomap,\n      // ...UniformsLib.lightmap,\n      // ...UniformsLib.emissivemap,\n      // ...UniformsLib.bumpmap,\n      ...UniformsLib.normalmap,\n      // ...UniformsLib.displacementmap,\n      // ...UniformsLib.roughnessmap,\n      // ...UniformsLib.metalnessmap,\n      // ...UniformsLib.gradientmap,\n      ...UniformsLib.fog,\n      // ...UniformsLib.points,\n      // spectral: {value: spectralTexture},\n      rockTexture: {value: rockTexture},\n      rockTextureNormal: {value: rockTextureNormal},\n      // grassTexture: {value: grassTexture},\n      // grassTextureNormal: {value: grassTextureNormal},\n      // icyTexture: {value: icyTexture},\n      // snowTexture: {value: snowTexture},\n      // sunPosition: {value: sunPosition},\n      ...uniforms\n    },\n    defines: {\n      STANDARD: '',\n      USE_MAP: '',\n      // USE_ENVMAP: '',\n      USE_NORMALMAP: ''\n      // TONE_MAPPING: ''\n      // FLAT_SHADED: '',\n    },\n    vertexShader,\n    fragmentShader,\n    extensions: {\n      derivatives: true\n    },\n    wireframe: false,\n    lights: true,\n    fog: true\n    // transparent: true,\n    // ...options,\n  })\n  material.uniforms.map.value = grassTexture\n  material.uniforms.normalMap.value = grassTextureNormal\n  // material.uniforms.envMap.value = envmapTexture\n  // material.uniforms.toneMappingExposure = {value: 3}\n  // material.uniforms.toneMappingWhitePoint = {value: 5}\n  // material.uniforms.normalScale = {value: 5}\n  // material.opacity = 1.0\n  material.roughness = 0.7\n  material.metalness = 0\n  // material.lightMapIntensity = 1.0\n  // material.aoMapIntensity = 1.0\n  // material.emissiveIntensity = 1.0\n  // material.envMapIntensity = 1\n  // material.refractionRatio = 0.98\n  // material.bumpscale = 1.0\n  // material.normalScale = new Vector2(5, 5)\n  // material.uniforms.reflectivity.value = 0.5\n  // material.clearCoatRoughness = 0.0\n\n  // needed for WebGLProgram to unroll loops\n  // cf. https://github.com/mrdoob/three.js/pull/12323\n  material.isShaderMaterial = false\n  material.isMeshStandardMaterial = true\n  // material.isMeshPhysicalMaterial = true\n  // repeat the texture 20 times\n  material.uniforms.uvTransform.value = new Matrix3().multiplyScalar(20)\n\n  material.needsUpdate = true\n  return material\n}\n\nexport {MaterialBasic}\n","import {\n  Mesh,\n  BufferAttribute,\n  BufferGeometry\n} from 'three'\nimport {renderer, scene, options} from '../index'\n// import SimplifyModifier from '../modules/meshSimplify'\nimport Worker from './terrain.worker.js'\nimport {Material} from './shaders/material'\nimport {MaterialBasic} from './shaders/materialBasic'\n\n// const textureLoader = new TextureLoader().setCrossOrigin('anonymous')\n// const spectralTexture = textureLoader.load(\n//   'https://raw.githubusercontent.com/d3/d3-scale-chromatic/master/img/Spectral.png'\n// )\n\nconst materialBasic = MaterialBasic()\n\n// cf. http://wiki.openstreetmap.org/wiki/Slippy_map_tilenames#ECMAScript_.28JavaScript.2FActionScript.2C_etc..29\nconst long2tile = (lon, zoom) => {\n  return (lon + 180) / 360 * Math.pow(2, zoom)\n}\nconst lat2tile = (lat, zoom) => {\n  return (\n    (1 - Math.log(Math.tan(lat * Math.PI / 180) + 1 / Math.cos(lat * Math.PI / 180)) / Math.PI) / 2 * Math.pow(2, zoom)\n  )\n}\nconst offset = {y: 45.8671, x: 7.3087}\nconst chamonix = {x: long2tile(offset.x, 10), y: lat2tile(offset.y, 10)}\nconst offsetAtZ = (z) => {\n  return {\n    x: chamonix.x / Math.pow(2, 10 - z),\n    y: chamonix.y / Math.pow(2, 10 - z)\n  }\n}\nwindow.chamonix = chamonix\nconst setTilePosition = (geometry, key) => {\n  const zxyijs = key.split(',').map(x => parseInt(x, 10))\n  const z = zxyijs[0]\n  const x = zxyijs[1]\n  const y = zxyijs[2]\n  const size = zxyijs[5]\n  const offset = offsetAtZ(z)\n  geometry.position.set(\n    x * size - (offset.x % 1 - 0.5) * size - (1 - chamonix.x % 1) * 800,\n    -y * size + (offset.y % 1 - 0.5) * size + (1 - chamonix.y % 1) * 800,\n    0\n  )\n}\n\n// PBR\nconst material = Material({}, {})\n\nconst buildTileFromWorker = event => {\n  const geometry = new BufferGeometry()\n  const positions = new Float32Array(event.data.positions)\n  const normals = new Float32Array(event.data.normals)\n  const IndexArrayClass = {\n    2: Uint16Array,\n    4: Uint32Array\n  }[event.data.bpe.indices]\n  const index = new IndexArrayClass(event.data.indices)\n  // const dem = new Uint8Array(event.data.dem)\n  let uv = new Float32Array(positions.length / 3 * 2)\n  const n = Math.sqrt(positions.length / 3)\n  uv = uv.map((_, index) => index % 2 ? Math.floor((index / 2) / n) / n : (index / 2) % n / n)\n  geometry.addAttribute('position', new BufferAttribute(positions, 3))\n  geometry.addAttribute('normal', new BufferAttribute(normals, 3))\n  geometry.addAttribute('uv', new BufferAttribute(uv, 2))\n  geometry.setIndex(new BufferAttribute(index, 1))\n  geometry.computeBoundingBox()\n\n  const terrainMaterial = options.PBR ? material : materialBasic\n  const plane = new Mesh(geometry, terrainMaterial)\n\n  plane.key = event.data.key\n  plane.castShadow = true\n  plane.receiveShadow = true\n  setTilePosition(plane, event.data.key)\n  scene.add(plane)\n  renderer.shadowMap.needsUpdate = true\n}\n\nlet workerPool = []\nconst workerPoolSize = navigator.hardwareConcurrency - 1 || 3\nfor (let i = 0; i < workerPoolSize; i++) {\n  const worker = new Worker()\n  worker.onmessage = buildTileFromWorker\n  workerPool.push(worker)\n}\nlet currentWorker = 0\nworkerPool.postMessage = args => {\n  const worker = workerPool[currentWorker]\n  worker.postMessage(args)\n  currentWorker = currentWorker === workerPoolSize - 1 ? 0 : currentWorker + 1\n}\n\nconst buildPlane = (z, x, y, segments, j, size) => {\n  workerPool.postMessage([z, x, y, segments, j, size])\n}\n\nexport {\n  buildPlane,\n  material\n}\n","import {\n  Vector3\n} from 'three'\nimport {camera, scene, drone} from '../index'\nimport {dirLight} from '../lights'\nimport {buildPlane} from '../terrain'\n\nconst tileSize = 800\nconst maxTilesInMemory = 128\nlet lastCameraPosition = new Vector3(0, 0, 0)\nlet tiles = {}\nlet pngs = {}\nlet currentKeysArray = []\nwindow.tiles = tiles\nwindow.pngs = pngs\n\nlet camVec = new Vector3()\nconst tileBuilder = (timestamp) => {\n  const cameraPosition = camera.position\n  camVec = camera.getWorldDirection(camVec)\n  let targetPosition = cameraPosition.clone()\n\n  targetPosition = targetPosition.add(camVec.multiplyScalar(400 * Math.max(1, Math.abs(cameraPosition.z) / 400)))\n  drone.position.set(targetPosition.x, targetPosition.y, 200)\n  dirLight.updatePosition()\n\n  if (cameraPosition.distanceTo(lastCameraPosition) > 10) {\n    lastCameraPosition = cameraPosition.clone()\n\n    const z0 = 10\n    const zoomDelta = Math.min(7, Math.floor(Math.sqrt(Math.abs(cameraPosition.z)) / 28))\n    // const zoomDelta = 0\n    const zoom = z0 - zoomDelta\n    const currentTileSize = tileSize * Math.pow(2, zoomDelta)\n\n    const x0 = Math.round(targetPosition.x / currentTileSize)\n    const y0 = -Math.round(targetPosition.y / currentTileSize)\n\n    const segments0 = cameraPosition.z > 2000 ? 127 : 255\n    const segments1 = cameraPosition.z > 2000 ? 31 : 63\n    // const segments0 = 32\n    // const segments1 = 15\n    const segments2 = 15\n\n    const cutOffDistance = currentTileSize * 3\n    let distanceVector = new Vector3()\n    let cameraXY = new Vector3()\n    let objectXY = new Vector3()\n    let distance\n\n    let visibleKeysArray = [\n        [zoom, x0, y0, segments0, 0, currentTileSize],\n        [zoom, x0, y0 + 1, segments0, 0, currentTileSize],\n        [zoom, x0 + 1, y0, segments0, 0, currentTileSize],\n        [zoom, x0 + 1, y0 + 1, segments0, 0, currentTileSize],\n\n        [zoom, x0 - 1, y0 - 1, segments1, 0, currentTileSize],\n        [zoom, x0 - 1, y0 - 0, segments1, 0, currentTileSize],\n        [zoom, x0 - 1, y0 + 1, segments1, 0, currentTileSize],\n        [zoom, x0 - 1, y0 + 2, segments1, 0, currentTileSize],\n\n        [zoom, x0 + 2, y0 - 1, segments1, 0, currentTileSize],\n        [zoom, x0 + 2, y0 - 0, segments1, 0, currentTileSize],\n        [zoom, x0 + 2, y0 + 1, segments1, 0, currentTileSize],\n        [zoom, x0 + 2, y0 + 2, segments1, 0, currentTileSize],\n\n        [zoom, x0, y0 - 1, segments1, 0, currentTileSize],\n        [zoom, x0, y0 + 2, segments1, 0, currentTileSize],\n        [zoom, x0 + 1, y0 - 1, segments1, 0, currentTileSize],\n        [zoom, x0 + 1, y0 + 2, segments1, 0, currentTileSize],\n\n        [zoom, x0 - 2, y0 - 2, segments2, 0, currentTileSize],\n        [zoom, x0 - 2, y0 - 1, segments2, 0, currentTileSize],\n        [zoom, x0 - 2, y0 - 0, segments2, 0, currentTileSize],\n        [zoom, x0 - 2, y0 + 1, segments2, 0, currentTileSize],\n        [zoom, x0 - 2, y0 + 2, segments2, 0, currentTileSize],\n        [zoom, x0 - 2, y0 + 3, segments2, 0, currentTileSize],\n\n        [zoom, x0 + 3, y0 - 2, segments2, 0, currentTileSize],\n        [zoom, x0 + 3, y0 - 1, segments2, 0, currentTileSize],\n        [zoom, x0 + 3, y0 - 0, segments2, 0, currentTileSize],\n        [zoom, x0 + 3, y0 + 1, segments2, 0, currentTileSize],\n        [zoom, x0 + 3, y0 + 2, segments2, 0, currentTileSize],\n        [zoom, x0 + 3, y0 + 3, segments2, 0, currentTileSize],\n\n        [zoom, x0 - 1, y0 - 2, segments2, 0, currentTileSize],\n        [zoom, x0 - 1, y0 + 3, segments2, 0, currentTileSize],\n        [zoom, x0, y0 - 2, segments2, 0, currentTileSize],\n        [zoom, x0, y0 + 3, segments2, 0, currentTileSize],\n        [zoom, x0 + 1, y0 - 2, segments2, 0, currentTileSize],\n        [zoom, x0 + 1, y0 + 3, segments2, 0, currentTileSize],\n        [zoom, x0 + 2, y0 - 2, segments2, 0, currentTileSize],\n        [zoom, x0 + 2, y0 + 3, segments2, 0, currentTileSize]\n\n    ]\n\n    // let camera = terrainTarget.native\n    // // camera.updateMatrix(); // make sure camera's local matrix is updated\n    // // camera.updateMatrixWorld(); // make sure camera's world matrix is updated\n    // // camera.matrixWorldInverse.getInverse( camera.matrixWorld );\n    // var frustum = new THREE.Frustum();\n    // frustum.setFromMatrix(new THREE.Matrix4().multiplyMatrices(camera.projectionMatrix, camera.matrixWorldInverse));\n    // console.log( frustum );\n\n    const visibleKeysString = visibleKeysArray.map(k => k.toString())\n    const currentKeysString = currentKeysArray.map(k => k.toString())\n\n    // compute tile under the camera\n    const potentialUnderKeys = visibleKeysString.slice(0, 4)\n    const potentialUnderTiles = scene.children.filter(child => potentialUnderKeys.includes(child.key))\n    const tileToCamera = (tile) => {\n      return distanceVector.subVectors(tile.position, camera.position).length()\n    }\n    potentialUnderTiles.sort((a, b) =>\n       tileToCamera(a) - tileToCamera(b)\n    )\n    camera.userData.terrainKeysUnder = potentialUnderKeys\n    camera.userData.terrainTileUnder = potentialUnderTiles[0]\n\n    const newKeys = visibleKeysString.filter(x => currentKeysString.indexOf(x) < 0)\n    const existingKeys = scene.children.filter(child => child.key).map(tile => tile.key)\n\n    // build new keys\n    newKeys.forEach(newKey => {\n      if (existingKeys.includes(newKey)) {\n        console.log(newKey, ' already exists!')\n        return\n      }\n      const zxyijs = newKey.split(',').map(x => parseInt(x, 10))\n      buildPlane(...zxyijs)\n    })\n\n    // switch tiles visibility with regard to their distance to the camera\n    scene.children.filter(child => child.key)\n      .forEach(tile => {\n        distance = distanceVector.subVectors(\n          objectXY.set(tile.position.x, tile.position.y, 0),\n          cameraXY.set(camera.position.x, camera.position.y, 0)\n        ).length()\n        tile.userData.distanceToCamera = distance\n        if (distance < cutOffDistance && visibleKeysString.includes(tile.key)) {\n          tile.visible = true\n        } else {\n          window.setTimeout(() => { tile.visible = false }, 750)\n        }\n      })\n\n    // delete some distant tiles\n    const deleteTile = (tile) => {\n      scene.remove(tile)\n      tile.geometry.dispose()\n      tile.geometry = null\n      tile.material.dispose()\n      tile.material = null\n    }\n    scene.children.filter(child => child.key)\n      .sort((a, b) => a.userData.distanceToCamera - b.userData.distanceToCamera)\n      .slice(maxTilesInMemory)\n      .forEach(tile => {\n        if (!tile.markedForDeletion) {\n          window.setTimeout(() => deleteTile(tile), 750)\n          tile.markedForDeletion = true\n        }\n      })\n\n    currentKeysArray = visibleKeysArray.slice(0)\n  }\n}\n\nexport {tileBuilder}\n","/**\n * @author zz85 / https://github.com/zz85 | twitter.com/blurspline\n *\n * Depth-of-field shader with bokeh\n * ported from GLSL shader by Martins Upitis\n * http://blenderartists.org/forum/showthread.php?237488-GLSL-depth-of-field-with-bokeh-v2-4-(update)\n *\n * Requires #define RINGS and SAMPLES integers\n */\n\nimport {Vector2} from 'three'\n\nconst BokehShader = {\n\n  uniforms: {\n\n    'textureWidth': { value: 1.0 },\n    'textureHeight': { value: 1.0 },\n\n    'focalDepth': { value: 1.0 },\n    'focalLength': { value: 24.0 },\n    'fstop': { value: 0.9 },\n\n    'tColor': { value: null },\n    'tDepth': { value: null },\n\n    'maxblur': { value: 1.0 },\n\n    'showFocus': { value: 0 },\n    'manualdof': { value: 0 },\n    'vignetting': { value: 0 },\n    'depthblur': { value: 0 },\n\n    'threshold': { value: 0.5 },\n    'gain': { value: 2.0 },\n    'bias': { value: 0.5 },\n    'fringe': { value: 0.7 },\n\n    'znear': { value: 0.1 },\n    'zfar': { value: 100 },\n\n    'noise': { value: 1 },\n    'dithering': { value: 0.0001 },\n    'pentagon': { value: 0 },\n\n    'shaderFocus': { value: 1 },\n    'focusCoords': { value: new Vector2() }\n\n  },\n\n  vertexShader: `\n\n        varying vec2 vUv;\n\n        void main() {\n\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n        }`,\n\n  fragmentShader: `\n\n#include <common>\n\nvarying vec2 vUv;\n\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nuniform float textureWidth;\nuniform float textureHeight;\n\nuniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below\nuniform float focalLength; //focal length in mm\nuniform float fstop; //f-stop value\nuniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)\n\n/*\nmake sure that these two values are the same for your camera, otherwise distances will be wrong.\n*/\n\nuniform float znear; // camera clipping start\nuniform float zfar; // camera clipping end\n\n//------------------------------------------\n//user variables\n\nconst int samples = SAMPLES; //samples on the first ring\nconst int rings = RINGS; //ring count\n\nconst int maxringsamples = rings * samples;\n\nuniform bool manualdof; // manual dof calculation\nfloat ndofstart = 1.0; // near dof blur start\nfloat ndofdist = 2.0; // near dof blur falloff distance\nfloat fdofstart = 1.0; // far dof blur start\nfloat fdofdist = 3.0; // far dof blur falloff distance\n\nfloat CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)\n\nuniform bool vignetting; // use optical lens vignetting\n\nfloat vignout = 1.3; // vignetting outer border\nfloat vignin = 0.0; // vignetting inner border\nfloat vignfade = 22.0; // f-stops till vignete fades\n\nuniform bool shaderFocus;\n// disable if you use external focalDepth value\n\nuniform vec2 focusCoords;\n// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)\n// if center of screen use vec2(0.5, 0.5);\n\nuniform float maxblur;\n//clamp value of max blur (0.0 = no blur, 1.0 default)\n\nuniform float threshold; // highlight threshold;\nuniform float gain; // highlight gain;\n\nuniform float bias; // bokeh edge bias\nuniform float fringe; // bokeh chromatic aberration / fringing\n\nuniform bool noise; //use noise instead of pattern for sample dithering\n\nuniform float dithering;\n\nuniform bool depthblur; // blur the depth buffer\nfloat dbsize = 1.25; // depth blur size\n\n/*\nnext part is experimental\nnot looking good with small sample and ring count\nlooks okay starting from samples = 4, rings = 4\n*/\n\nuniform bool pentagon; //use pentagon as bokeh shape?\nfloat feather = 0.4; //pentagon shape feather\n\n//------------------------------------------\n\nfloat penta(vec2 coords) {\n    //pentagonal shape\n    float scale = float(rings) - 1.3;\n    vec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);\n    vec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);\n    vec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);\n    vec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);\n    vec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);\n    vec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);\n\n    vec4  one = vec4( 1.0 );\n\n    vec4 P = vec4((coords),vec2(scale, scale));\n\n    vec4 dist = vec4(0.0);\n    float inorout = -4.0;\n\n    dist.x = dot( P, HS0 );\n    dist.y = dot( P, HS1 );\n    dist.z = dot( P, HS2 );\n    dist.w = dot( P, HS3 );\n\n    dist = smoothstep( -feather, feather, dist );\n\n    inorout += dot( dist, one );\n\n    dist.x = dot( P, HS4 );\n    dist.y = HS5.w - abs( P.z );\n\n    dist = smoothstep( -feather, feather, dist );\n    inorout += dist.x;\n\n    return clamp( inorout, 0.0, 1.0 );\n}\n\nfloat bdepth(vec2 coords) {\n    // Depth buffer blur\n    float d = 0.0;\n    float kernel[9];\n    vec2 offset[9];\n\n    vec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;\n\n    offset[0] = vec2(-wh.x,-wh.y);\n    offset[1] = vec2( 0.0, -wh.y);\n    offset[2] = vec2( wh.x -wh.y);\n\n    offset[3] = vec2(-wh.x,  0.0);\n    offset[4] = vec2( 0.0,   0.0);\n    offset[5] = vec2( wh.x,  0.0);\n\n    offset[6] = vec2(-wh.x, wh.y);\n    offset[7] = vec2( 0.0,  wh.y);\n    offset[8] = vec2( wh.x, wh.y);\n\n    kernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;\n    kernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;\n    kernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;\n\n\n    for( int i=0; i<9; i++ ) {\n        float tmp = texture2D(tDepth, coords + offset[i]).r;\n        d += tmp * kernel[i];\n    }\n\n    return d;\n}\n\n\nvec3 color(vec2 coords,float blur) {\n    //processing the sample\n\n    vec3 col = vec3(0.0);\n    vec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);\n\n    col.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;\n    col.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;\n    col.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;\n\n    vec3 lumcoeff = vec3(0.299,0.587,0.114);\n    float lum = dot(col.rgb, lumcoeff);\n    float thresh = max((lum-threshold)*gain, 0.0);\n    return col+mix(vec3(0.0),col,thresh*blur);\n}\n\nvec3 debugFocus(vec3 col, float blur, float depth) {\n    float edge = 0.002*depth; //distance based edge smoothing\n    float m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);\n    float e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);\n\n    col = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);\n    col = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);\n\n    return col;\n}\n\nfloat linearize(float depth) {\n    return -zfar * znear / (depth * (zfar - znear) - zfar);\n}\n\n\nfloat vignette() {\n    float dist = distance(vUv.xy, vec2(0.5,0.5));\n    dist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);\n    return clamp(dist,0.0,1.0);\n}\n\nfloat gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {\n    float rings2 = float(rings);\n    float step = PI*2.0 / float(ringsamples);\n    float pw = cos(j*step)*i;\n    float ph = sin(j*step)*i;\n    float p = 1.0;\n    if (pentagon) {\n        p = penta(vec2(pw,ph));\n    }\n    col += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;\n    return 1.0 * mix(1.0, i /rings2, bias) * p;\n}\n\nvoid main() {\n    //scene depth calculation\n\n    float depth = linearize(texture2D(tDepth,vUv.xy).x);\n\n    // Blur depth?\n    if (depthblur) {\n        depth = linearize(bdepth(vUv.xy));\n    }\n\n    //focal plane calculation\n\n    float fDepth = focalDepth;\n\n    if (shaderFocus) {\n\n        fDepth = linearize(texture2D(tDepth,focusCoords).x);\n\n    }\n\n    // dof blur factor calculation\n\n    float blur = 0.0;\n\n    if (manualdof) {\n        float a = depth-fDepth; // Focal plane\n        float b = (a-fdofstart)/fdofdist; // Far DoF\n        float c = (-a-ndofstart)/ndofdist; // Near Dof\n        blur = (a>0.0) ? b : c;\n    } else {\n        float f = focalLength; // focal length in mm\n        float d = fDepth*1000.0; // focal plane in mm\n        float o = depth*1000.0; // depth in mm\n\n        float a = (o*f)/(o-f);\n        float b = (d*f)/(d-f);\n        float c = (d-f)/(d*fstop*CoC);\n\n        blur = abs(a-b)*c;\n    }\n\n    blur = clamp(blur,0.0,1.0);\n\n    // calculation of pattern for dithering\n\n    vec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;\n\n    // getting blur x and y step factor\n\n    float w = (1.0/textureWidth)*blur*maxblur+noise.x;\n    float h = (1.0/textureHeight)*blur*maxblur+noise.y;\n\n    // calculation of final color\n\n    vec3 col = vec3(0.0);\n\n    if(blur < 0.05) {\n        //some optimization thingy\n        col = texture2D(tColor, vUv.xy).rgb;\n    } else {\n        col = texture2D(tColor, vUv.xy).rgb;\n        float s = 1.0;\n        int ringsamples;\n\n        for (int i = 1; i <= rings; i++) {\n            /*unboxstart*/\n            ringsamples = i * samples;\n\n            for (int j = 0 ; j < maxringsamples ; j++) {\n                if (j >= ringsamples) break;\n                s += gather(float(i), float(j), ringsamples, col, w, h, blur);\n            }\n            /*unboxend*/\n        }\n\n        col /= s; //divide by sample count\n    }\n\n    if (showFocus) {\n        col = debugFocus(col, blur, depth);\n    }\n\n    if (vignetting) {\n        col *= vignette();\n    }\n\n    gl_FragColor.rgb = col;\n    // gl_FragColor.rgb = vec3(blur);\n    // gl_FragColor.rgb = texture2D(tDepth,vUv.xy).xyz;\n    // gl_FragColor.rgb = texture2D(tColor,vUv.xy).xyz;\n    gl_FragColor.a = 1.0;\n}\n`\n\n}\n\nexport default BokehShader\n","/**\n * @author alteredq / http://alteredqualia.com/\n *\n * Full-screen textured quad shader\n */\n\nconst CopyShader = {\n\n  uniforms: {\n\n    'tDiffuse': { value: null },\n    'opacity': { value: 1.0 }\n\n  },\n\n  vertexShader: [\n\n    'varying vec2 vUv;',\n\n    'void main() {',\n\n    'vUv = uv;',\n    'gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );',\n\n    '}'\n\n  ].join('\\n'),\n\n  fragmentShader: [\n\n    'uniform float opacity;',\n\n    'uniform sampler2D tDiffuse;',\n\n    'varying vec2 vUv;',\n\n    'void main() {',\n\n    'vec4 texel = texture2D( tDiffuse, vUv );',\n    'gl_FragColor = opacity * texel;',\n\n    '}'\n\n  ].join('\\n')\n\n}\n\nexport default CopyShader\n","const Pass = function () {\n    // if set to true, the pass is processed by the composer\n  this.enabled = true\n\n    // if set to true, the pass indicates to swap read and write buffer after rendering\n  this.needsSwap = true\n\n    // if set to true, the pass clears its buffer before rendering\n  this.clear = false\n\n    // if set to true, the result of the pass is rendered to screen\n  this.renderToScreen = false\n}\n\nObject.assign(Pass.prototype, {\n\n  setSize: function (width, height) {},\n\n  render: function (renderer, writeBuffer, readBuffer, delta, maskActive) {\n    console.error('Pass: .render() must be implemented in derived pass.')\n  }\n\n})\n\nexport default Pass\n","/**\n * @author alteredq / http://alteredqualia.com/\n */\n\nimport {\n  ShaderMaterial,\n  UniformsUtils,\n  OrthographicCamera,\n  Scene,\n  Mesh,\n  PlaneBufferGeometry\n} from 'three'\nimport Pass from './Pass'\n\nconst ShaderPass = function (shader, textureID) {\n  Pass.call(this)\n\n  this.textureID = (textureID !== undefined) ? textureID : 'tDiffuse'\n\n  if (shader instanceof ShaderMaterial) {\n    this.uniforms = shader.uniforms\n\n    this.material = shader\n  } else if (shader) {\n    this.uniforms = UniformsUtils.clone(shader.uniforms)\n\n    this.material = new ShaderMaterial({\n\n      defines: shader.defines || {},\n      uniforms: this.uniforms,\n      vertexShader: shader.vertexShader,\n      fragmentShader: shader.fragmentShader\n\n    })\n  }\n\n  this.camera = new OrthographicCamera(-1, 1, 1, -1, 0, 1)\n  this.scene = new Scene()\n\n  this.quad = new Mesh(new PlaneBufferGeometry(2, 2), null)\n  this.quad.frustumCulled = false // Avoid getting clipped\n  this.scene.add(this.quad)\n}\n\nShaderPass.prototype = Object.assign(Object.create(Pass.prototype), {\n\n  constructor: ShaderPass,\n\n  render: function (renderer, writeBuffer, readBuffer, delta, maskActive) {\n    if (this.uniforms[ this.textureID ]) {\n      this.uniforms[ this.textureID ].value = readBuffer.texture\n    }\n\n    this.quad.material = this.material\n\n    if (this.renderToScreen) {\n      renderer.render(this.scene, this.camera)\n    } else {\n      renderer.render(this.scene, this.camera, writeBuffer, this.clear)\n    }\n  }\n\n})\n\nexport default ShaderPass\n","/**\n * @author alteredq / http://alteredqualia.com/\n */\n\nimport Pass from './Pass'\n\nconst MaskPass = function (scene, camera) {\n  Pass.call(this)\n\n  this.scene = scene\n  this.camera = camera\n\n  this.clear = true\n  this.needsSwap = false\n\n  this.inverse = false\n}\n\nMaskPass.prototype = Object.assign(Object.create(Pass.prototype), {\n\n  constructor: MaskPass,\n\n  render: function (renderer, writeBuffer, readBuffer, delta, maskActive) {\n    var context = renderer.context\n    var state = renderer.state\n\n        // don't update color or depth\n\n    state.buffers.color.setMask(false)\n    state.buffers.depth.setMask(false)\n\n        // lock buffers\n\n    state.buffers.color.setLocked(true)\n    state.buffers.depth.setLocked(true)\n\n        // set up stencil\n\n    var writeValue, clearValue\n\n    if (this.inverse) {\n      writeValue = 0\n      clearValue = 1\n    } else {\n      writeValue = 1\n      clearValue = 0\n    }\n\n    state.buffers.stencil.setTest(true)\n    state.buffers.stencil.setOp(context.REPLACE, context.REPLACE, context.REPLACE)\n    state.buffers.stencil.setFunc(context.ALWAYS, writeValue, 0xffffffff)\n    state.buffers.stencil.setClear(clearValue)\n\n        // draw into the stencil buffer\n\n    renderer.render(this.scene, this.camera, readBuffer, this.clear)\n    renderer.render(this.scene, this.camera, writeBuffer, this.clear)\n\n        // unlock color and depth buffer for subsequent rendering\n\n    state.buffers.color.setLocked(false)\n    state.buffers.depth.setLocked(false)\n\n        // only render where stencil is set to 1\n\n    state.buffers.stencil.setFunc(context.EQUAL, 1, 0xffffffff)  // draw if == 1\n    state.buffers.stencil.setOp(context.KEEP, context.KEEP, context.KEEP)\n  }\n\n})\n\nconst ClearMaskPass = function () {\n  Pass.call(this)\n\n  this.needsSwap = false\n}\n\nClearMaskPass.prototype = Object.create(Pass.prototype)\n\nObject.assign(ClearMaskPass.prototype, {\n\n  render: function (renderer, writeBuffer, readBuffer, delta, maskActive) {\n    renderer.state.buffers.stencil.setTest(false)\n  }\n\n})\n\nexport {MaskPass, ClearMaskPass}\n","/**\n * @author alteredq / http://alteredqualia.com/\n */\nimport {\n  WebGLRenderTarget,\n  LinearFilter,\n  RGBAFormat\n\n} from 'three'\nimport ShaderPass from './ShaderPass'\nimport CopyShader from './CopyShader'\nimport {MaskPass, ClearMaskPass} from './MaskPass'\n\nconst EffectComposer = function (renderer, renderTarget) {\n  this.renderer = renderer\n\n  if (renderTarget === undefined) {\n    var parameters = {\n      minFilter: LinearFilter,\n      magFilter: LinearFilter,\n      format: RGBAFormat,\n      stencilBuffer: false\n    }\n\n    var size = renderer.getDrawingBufferSize()\n    renderTarget = new WebGLRenderTarget(size.width, size.height, parameters)\n    renderTarget.texture.name = 'EffectComposer.rt1'\n  }\n\n  this.renderTarget1 = renderTarget\n  this.renderTarget2 = renderTarget.clone()\n  this.renderTarget2.texture.name = 'EffectComposer.rt2'\n\n  this.writeBuffer = this.renderTarget1\n  this.readBuffer = this.renderTarget2\n\n  this.passes = []\n\n    // dependencies\n\n  if (CopyShader === undefined) {\n    console.error('EffectComposer relies on CopyShader')\n  }\n\n  if (ShaderPass === undefined) {\n    console.error('EffectComposer relies on ShaderPass')\n  }\n\n  this.copyPass = new ShaderPass(CopyShader)\n}\n\nObject.assign(EffectComposer.prototype, {\n\n  swapBuffers: function () {\n    var tmp = this.readBuffer\n    this.readBuffer = this.writeBuffer\n    this.writeBuffer = tmp\n  },\n\n  addPass: function (pass) {\n    this.passes.push(pass)\n\n    var size = this.renderer.getDrawingBufferSize()\n    pass.setSize(size.width, size.height)\n  },\n\n  insertPass: function (pass, index) {\n    this.passes.splice(index, 0, pass)\n  },\n\n  render: function (delta) {\n    var maskActive = false\n\n    let pass = this.passes.length\n    let i = pass\n    let il = pass\n\n    for (i = 0; i < il; i++) {\n      pass = this.passes[ i ]\n\n      if (pass.enabled === false) continue\n\n      pass.render(this.renderer, this.writeBuffer, this.readBuffer, delta, maskActive)\n\n      if (pass.needsSwap) {\n        if (maskActive) {\n          var context = this.renderer.context\n\n          context.stencilFunc(context.NOTEQUAL, 1, 0xffffffff)\n\n          this.copyPass.render(this.renderer, this.writeBuffer, this.readBuffer, delta)\n\n          context.stencilFunc(context.EQUAL, 1, 0xffffffff)\n        }\n\n        this.swapBuffers()\n      }\n\n      if (MaskPass !== undefined) {\n        if (pass instanceof MaskPass) {\n          maskActive = true\n        } else if (pass instanceof ClearMaskPass) {\n          maskActive = false\n        }\n      }\n    }\n  },\n\n  reset: function (renderTarget) {\n    if (renderTarget === undefined) {\n      var size = this.renderer.getDrawingBufferSize()\n\n      renderTarget = this.renderTarget1.clone()\n      renderTarget.setSize(size.width, size.height)\n    }\n\n    this.renderTarget1.dispose()\n    this.renderTarget2.dispose()\n    this.renderTarget1 = renderTarget\n    this.renderTarget2 = renderTarget.clone()\n\n    this.writeBuffer = this.renderTarget1\n    this.readBuffer = this.renderTarget2\n  },\n\n  setSize: function (width, height) {\n    this.renderTarget1.setSize(width, height)\n    this.renderTarget2.setSize(width, height)\n\n    for (var i = 0; i < this.passes.length; i++) {\n      this.passes[i].setSize(width, height)\n    }\n  }\n\n})\n\nexport default EffectComposer\n","/**\n * @author alteredq / http://alteredqualia.com/\n */\n\nimport Pass from './Pass'\n\nconst RenderPass = function (scene, camera, overrideMaterial, clearColor, clearAlpha) {\n  Pass.call(this)\n\n  this.scene = scene\n  this.camera = camera\n\n  this.overrideMaterial = overrideMaterial\n\n  this.clearColor = clearColor\n  this.clearAlpha = (clearAlpha !== undefined) ? clearAlpha : 0\n\n  this.clear = true\n  this.clearDepth = false\n  this.needsSwap = false\n}\n\nRenderPass.prototype = Object.assign(Object.create(Pass.prototype), {\n\n  constructor: RenderPass,\n\n  render: function (renderer, writeBuffer, readBuffer, delta, maskActive) {\n    var oldAutoClear = renderer.autoClear\n    renderer.autoClear = false\n\n    this.scene.overrideMaterial = this.overrideMaterial\n\n    var oldClearColor, oldClearAlpha\n\n    if (this.clearColor) {\n      oldClearColor = renderer.getClearColor().getHex()\n      oldClearAlpha = renderer.getClearAlpha()\n\n      renderer.setClearColor(this.clearColor, this.clearAlpha)\n    }\n\n    if (this.clearDepth) {\n      renderer.clearDepth()\n    }\n\n    renderer.render(this.scene, this.camera, this.renderToScreen ? null : readBuffer, this.clear)\n\n    if (this.clearColor) {\n      renderer.setClearColor(oldClearColor, oldClearAlpha)\n    }\n\n    this.scene.overrideMaterial = null\n    renderer.autoClear = oldAutoClear\n  }\n\n})\n\nexport default RenderPass\n","import {\n  MeshDepthMaterial,\n  UniformsUtils,\n  Vector2\n} from 'three'\nimport {\n  EffectComposer,\n  RenderPass,\n  BokehShader,\n  ShaderPass\n} from './'\n\nconst effectController = {\n  shaderFocus: true,\n\n  fstop: 3.0,\n  maxblur: 3.0,\n\n  showFocus: false,\n  focalDepth: 130,\n  manualdof: false,\n  vignetting: false,\n  depthblur: false,\n\n  threshold: 0.5,\n  gain: 2.0,\n  bias: 0.5,\n  fringe: 0.7,\n\n  focalLength: 15,\n  noise: true,\n  pentagon: false,\n\n  dithering: 0.0001\n\n}\n\nconst initDoF = (scene, renderer, camera, gui) => {\n  // depthmap is rendered to a first buffer\n  var composerDepth = new EffectComposer(renderer)\n  var renderPassDepth = new RenderPass(scene, camera)\n  renderPassDepth.overrideMaterial = new MeshDepthMaterial()\n  composerDepth.addPass(renderPassDepth)\n\n  // default rendering pass\n  var composer = new EffectComposer(renderer)\n  var renderPass = new RenderPass(scene, camera)\n  composer.addPass(renderPass)\n\n  // bokeh shader definition\n  const bokeh = {}\n  bokeh.uniforms = UniformsUtils.clone(BokehShader.uniforms)\n  bokeh.vertexShader = BokehShader.vertexShader\n  bokeh.fragmentShader = BokehShader.fragmentShader\n  bokeh.uniforms.focusCoords = {value: new Vector2(0.5, 0.5)}\n  bokeh.uniforms.textureWidth = {value: window.innerWidth}\n  bokeh.uniforms.textureHeight = {value: window.innerHeight}\n  bokeh.defines = {\n    RINGS: 3,\n    SAMPLES: 3\n  }\n\n  // depth of field pass\n  var shaderPass = new ShaderPass(bokeh, 'tColor')\n  shaderPass.renderToScreen = true\n  composer.addPass(shaderPass)\n\n  if (gui) {\n    var matChanger = function () {\n      for (var e in effectController) {\n        if (e in shaderPass.uniforms) { shaderPass.uniforms[ e ].value = effectController[ e ] }\n      }\n\n      shaderPass.uniforms[ 'znear' ].value = camera.near\n      shaderPass.uniforms[ 'zfar' ].value = camera.far\n      camera.setFocalLength(effectController.focalLength)\n    }\n\n    const folder = gui.addFolder('Depth of Field')\n\n    // folder.add( effectController, \"shaderFocus\" ).onChange( matChanger );\n    // folder.add( effectController, \"focalDepth\", 0.0, 500.0 ).listen().onChange( matChanger );\n\n    folder.add(effectController, 'fstop', 0.1, 10, 0.001).onChange(matChanger)\n    folder.add(effectController, 'maxblur', 0.0, 5.0, 0.025).onChange(matChanger)\n\n    folder.add(effectController, 'showFocus').onChange(matChanger)\n    // folder.add( effectController, \"manualdof\" ).onChange( matChanger );\n    folder.add(effectController, 'vignetting').onChange(matChanger)\n\n    // folder.add( effectController, \"depthblur\" ).onChange( matChanger );\n\n    folder.add(effectController, 'threshold', 0, 1, 0.001).onChange(matChanger)\n    folder.add(effectController, 'gain', 0, 100, 0.001).onChange(matChanger)\n    folder.add(effectController, 'bias', 0, 3, 0.001).onChange(matChanger)\n    folder.add(effectController, 'fringe', 0, 5, 0.001).onChange(matChanger)\n\n    folder.add(effectController, 'focalLength', 16, 80, 0.001).onChange(matChanger)\n\n    // folder.add( effectController, \"noise\" ).onChange( matChanger );\n\n    // folder.add( effectController, \"dithering\", 0, 0.001, 0.0001 ).onChange( matChanger );\n\n    // folder.add( effectController, \"pentagon\" ).onChange( matChanger );\n\n    matChanger()\n  }\n\n  return {\n    composerDepth,\n    //  in the main loop renderDepth must be called before composer.render()\n    renderDepth: () => {\n      composerDepth.render()\n      shaderPass.uniforms.tDepth.value = composerDepth.renderTarget2.texture\n    },\n    composer\n  }\n}\n\nexport default initDoF\n","/**\n * @author Mugen87 / https://github.com/Mugen87\n * @author mrdoob / http://mrdoob.com/\n */\nimport {\n    Mesh,\n    MeshBasicMaterial,\n    Vector3,\n    DataTexture,\n    RGBFormat,\n    NearestFilter,\n    ClampToEdgeWrapping,\n    RawShaderMaterial,\n    Color,\n    Vector2,\n    AdditiveBlending,\n    Box2,\n    Vector4,\n    BufferGeometry,\n    InterleavedBuffer,\n    InterleavedBufferAttribute\n} from 'three'\n\nconst Lensflare = function () {\n  Mesh.call(this, Lensflare.Geometry, new MeshBasicMaterial({ opacity: 0, transparent: true }))\n\n  this.type = 'Lensflare'\n  this.frustumCulled = false\n  this.renderOrder = Infinity\n\n    //\n\n  var positionScreen = new Vector3()\n\n    // textures\n\n  var tempMap = new DataTexture(new Uint8Array(16 * 16 * 3), 16, 16, RGBFormat)\n  tempMap.minFilter = NearestFilter\n  tempMap.magFilter = NearestFilter\n  tempMap.wrapS = ClampToEdgeWrapping\n  tempMap.wrapT = ClampToEdgeWrapping\n  tempMap.needsUpdate = true\n\n  var occlusionMap = new DataTexture(new Uint8Array(16 * 16 * 3), 16, 16, RGBFormat)\n  occlusionMap.minFilter = NearestFilter\n  occlusionMap.magFilter = NearestFilter\n  occlusionMap.wrapS = ClampToEdgeWrapping\n  occlusionMap.wrapT = ClampToEdgeWrapping\n  occlusionMap.needsUpdate = true\n\n    // material\n\n  var geometry = Lensflare.Geometry\n\n  var material1a = new RawShaderMaterial({\n    uniforms: {\n      'scale': { value: null },\n      'screenPosition': { value: null }\n    },\n    vertexShader: [\n\n      'precision highp float;',\n\n      'uniform vec3 screenPosition;',\n      'uniform vec2 scale;',\n\n      'attribute vec3 position;',\n\n      'void main() {',\n\n      '   gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );',\n\n      '}'\n\n    ].join('\\n'),\n    fragmentShader: [\n\n      'precision highp float;',\n\n      'void main() {',\n\n      '   gl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );',\n\n      '}'\n\n    ].join('\\n'),\n    depthTest: true,\n    depthWrite: false,\n    transparent: false\n  })\n\n  var material1b = new RawShaderMaterial({\n    uniforms: {\n      'map': { value: tempMap },\n      'scale': { value: null },\n      'screenPosition': { value: null }\n    },\n    vertexShader: [\n\n      'precision highp float;',\n\n      'uniform vec3 screenPosition;',\n      'uniform vec2 scale;',\n\n      'attribute vec3 position;',\n      'attribute vec2 uv;',\n\n      'varying vec2 vUV;',\n\n      'void main() {',\n\n      '   vUV = uv;',\n\n      '   gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );',\n\n      '}'\n\n    ].join('\\n'),\n    fragmentShader: [\n\n      'precision highp float;',\n\n      'uniform sampler2D map;',\n\n      'varying vec2 vUV;',\n\n      'void main() {',\n\n      '   gl_FragColor = texture2D( map, vUV );',\n\n      '}'\n\n    ].join('\\n'),\n    depthTest: false,\n    depthWrite: false,\n    transparent: false\n  })\n\n    // the following object is used for occlusionMap generation\n\n  var mesh1 = new Mesh(geometry, material1a)\n\n    //\n\n  var elements = []\n\n  var shader = LensflareElement.Shader\n\n  var material2 = new RawShaderMaterial({\n    uniforms: {\n      'map': { value: null },\n      'occlusionMap': { value: occlusionMap },\n      'color': { value: new Color(0xffffff) },\n      'scale': { value: new Vector2() },\n      'screenPosition': { value: new Vector3() }\n    },\n    vertexShader: shader.vertexShader,\n    fragmentShader: shader.fragmentShader,\n    blending: AdditiveBlending,\n    transparent: true,\n    depthWrite: false\n  })\n\n  var mesh2 = new Mesh(geometry, material2)\n\n  this.addElement = function (element) {\n    elements.push(element)\n  }\n\n    //\n\n  var scale = new Vector2()\n  var screenPositionPixels = new Vector2()\n  var validArea = new Box2()\n  var viewport = new Vector4()\n\n  this.onBeforeRender = function (renderer, scene, camera) {\n    viewport.copy(renderer.getCurrentViewport())\n\n    var invAspect = viewport.w / viewport.z\n    var halfViewportWidth = viewport.z / 2.0\n    var halfViewportHeight = viewport.w / 2.0\n\n    var size = 16 / viewport.w\n    scale.set(size * invAspect, size)\n\n    validArea.min.set(viewport.x, viewport.y)\n    validArea.max.set(viewport.x + (viewport.z - 16), viewport.y + (viewport.w - 16))\n\n        // calculate position in screen space\n\n    positionScreen.setFromMatrixPosition(this.matrixWorld)\n\n    positionScreen.applyMatrix4(camera.matrixWorldInverse)\n    positionScreen.applyMatrix4(camera.projectionMatrix)\n\n        // horizontal and vertical coordinate of the lower left corner of the pixels to copy\n\n    screenPositionPixels.x = viewport.x + (positionScreen.x * halfViewportWidth) + halfViewportWidth - 8\n    screenPositionPixels.y = viewport.y + (positionScreen.y * halfViewportHeight) + halfViewportHeight - 8\n\n        // screen cull\n\n    if (validArea.containsPoint(screenPositionPixels)) {\n            // save current RGB to temp texture\n\n      renderer.copyFramebufferToTexture(screenPositionPixels, tempMap)\n\n            // render pink quad\n\n      var uniforms = material1a.uniforms\n      uniforms.scale.value = scale\n      uniforms.screenPosition.value = positionScreen\n\n      renderer.renderBufferDirect(camera, null, geometry, material1a, mesh1, null)\n\n            // copy result to occlusionMap\n\n      renderer.copyFramebufferToTexture(screenPositionPixels, occlusionMap)\n\n            // restore graphics\n\n      var uniforms = material1b.uniforms\n      uniforms.scale.value = scale\n      uniforms.screenPosition.value = positionScreen\n\n      renderer.renderBufferDirect(camera, null, geometry, material1b, mesh1, null)\n\n            // render elements\n\n      var vecX = -positionScreen.x * 2\n      var vecY = -positionScreen.y * 2\n\n      for (var i = 0, l = elements.length; i < l; i++) {\n        var element = elements[ i ]\n\n        var uniforms = material2.uniforms\n\n        uniforms.color.value.copy(element.color)\n        uniforms.map.value = element.texture\n        uniforms.screenPosition.value.x = positionScreen.x + vecX * element.distance\n        uniforms.screenPosition.value.y = positionScreen.y + vecY * element.distance\n\n        var size = element.size / viewport.w\n        var invAspect = viewport.w / viewport.z\n\n        uniforms.scale.value.set(size * invAspect, size)\n\n        material2.uniformsNeedUpdate = true\n\n        renderer.renderBufferDirect(camera, null, geometry, material2, mesh2, null)\n      }\n    }\n  }\n\n  this.dispose = function () {\n    material1a.dispose()\n    material1b.dispose()\n    material2.dispose()\n\n    tempMap.dispose()\n    occlusionMap.dispose()\n\n    for (var i = 0, l = elements.length; i < l; i++) {\n      elements[ i ].texture.dispose()\n    }\n  }\n}\n\nLensflare.prototype = Object.create(Mesh.prototype)\nLensflare.prototype.constructor = Lensflare\nLensflare.prototype.isLensflare = true\n\n//\n\nconst LensflareElement = function (texture, size, distance, color) {\n  this.texture = texture\n  this.size = size || 1\n  this.distance = distance || 0\n  this.color = color || new Color(0xffffff)\n}\n\nLensflareElement.Shader = {\n\n  uniforms: {\n\n    'map': { value: null },\n    'occlusionMap': { value: null },\n    'color': { value: null },\n    'scale': { value: null },\n    'screenPosition': { value: null }\n\n  },\n\n  vertexShader: [\n\n    'precision highp float;',\n\n    'uniform vec3 screenPosition;',\n    'uniform vec2 scale;',\n\n    'uniform sampler2D occlusionMap;',\n\n    'attribute vec3 position;',\n    'attribute vec2 uv;',\n\n    'varying vec2 vUV;',\n    'varying float vVisibility;',\n\n    'void main() {',\n\n    '   vUV = uv;',\n\n    '   vec2 pos = position.xy;',\n\n    '   vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );',\n    '   visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );',\n    '   visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );',\n    '   visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );',\n    '   visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );',\n    '   visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );',\n    '   visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );',\n    '   visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );',\n    '   visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );',\n\n    '   vVisibility =        visibility.r / 9.0;',\n    '   vVisibility *= 1.0 - visibility.g / 9.0;',\n    '   vVisibility *=       visibility.b / 9.0;',\n\n    '   gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );',\n\n    '}'\n\n  ].join('\\n'),\n\n  fragmentShader: [\n\n    'precision highp float;',\n\n    'uniform sampler2D map;',\n    'uniform vec3 color;',\n\n    'varying vec2 vUV;',\n    'varying float vVisibility;',\n\n    'void main() {',\n\n    '   vec4 texture = texture2D( map, vUV );',\n    '   texture.a *= vVisibility;',\n    '   gl_FragColor = texture;',\n    '   gl_FragColor.rgb *= color;',\n\n    '}'\n\n  ].join('\\n')\n\n}\n\nLensflare.Geometry = (function () {\n  var geometry = new BufferGeometry()\n\n  var float32Array = new Float32Array([\n    -1, -1, 0, 0, 0,\n    1, -1, 0, 1, 0,\n    1, 1, 0, 1, 1,\n    -1, 1, 0, 0, 1\n  ])\n\n  var interleavedBuffer = new InterleavedBuffer(float32Array, 5)\n\n  geometry.setIndex([ 0, 1, 2, 0, 2, 3 ])\n  geometry.addAttribute('position', new InterleavedBufferAttribute(interleavedBuffer, 3, 0, false))\n  geometry.addAttribute('uv', new InterleavedBufferAttribute(interleavedBuffer, 2, 3, false))\n\n  return geometry\n})()\n\nexport {Lensflare, LensflareElement}\n","import {\n  TextureLoader\n} from 'three'\nimport {\n    Lensflare,\n    LensflareElement\n} from '../modules/Lensflare'\n\nconst textureLoader = new TextureLoader()\nconst textureFlare3 = textureLoader.load(require('../textures/lensflare/lensflare3.png'))\n\nconst lensFlare = new Lensflare()\n\nlensFlare.addElement(new LensflareElement(textureFlare3, 60, 0.6))\nlensFlare.addElement(new LensflareElement(textureFlare3, 70, 0.7))\nlensFlare.addElement(new LensflareElement(textureFlare3, 120, 0.9))\nlensFlare.addElement(new LensflareElement(textureFlare3, 70, 1.0))\n\nexport default lensFlare\n","import {\n\tVector2,\n\tVector3,\n\tMatrix4\n} from 'three'\n\nconst motionBlurVertexShader = `\n\tvarying vec2 vUv;\n\t\t\t\n\tvoid main() {\n\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\tvUv = uv;\n\n\t}`\n\nconst motionBlurFragmentShader = `\n\tvarying vec2 vUv;\n\n\tuniform sampler2D tDepth;\n\tuniform sampler2D tColor;\n\n\tuniform mat4 clipToWorldMatrix;\n\tuniform mat4 previousWorldToClipMatrix;\n\n\tuniform vec3 cameraMove;\n\n\tuniform float velocityFactor;\n\tuniform float delta;\n\n\tvoid main() {\n\n\t\tfloat zOverW = texture2D(tDepth, vUv).x;\n\n\t\t// clipPosition is the viewport position at this pixel in the range -1 to 1.\n\t\tvec4 clipPosition = vec4(vUv.x * 2. - 1., vUv.y * 2. - 1., zOverW * 2. - 1., 1.);\n\n\t\tvec4 worldPosition = clipToWorldMatrix * clipPosition;\n\t\tworldPosition /= worldPosition.w;\n\t\t\n\t\tvec4 previousClipPosition = worldPosition;\n\n\t\t// Reduce motion blur due to camera translation especially at the screen center.\n\t\tpreviousClipPosition.xyz -= cameraMove * (\n\t\t\t1. - smoothstep(.3, 1., clamp(length(clipPosition.xy), 0., 1.))\n\t\t);\n\t\t\n\t\tpreviousClipPosition = previousWorldToClipMatrix * previousClipPosition;\n\t\tpreviousClipPosition /= previousClipPosition.w;\n\t\t\n\t\tvec2 velocity = velocityFactor * (clipPosition - previousClipPosition).xy / delta * 16.67;\n\n\t\tvec4 finalColor = vec4(0.);\n\t\tvec2 offset = vec2(0.); \n\t\tfloat weight = 0.;\n\t\tconst int samples = 20;\n\t\tfor(int i = 0; i < samples; i++) {  \n    \t\t\toffset = velocity * (float(i) / (float(samples) - 1.) - .5);\n    \t\t\tvec4 c = texture2D(tColor, vUv + offset);\n\t\t\tfinalColor += c;\n\t\t}  \n\t\tfinalColor /= float(samples);\n\t\tgl_FragColor = vec4(finalColor.rgb, 1.);\n\n\t\t// debug: view velocity values\n\t\t// gl_FragColor = vec4(abs(velocity), 0., 1.);\n\n\t\t// debug: view depth buffer\n\t\t// gl_FragColor = vec4(vec3(zOverW), 1.);\n\t}`\n\nexport const motionBlurShader = {\n\n  uniforms: {\n    tDepth: { type: 't', value: null },\n    tColor: { type: 't', value: null },\n\n    velocityFactor: { type: 'f', value: 1 },\n    delta: { type: 'f', value: 16.67 },\n\n    clipToWorldMatrix: { type: 'm4', value: new Matrix4() },\n    previousWorldToClipMatrix: { type: 'm4', value: new Matrix4() },\n\n    cameraMove: { type: 'v3', value: new Vector3() }\n  },\n\n  vertexShader: motionBlurVertexShader,\n  fragmentShader: motionBlurFragmentShader\n}\n","import {camera} from '../index'\n\nfunction screenXY (vec3) {\n  const vector = vec3.clone()\n\n  const widthHalf = (window.innerWidth / 2)\n  const heightHalf = (window.innerHeight / 2)\n\n  vector.project(camera)\n\n  vector.x = (vector.x * widthHalf) + widthHalf\n  vector.y = -(vector.y * heightHalf) + heightHalf\n\n  return vector\n}\n\nconst screenXYclamped = (vec3) => {\n  const screenPosition = screenXY(vec3)\n  return {\n    x: Math.min(Math.max(10, screenPosition.x), window.innerWidth - 10),\n    y: Math.min(Math.max(10, screenPosition.y), window.innerHeight - 10),\n    z: screenPosition.z\n  }\n}\n\nconst clamp = (min, value, max) => Math.min(Math.max(min, value), max)\n\nexport {screenXY, screenXYclamped, clamp}\n","import {Vector2, Vector3} from 'three'\nimport React, {Component} from 'react'\nimport ReactDOM from 'react-dom'\nimport clone from 'clone'\nimport {screenXYclamped} from '../utils'\nimport PubSub from '../events'\nimport {scene, camera} from '../index'\nimport Crosshair from './crosshair'\n\nlet targets = []\nlet pilotDrone\nconst targetsInSight = new Set()\nconst targetsInFront = new Set()\nlet screenCenter = new Vector2(window.innerWidth / 2, window.innerHeight / 2)\nPubSub.subscribe('x.screen.resized', (msg, rendererSize) => {\n  screenCenter = new Vector2(rendererSize.width / 2, rendererSize.height / 2)\n})\nlet horizonStyle\nlet focalStyle\n\nclass HUD extends Component {\n  constructor (props) {\n    super(props)\n    this.state = {time: 0, gunHeat: 0, lockLevel: 0, pilot: null}\n  }\n\n  componentDidMount () {\n    PubSub.publish('x.hud.mounted')\n  }\n\n  gunHeat () {\n    if (!pilotDrone || !pilotDrone.gunClock.running) {\n      return Math.max(0, this.state.gunHeat - 0.01)\n    }\n    const delta = pilotDrone.gunClock.getDelta()\n    const gunHeat = this.state.gunHeat + delta / 1.5\n    if (gunHeat >= 1) {\n      PubSub.publish('x.drones.gun.stop', pilotDrone)\n      PubSub.publish('x.camera.shake.stop')\n      pilotDrone.gunClock.stop()\n    }\n    return Math.min(gunHeat, 1)\n  }\n\n  lockLevel () {\n    if (targetsInSight.size === 0) {\n      return Math.max(0, this.state.lockLevel - 0.02)\n    }\n    const times = []\n    targetsInSight.forEach(target => {\n      const delta = target.lockClock.getDelta()\n      times.push(this.state.lockLevel + delta / 2)\n    })\n    return Math.min(Math.max(...times), 1)\n  }\n\n  update (timestamp, newState) {\n    const gunHeat = this.gunHeat()\n    const lockLevel = this.lockLevel()\n    this.setState({\n      ...newState,\n      time: timestamp,\n      gunHeat,\n      lockLevel,\n      lock: lockLevel === 1,\n      pilot: pilotDrone ? pilotDrone.userData : null\n    })\n  }\n\n  render () {\n    const targetsData = targets.map(target => Object.assign(\n      clone(target.userData),\n      {id: target.id}\n    ))\n    return (\n      <div>\n        <div id='limiter' />\n        <div id='pointer' />\n        <div id='focal' style={this.state.focalStyle} />\n        <div id='horizon' style={this.state.horizonStyle} />\n        { this.state.pilot ? (\n          <div id='messages'>\n            <div>{this.state.pilot.altitude.toFixed(0)} m</div>\n            <div>{this.state.pilot.speed.toFixed(0)} m/s</div>\n          </div>\n          ) : null\n        }\n        <svg className='vector'>\n          <Crosshair size='30' x={screenCenter.x} y={screenCenter.y}\n            fill='transparent'\n            stroke='#0f0'\n            strokeWidth='17'\n            opacity='0.8'\n          />\n          <circle\n            cx={screenCenter.x} cy={screenCenter.y} r={160}\n            stroke='#666' opacity={0.8} strokeWidth='10' fill='transparent'\n            strokeDasharray='140 1000' transform={`rotate(155 ${screenCenter.x} ${screenCenter.y})`}\n            strokeLinecap='round'\n          />\n          {\n            this.state.lockLevel\n            ? (<circle\n              cx={screenCenter.x} cy={screenCenter.y} r={160}\n              stroke='#0f0' opacity={0.8} strokeWidth='10' fill='transparent'\n              strokeDasharray={`${this.state.lockLevel * 140} 1000`}\n              transform={`rotate(155 ${screenCenter.x} ${screenCenter.y})`}\n              strokeLinecap='round'\n            />) : null\n          }\n          <circle\n            cx={screenCenter.x} cy={screenCenter.y} r={160}\n            stroke='#666' opacity={0.8} strokeWidth='10' fill='transparent'\n            strokeDasharray='140 1000'\n            strokeLinecap='round' transform={`rotate(205 ${screenCenter.x} ${screenCenter.y}) translate(${screenCenter.x * 2}, 0) scale(-1, 1)`}\n          />\n          {\n            this.state.gunHeat\n            ? (<circle\n              cx={screenCenter.x} cy={screenCenter.y} r={160}\n              stroke='orange' opacity={0.8} strokeWidth='10' fill='transparent'\n              strokeDasharray={`${this.state.gunHeat * 140} 1000`}\n              strokeLinecap='round' transform={`rotate(205 ${screenCenter.x} ${screenCenter.y}) translate(${screenCenter.x * 2}, 0) scale(-1, 1)`}\n              />)\n            : null\n          }\n          {targets.map(target => (\n            target.gunHud\n            ? (<g key={target.id}>\n              <path\n                d={`M ${target.hudPosition.x} ${target.hudPosition.y}\n                    l ${target.direction.x} ${target.direction.y}`}\n                strokeWidth='1'\n                stroke={target === this.state.gunTarget ? '#0f0' : 'orange'}\n                fill='transparent' />\n              {target === this.state.gunTarget ? (\n                <Crosshair size='30'\n                  x={target.hudPosition.x + target.direction.x}\n                  y={target.hudPosition.y + target.direction.y}\n                  fill='#0f0'\n                  fillOpacity='0.6'\n                  stroke='#0f0'\n                  strokeWidth='17'\n                  strokeOpacity='1'\n                />\n              ) : null}\n            </g>)\n            : null\n          ))}\n        </svg>\n        <div id='targets'>\n          {targetsData.map(target => (\n            <div className='target' key={target.id} id={'target-' + target.id} style={target.hud.element.style}>\n              <div className='life' style={{width: target.life / 100 * 20}} />\n              <div className='arrow' style={target.hud.arrow.style} />\n              <div className='distance'>{target.hud.distance.innerHTML}</div>\n              <div className='name'>drone-{target.id}</div>\n            </div>\n          ))}\n        </div>\n      </div>\n    )\n  }\n}\n\nconst registerTarget = (msg, target) => {\n  targets.push(target)\n  target.userData.hud = {\n    element: {style: {}},\n    arrow: {style: {}},\n    distance: {style: {}}\n  }\n  let hudPosition\n  let targetDistance2D\n  let targetDistance3D\n  let targetVector2D\n  let targetVector3D\n  let targetDirection\n  const ZONE = 400\n  const FOCAL_SIZE = 150\n  const GUN_RANGE = 500\n  const targetLoop = (timestamp, delta) => {\n    if (!hudElement.mounted) return\n    hudPosition = screenXYclamped(target.position)\n    if (hudPosition.z > 1) {\n      hudPosition.x = window.innerWidth - hudPosition.x\n      hudPosition.y = window.innerHeight - 10\n      target.userData.hud.element.style.borderColor = 'red'\n      target.userData.hud.arrow.style.borderBottomColor = 'red'\n    } else {\n      target.userData.hud.element.style.borderColor = 'orange'\n      target.userData.hud.arrow.style.borderBottomColor = 'orange'\n    }\n    target.hudPosition = hudPosition\n    targetVector2D = new Vector2(hudPosition.x, hudPosition.y).sub(screenCenter)\n    if (targetVector2D.length() > ZONE) {\n      targetVector2D.normalize().multiplyScalar(ZONE)\n    }\n    target.userData.hud.arrow.style.opacity = 0.8 * (1 - (ZONE - targetVector2D.length()) / 50)\n    targetVector3D = camera.position.clone().sub(target.position)\n    targetDistance3D = targetVector3D.length()\n    target.userData.hud.distance.innerHTML = targetDistance3D.toFixed(0)\n    target.userData.hud.distance.style.color = targetDistance3D < GUN_RANGE ? '#0f0' : 'orange'\n    target.userData.hud.element.style.transform = `\n      translateX(${targetVector2D.x + screenCenter.x}px)\n      translateY(${targetVector2D.y + screenCenter.y}px)\n      scale(${1.1 - Math.min(0.2, targetDistance3D / 2000)})\n    `\n    target.userData.hud.arrow.style.transform = `\n      translateY(2px)\n      rotate(${targetVector2D.angle() / Math.PI * 180 + 90}deg)\n    `\n    targetDistance2D = targetVector2D.length()\n    if (!target.destroyed && target.userData.hud.element.style.borderColor === 'orange' && targetDistance2D < FOCAL_SIZE) {\n      target.userData.hud.arrow.style.borderBottomColor = '#0f0'\n      targetsInSight.add(target)\n      if (!target.lockClock.running) target.lockClock.start()\n    } else {\n      targetsInSight.delete(target)\n      target.lockClock.stop()\n    }\n    if (!target.destroyed && targetDistance2D < ZONE - 10) {\n      targetsInFront.add(target)\n    } else {\n      targetsInFront.delete(target)\n    }\n    if (hudPosition.z <= 1 && targetDistance2D < ZONE * 0.8) {\n      targetDirection = screenXYclamped(\n        target.position.clone().add(target.velocity.clone().multiplyScalar(\n          Math.min(1,\n            (targetDistance3D + targetVector3D.clone().add(target.velocity).length()) / 2 / GUN_RANGE\n          )\n        ))\n      )\n      target.gunHud = true\n      target.direction = {\n        x: targetDirection.x - (targetVector2D.x + screenCenter.x),\n        y: targetDirection.y - (targetVector2D.y + screenCenter.y)\n      }\n    } else {\n      target.gunHud = false\n    }\n  }\n  targetLoop.id = target.id\n  const destroyTarget = (msg, targetToDestroy) => {\n    if (targetToDestroy.id !== target.id) return\n    scene.remove(targetToDestroy)\n    PubSub.publish('x.loops.remove', targetLoop)\n    targets = targets.filter(item => item.id !== targetToDestroy.id)\n    targetsInSight.delete(target)\n    hudElement.forceUpdate()\n  }\n  PubSub.subscribe('x.drones.destroy', destroyTarget)\n  PubSub.publish('x.loops.push', targetLoop)\n}\nPubSub.subscribe('x.hud.register.target', registerTarget)\n\nconst camVec = new Vector3()\nlet localX\nlet localY\nlet rollAngle\nlet pitch\nlet rollAngleDegree\nconst hudLoop = (timestamp) => {\n  localX = new Vector3(1, 0, 0).applyQuaternion(camera.quaternion)\n  localY = new Vector3(0, 1, 0).applyQuaternion(camera.quaternion)\n  rollAngle = (\n    Math.PI / 2 - camera.up.angleTo(localX) * Math.sign(camera.up.dot(localY))\n  )\n  camera.rollAngle = rollAngle\n  pitch = camera.up.dot(camera.getWorldDirection(camVec))\n  rollAngleDegree = rollAngle / Math.PI * 180\n  horizonStyle = {\n    transform: `translateX(-50%) translateY(${pitch * window.innerHeight / 2}px) rotate(${rollAngleDegree}deg)`\n  }\n  if (hudElement.state.lock) {\n    focalStyle = {boxShadow: '0 0 75px #0f0'}\n  } else {\n    focalStyle = {boxShadow: ''}\n  }\n  hudElement.update(timestamp, {horizonStyle, focalStyle, gunTarget: selectNearestGunTarget()})\n}\n\nPubSub.subscribe('x.hud.mounted', () => {\n  PubSub.publish('x.loops.push', hudLoop)\n  hudElement.mounted = true\n})\n\nPubSub.subscribe('x.drones.pilotDrone.loaded', (msg, data) => {\n  pilotDrone = data.pilotDrone\n})\n\nPubSub.subscribe('x.drones.missile.start', (msg, pilotDrone) => {\n  hudElement.setState(state => ({...state, lockLevel: 0, lock: false}))\n})\n\nconst selectNearestTargetInSight = () => {\n  if (targetsInSight.size === 0 || !hudElement.state.lock) return null\n  const distances = []\n  targetsInSight.forEach(target =>\n    distances.push([camera.position.distanceTo(target.position), target])\n  )\n  distances.sort((a, b) => a[0] > b[0])\n  return distances[0][1]\n}\n\nconst selectNearestGunTarget = () => {\n  if (targetsInSight.size === 0) return null\n  const distances = []\n  targetsInSight.forEach(target =>\n    distances.push([\n      new Vector2(target.hudPosition.x, target.hudPosition.y)\n        .sub(screenCenter)\n        .add(new Vector2(target.direction.x, target.direction.y)).length(),\n      target])\n  )\n  distances.sort((a, b) => a[0] > b[0])\n  return distances[0][1]\n}\n\nconst hudElement = ReactDOM.render(\n  <HUD />,\n  document.getElementById('hud')\n)\n\nexport {selectNearestTargetInSight, selectNearestGunTarget, hudElement, targets, targetsInFront, targetsInSight}\n","import React, {PureComponent} from 'react'\n\nclass Crosshair extends PureComponent {\n  render () {\n    return (\n      <svg\n        x={this.props.x - this.props.size / 2}\n        y={this.props.y - this.props.size / 2}\n        viewBox='-10 -10 415 415' width={this.props.size} height={this.props.size}>\n        <g {...this.props}>\n          <circle cx='202.224' cy='202.228' r='26.686' />\n          <path d='M83.807,49.322L50.87,4.891c-9.519-9.527-30.71-3.78-40.236,5.747S-4.64,41.347,4.887,50.874\n            l44.431,32.937c9.519,9.519,24.963,9.527,34.49,0C93.334,74.284,93.326,58.84,83.807,49.322z' />\n          <path d='M393.823,10.638c-9.527-9.527-30.71-15.274-40.236-5.747l-32.937,44.431\n            c-9.527,9.527-9.527,24.963,0,34.49c9.527,9.527,24.963,9.519,34.49,0l44.431-32.937\n            C409.096,41.347,403.349,20.164,393.823,10.638z' />\n          <path d='M355.139,320.645c-9.527-9.527-24.963-9.527-34.49,0c-9.527,9.527-9.527,24.963,0,34.49\n            l32.937,44.431c9.527,9.519,30.71,3.78,40.236-5.747s15.274-30.71,5.747-40.236L355.139,320.645z' />\n          <path d='M49.318,320.645L4.887,353.582c-9.527,9.527-3.78,30.71,5.747,40.236s30.71,15.274,40.236,5.747\n            l32.937-44.431c9.527-9.519,9.527-24.963,0-34.49C74.28,311.127,58.844,311.127,49.318,320.645z' />\n        </g>\n      </svg>\n    )\n  }\n}\n\nexport default Crosshair\n","import SPE from 'shader-particle-engine/build/SPE'\nimport {\n  TextureLoader,\n  Vector2,\n  AdditiveBlending,\n  NormalBlending,\n  Vector3,\n  Color,\n  Line3\n} from 'three'\nimport PubSub from '../events'\n// import {scene} from '../index'\nimport {targetsInFront, selectNearestGunTarget} from '../hud'\nimport {camera} from '../index'\n\n// GROUPS\nconst textureLoader = new TextureLoader()\nconst fireGroupOptions = {\n  texture: {\n    value: textureLoader.load(require('../textures/Explosion_002_Tile_8x8_256x256.png')),\n    frames: new Vector2(8, 8),\n    // value: textureLoader.load(require('../textures/sprite-explosion2.png')),\n    // frames: new Vector2(5, 5),\n    loop: 1\n  },\n  depthTest: true,\n  depthWrite: false,\n  blending: AdditiveBlending,\n  scale: 600,\n  maxParticleCount: 25000\n}\nconst pointsGroupOptions = {\n  texture: {\n    value: textureLoader.load(require('../textures/smokeparticle.png'))\n  },\n  depthTest: true,\n  depthWrite: false,\n  blending: NormalBlending,\n  maxParticleCount: 25000\n}\nconst debrisGroupOptions = {\n  texture: {\n    value: textureLoader.load(require('../textures/spark.png'))\n  },\n  depthTest: true,\n  depthWrite: false,\n  blending: NormalBlending,\n  maxParticleCount: 25000\n}\nconst bulletGroupOptions = {\n  texture: {\n    value: textureLoader.load(require('../textures/bullet.png'))\n  },\n  depthTest: true,\n  depthWrite: false,\n  blending: NormalBlending,\n  maxParticleCount: 25000\n}\n\n// EMITTERS\nconst shockwaveOptions = {\n  particleCount: 200,\n  type: SPE.distributions.DISC,\n  position: {\n    radius: 5,\n    spread: new Vector3(5)\n  },\n  maxAge: {\n    value: 2,\n    spread: 0\n  },\n  duration: 1,\n  activeMultiplier: 2000,\n\n  velocity: {\n    value: new Vector3(40)\n  },\n  rotation: {\n    axis: new Vector3(0, 0, 1),\n    angle: Math.PI * 0.5,\n    static: true\n  },\n  size: { value: 2 },\n  color: {\n    value: [\n      new Color(0.4, 0.2, 0.1),\n      new Color(0.2, 0.2, 0.2)\n    ]\n  },\n  opacity: { value: [0.5, 0.2, 0] }\n}\nconst debrisOptions = {\n  particleCount: 100,\n  type: SPE.distributions.SPHERE,\n  position: {\n    radius: 0.1\n  },\n  maxAge: {\n    value: 2\n  },\n  duration: 1,\n  activeMultiplier: 40,\n  velocity: {\n    value: new Vector3(100)\n  },\n  acceleration: {\n    value: new Vector3(0, 0, -20),\n    distribution: SPE.distributions.BOX\n  },\n  wiggle: 3,\n  size: {\n    value: 2,\n    spread: 5\n  },\n  angle: {\n    spread: Math.PI * 2\n  },\n  drag: {\n    value: 1\n  },\n  color: {\n    value: [\n      new Color(1, 1, 1),\n      new Color(1, 1, 0),\n      new Color(1, 0, 0),\n      new Color(0.4, 0.2, 0.1)\n    ]\n  },\n  opacity: { value: [1, 1, 0] }\n}\nconst fireOptions = {\n  particleCount: 20,\n  type: SPE.distributions.SPHERE,\n  position: {\n    radius: 5\n  },\n  maxAge: { value: 2 },\n  duration: 1,\n  activeMultiplier: 20,\n  velocity: {\n    value: new Vector3(10)\n  },\n  size: { value: [20, 100] },\n  color: {\n    value: [\n      new Color(0.5, 0.1, 0.05),\n      new Color(0.2, 0.2, 0.2)\n    ]\n  },\n  opacity: { value: [0.5, 0.35, 0.1, 0] }\n}\nconst mistOptions = {\n  particleCount: 100,\n  position: {\n    spread: new Vector3(15, 15, 15),\n    distribution: SPE.distributions.SPHERE\n  },\n  maxAge: { value: 2 },\n  duration: 1,\n  activeMultiplier: 2000,\n  velocity: {\n    value: new Vector3(8, 3, 10),\n    distribution: SPE.distributions.SPHERE\n  },\n  size: { value: 40 },\n  color: {\n    value: new Color(0.2, 0.2, 0.2)\n  },\n  opacity: { value: [0, 0, 0.4, 0] }\n}\nconst flashOptions = {\n  duration: 1,\n  particleCount: 50,\n  position: { spread: new Vector3(5, 5, 5) },\n  velocity: {\n    spread: new Vector3(30),\n    distribution: SPE.distributions.SPHERE\n  },\n  size: { value: [40, 20, 20, 20] },\n  maxAge: { value: 2 },\n  activeMultiplier: 2000,\n  // opacity: { value: [0.5, 0.25, 0, 0] }\n  opacity: { value: [1, 1, 0, 0] }\n  // opacity: { value: 1 }\n}\n\nconst smokeOptions = {\n  particleCount: 1000,\n  position: {\n    spread: new Vector3(1, 1, 1)\n  },\n  maxAge: { value: 10 },\n  // activeMultiplier: 2000,\n  velocity: {\n    value: new Vector3(4, 2, 5),\n    distribution: SPE.distributions.SPHERE\n  },\n  size: { value: [20, 60] },\n  color: {\n    value: new Color(0.9, 0.9, 0.9)\n  },\n  opacity: { value: [0.4, 0.4, 0.4, 0] }\n}\n\nconst smokeLightOptions = {\n  particleCount: 1000,\n  position: {\n    spread: new Vector3(1, 1, 1)\n  },\n  maxAge: { value: 5 },\n  // activeMultiplier: 2000,\n  velocity: {\n    value: new Vector3(4, 2, 5),\n    distribution: SPE.distributions.SPHERE\n  },\n  size: { value: [5, 10] },\n  color: {\n    value: new Color(1, 1, 1)\n  },\n  opacity: { value: [0.4, 0.4, 0.4, 0] }\n}\n\nconst bulletOptions = {\n  particleCount: 35,\n  type: SPE.distributions.BOX,\n  position: {\n    radius: 0.1\n  },\n  maxAge: {\n    value: 1\n  },\n  duration: null,\n  activeMultiplier: 1,\n  velocity: {\n    value: new Vector3(100),\n    spread: new Vector3(20, 20, 20)\n  },\n  acceleration: {\n    value: 0\n  },\n  size: {\n    value: 1\n  },\n  color: {\n    value: [\n      new Color(1, 1, 1),\n      new Color(1, 1, 0)\n    ]\n  },\n  opacity: { value: 1 }\n}\n\nconst sparkOptions = {\n  particleCount: 10,\n  type: SPE.distributions.SPHERE,\n  position: {\n    radius: 0.1\n  },\n  maxAge: {\n    value: 0.3\n  },\n  duration: 0.3,\n  activeMultiplier: 1000,\n  velocity: {\n    value: new Vector3(100)\n  },\n  acceleration: {\n    value: 0\n  },\n  wiggle: 30,\n  size: {\n    value: [3, 1, 0.5]\n  },\n  color: {\n    value: [\n      new Color(1, 1, 1),\n      new Color(1, 1, 0)\n    ]\n  },\n  opacity: { value: 1 }\n}\n\nconst flashGroup = new SPE.Group(fireGroupOptions)\nconst fireGroup = new SPE.Group(fireGroupOptions)\n\nconst debrisGroup = new SPE.Group(debrisGroupOptions)\nconst shockGroup = new SPE.Group(pointsGroupOptions)\nconst mistGroup = new SPE.Group(pointsGroupOptions)\nconst smokeGroup = new SPE.Group(pointsGroupOptions)\nconst smokeLightGroup = new SPE.Group(pointsGroupOptions)\n\nconst bulletGroup = new SPE.Group(bulletGroupOptions)\nconst sparkGroup = new SPE.Group(debrisGroupOptions)\n\nconst poolSize = 25\nconst createNew = false\n\nflashGroup.addPool(poolSize, flashOptions, createNew)\nfireGroup.addPool(poolSize, fireOptions, createNew)\n\ndebrisGroup.addPool(poolSize, debrisOptions, createNew)\nshockGroup.addPool(poolSize, shockwaveOptions, createNew)\nmistGroup.addPool(poolSize, mistOptions, createNew)\nsmokeGroup.addPool(poolSize, smokeOptions, createNew)\nsmokeLightGroup.addPool(poolSize, smokeLightOptions, createNew)\n\nbulletGroup.addPool(poolSize, bulletOptions, createNew)\nsparkGroup.addPool(poolSize, sparkOptions, createNew)\n\nconst groups = [\n  flashGroup,\n  fireGroup,\n  debrisGroup,\n  shockGroup,\n  mistGroup,\n  smokeGroup,\n  smokeLightGroup,\n  bulletGroup,\n  sparkGroup\n]\n// avoid artifacts with the ocean\ngroups.forEach(group => { group.mesh.renderOrder = 2 })\nsmokeGroup.mesh.renderOrder = 1\n// cf. https://github.com/squarefeet/ShaderParticleEngine/issues/126\ngroups.forEach(group => { group.mesh.frustumCulled = false })\n\nwindow.smokeGroup = smokeGroup\n\nlet camVec = new Vector3()\n\nconst triggerSingleEmitter = (group, target, follow = false, velocityFunction, offset = false) => {\n  const emitter = group.getFromPool()\n\n  if (emitter === null) {\n    console.log('SPE.Group pool ran out.')\n    return\n  }\n\n  if (offset) {\n    emitter.position.value = target.position.clone().add(\n      camera.getWorldDirection(camVec).multiplyScalar(5)\n    )\n  } else {\n    emitter.position.value = target.position.clone()\n  }\n  if (velocityFunction) {\n    emitter.velocity.value = velocityFunction()\n  }\n\n  let initialPositions\n  // paramsArray vec4( alive, age, maxAge, wiggle )\n  let params\n  let velocities\n  let positions\n  let collisions\n  let bulletLine\n  let closestDistance\n  const targetVec3 = new Vector3()\n  const chunkReducer = (chunkSize) =>\n    (ar, it, i) => {\n      const ix = Math.floor(i / chunkSize)\n      if (!ar[ix]) ar[ix] = []\n      ar[ix].push(it)\n      return ar\n    }\n  const loop = {\n    loop: (timestamp, delta) => {\n      if (offset) {\n        emitter.position.value = target.position.clone().add(\n          camera.getWorldDirection(camVec).multiplyScalar(5)\n        )\n      } else {\n        emitter.position.value = target.position.clone()\n      }\n      if (velocityFunction) {\n        emitter.velocity.value = velocityFunction()\n        initialPositions = emitter.attributes.position.typedArray.array.slice(\n          emitter.attributeOffset * 3,\n          (emitter.activationEnd) * 3\n        ).reduce(chunkReducer(3), [])\n        velocities = emitter.attributes.velocity.typedArray.array.slice(\n          emitter.attributeOffset * 3,\n          (emitter.activationEnd) * 3\n        ).reduce(chunkReducer(3), [])\n        params = emitter.paramsArray.slice(\n          emitter.attributeOffset * 4,\n          (emitter.activationEnd) * 4\n        ).reduce(chunkReducer(4), [])\n        positions = params.map((param, i) => {\n          return param[0]\n            ? new Vector3(...initialPositions[i]).add(\n                new Vector3(...velocities[i]).multiplyScalar(param[1])\n              )\n            : null\n        })\n        collisions = []\n        positions.forEach((pos, i) => {\n          if (pos === null) return\n          targetsInFront.forEach((target) => {\n            bulletLine = new Line3(\n              pos,\n              pos.clone().add(new Vector3(...velocities[i]).multiplyScalar(delta / 1000))\n            )\n            closestDistance = bulletLine.closestPointToPoint(target.position, true, targetVec3).sub(target.position).length()\n            if (closestDistance < 10) {\n              collisions.push([target, pos])\n            }\n          })\n        })\n        if (collisions.length) {\n          collisions.forEach(ar => {\n            PubSub.publish('x.sound.impact', ar[0])\n            triggerSmallExplosion({position: ar[1]})\n            ar[0].userData.life -= 5\n          })\n        }\n      }\n    },\n    alive: true,\n    id: target.id\n  }\n  if (follow && !target.destroyed) {\n    PubSub.publish('x.loops.push', loop)\n    PubSub.subscribe('x.drones.destroy', (msg, drone) => {\n      if (drone.id !== target.id) return\n      loop.alive = false\n      emitter.disable()\n      group.releaseIntoPool(emitter)\n    })\n  }\n\n  emitter.loop = loop\n  emitter.enable()\n\n  if (emitter.duration) {\n    setTimeout(() => {\n      emitter.disable()\n      if (follow) { loop.alive = false }\n      group.releaseIntoPool(emitter)\n    }, (emitter.duration + emitter.maxAge.value + emitter.maxAge.spread) * 1000)\n  }\n\n  return emitter\n}\n\nconst triggerExplosion = (target) => {\n  triggerSingleEmitter(flashGroup, target)\n  triggerSingleEmitter(fireGroup, target)\n  triggerSingleEmitter(debrisGroup, target)\n  triggerSingleEmitter(mistGroup, target)\n}\nPubSub.subscribe('x.drones.explode', (msg, drone) => triggerExplosion(drone))\n\nconst triggerSmoke = (target) => {\n  if (target.smoking) return\n  target.smoking = true\n  triggerSingleEmitter(smokeGroup, target, true)\n}\nPubSub.subscribe('x.drones.smoke.start', (msg, drone) => triggerSmoke(drone))\n\nconst triggerLightSmoke = (target) => {\n  if (target.smoking) return\n  target.smoking = true\n  const smokeEmitter = triggerSingleEmitter(smokeLightGroup, target, true)\n  PubSub.subscribe('x.drones.missile.stop', (msg, missile) => {\n    smokeEmitter.loop.alive = false\n    smokeEmitter.disable()\n    smokeLightGroup.releaseIntoPool(smokeEmitter)\n  })\n}\nPubSub.subscribe('x.drones.missile.start', (msg, missile) => triggerLightSmoke(missile))\n\nconst triggerSmallExplosion = (target) => {\n  triggerSingleEmitter(sparkGroup, target)\n}\n\nlet tmpVec1 = new Vector3()\nlet targetVector = new Vector3()\nPubSub.subscribe('x.drones.gun.start', (msg, drone) => {\n  const target = selectNearestGunTarget()\n  const velocityFunction = () => {\n    if (target !== null && target.gunHud) {\n      tmpVec1.copy(target.position).sub(drone.position)\n      tmpVec1.add(target.velocity.clone().multiplyScalar(tmpVec1.length() / 500))\n      tmpVec1.normalize().multiplyScalar(500)\n      targetVector.copy(tmpVec1)\n    } else {\n      targetVector = camera.getWorldDirection(camVec).multiplyScalar(500)\n      const localY = new Vector3(0, 1, 0).applyQuaternion(camera.quaternion)\n      targetVector = targetVector.add(localY.multiplyScalar(24))\n    }\n    return targetVector\n  }\n  drone.gunEmitter = triggerSingleEmitter(bulletGroup, drone, true, velocityFunction, true)\n})\n\nPubSub.subscribe('x.drones.gun.stop', (msg, drone) => {\n  if (drone.gunEmitter) {\n    drone.gunEmitter.loop.alive = false\n    drone.gunEmitter.disable()\n    bulletGroup.releaseIntoPool(drone.gunEmitter)\n  }\n})\n\nexport {groups as particleGroups, triggerExplosion}\n","import {GLTFLoader} from '../modules'\nimport PubSub from '../events'\n\nvar loader = new GLTFLoader()\n\nlet droneMesh\n\nconst loadDroneAssets = () => {\n  loader.load(\n    // resource URL\n    './assets/drone/scene.gltf',\n    // called when the resource is loaded\n    function (gltf) {\n      droneMesh = gltf.scene.children[0]\n      PubSub.publish('x.assets.drone.loaded', {mesh: droneMesh})\n    }\n  )\n}\n\nexport default loadDroneAssets\n","import {\n  Vector3,\n  Clock,\n  Raycaster\n} from 'three'\nimport {scene, camera, loops} from '../index'\nimport PubSub from '../events'\nimport {triggerExplosion} from '../particles'\n\nlet droneFactory = {\n  ready: false\n}\n\nconst droneController = {\n  x: 0,\n  y: 0,\n  z: 0\n}\n\nconst initDroneGui = (gui) => {\n  window.droneController = droneController\n  const droneFolder = gui.addFolder('drone')\n  droneFolder.add(droneController, 'x', 0, 2 * Math.PI)\n  droneFolder.add(droneController, 'y', 0, 2 * Math.PI)\n  droneFolder.add(droneController, 'z', 0, 2 * Math.PI)\n}\nPubSub.subscribe('x.gui.init', (msg, data) => initDroneGui(data.gui))\n\nconst initDroneFactory = (msg, data) => {\n  droneFactory = () => {\n    const drone = data.mesh.clone()\n    drone.up.set(0, 0, 1)\n    drone.rotation.x = 0\n    drone.scale.set(0.1, 0.1, 0.1)\n    return drone\n  }\n  droneFactory.ready = true\n  PubSub.publish('x.drones.factory.ready')\n}\nPubSub.subscribe('x.assets.drone.loaded', initDroneFactory)\n\nconst buildPilotDrone = () => {\n  const pilotDrone = droneFactory()\n  pilotDrone.gunClock = new Clock(false)\n  pilotDrone.userData.altitude = NaN\n  pilotDrone.userData.speed = 0\n  pilotDrone.userData.lastPosition = pilotDrone.position.clone()\n  scene.add(pilotDrone)\n  window.pilotDrone = pilotDrone\n  let localY\n  let targetPosition\n  let targetPositionFinal\n  let camVec = new Vector3()\n  const raycaster = new Raycaster()\n  const downVector = new Vector3(0, 0, -1)\n  const offsetVector = new Vector3(0, 0, 100)\n  let terrainTiles\n  let lastTimestamp = 0\n  const pilotDroneLoop = (timestamp, delta) => {\n    camVec = camera.getWorldDirection(camVec)\n    targetPosition = camera.position.clone()\n      .add(camVec.multiplyScalar(20))\n    localY = new Vector3(0, 1, 0).applyQuaternion(camera.quaternion)\n    targetPositionFinal = targetPosition.sub(localY.multiplyScalar(8))\n    pilotDrone.position.copy(targetPositionFinal)\n    pilotDrone.lookAt(targetPosition\n      .add(camVec)\n      .add({x: 0, y: 0, z: 60})\n    )\n    pilotDrone.rotation.x += droneController.x\n    pilotDrone.rotation.y += droneController.y\n    pilotDrone.rotation.z += droneController.z\n\n    // velocity computation\n    pilotDrone.userData.velocity = pilotDrone.position.clone()\n      .sub(pilotDrone.userData.lastPosition)\n      .multiplyScalar(1000 / delta)\n    pilotDrone.userData.speed = pilotDrone.userData.velocity.length()\n    pilotDrone.userData.lastPosition.copy(pilotDrone.position)\n\n    // altitude computation\n    if (timestamp - lastTimestamp > 200) {\n      lastTimestamp = timestamp\n      raycaster.set(pilotDrone.position.clone().add(offsetVector), downVector)\n      terrainTiles = raycaster.intersectObjects(\n        camera.userData.terrainTileUnder ? [camera.userData.terrainTileUnder] : []\n      )\n      if (terrainTiles.length > 0) {\n        pilotDrone.userData.altitude = terrainTiles[0].distance - offsetVector.length()\n        pilotDrone.userData.groundNormal = terrainTiles[0].face.normal\n      }\n      if (pilotDrone.userData.altitude < 5) {\n        PubSub.publish('x.drones.explode.pilotDrone', pilotDrone)\n        PubSub.publish('x.drones.collision.terrain.pilotDrone', pilotDrone.userData.groundNormal)\n      }\n    }\n  }\n  loops.push(pilotDroneLoop)\n  PubSub.publish('x.drones.pilotDrone.loaded', {pilotDrone})\n}\nPubSub.subscribe('x.drones.factory.ready', buildPilotDrone)\n\nconst spawnDrone = (circle = true, phase = 0) => {\n  const drone = droneFactory()\n  drone.lockClock = new Clock(false)\n  drone.userData.life = 100\n  scene.add(drone)\n  drone.lastPosition = drone.position.clone()\n  let camVec = new Vector3()\n  const droneLoop = (timestamp, delta) => {\n    if (!drone) return\n    const radius = 300\n    if (circle) {\n      drone.position.set(\n        radius * Math.cos(timestamp / 1000 / 3 + phase),\n        radius * Math.sin(timestamp / 1000 / 3 + phase),\n        300 + 50 * Math.cos(timestamp / 1000 + phase)\n      )\n    } else {\n      drone.position.copy(camera.position.clone()\n        .add(camera.getWorldDirection(camVec).multiplyScalar(100)))\n    }\n    drone.velocity = drone.position.clone().sub(drone.lastPosition).multiplyScalar(1000 / delta)\n    drone.lastPosition = drone.position.clone()\n    if (!drone.destroyed && drone.userData.life <= 50) {\n      PubSub.publish('x.drones.smoke.start', drone)\n    }\n    if (!drone.destroyed && drone.userData.life <= 0) {\n      PubSub.publish('x.drones.destroy', drone)\n      drone.destroyed = true\n      triggerExplosion(drone)\n    }\n  }\n  PubSub.subscribe('x.drones.destroy', (msg, deadDrone) => {\n    if (deadDrone.id === drone.id) {\n      PubSub.publish('x.loops.remove', droneLoop)\n    }\n  })\n  PubSub.publish('x.hud.register.target', drone)\n  loops.push(droneLoop)\n}\n\nconst initTargets = () => {\n  spawnDrone(true)\n  spawnDrone(true, Math.PI / 8)\n  spawnDrone(true, Math.PI / 4)\n  spawnDrone(true, Math.PI / 2)\n  spawnDrone(true, Math.PI)\n}\nPubSub.subscribe('x.drones.factory.ready', initTargets)\nPubSub.subscribe('x.drones.destroy', () => spawnDrone(true, Math.random() * 2 * Math.PI))\n\nexport default initDroneFactory\n","import loadDroneAssets from './loader'\nimport './init'\n\nexport default loadDroneAssets\n","import {\n    Quaternion,\n    Vector2,\n    Vector3\n} from 'three'\n\n/**\n * @author James Baicoianu / http://www.baicoianu.com/\n */\n\nexport default function FlyControls (object, domElement, nipple, pointer) {\n  this.object = object\n\n  this.domElement = (domElement !== undefined) ? domElement : document\n  if (domElement) this.domElement.setAttribute('tabindex', -1)\n\n    // API\n\n  this.movementSpeed = 0.1\n  this.rollSpeed = 0.001\n\n  this.dragToLook = false\n  this.autoForward = false\n\n  this.nipple = nipple\n  if (this.nipple) {\n    this.nipple.on('move', (event, data) => this.nipplemove(event, data))\n    this.nipple.on('end', (event, data) => {\n      this.autoForward = false\n      this.updateMovementVector()\n    })\n  }\n\n  this.acceleration = 60\n  this.velocity = new Vector3(0, 0, 0)\n\n  this.pointer = pointer\n  if (this.pointer) {\n    const pointerElement = document.getElementById('pointer')\n    this.zone = 400\n    this.pointer.on('attain', movements => {\n      const dims = this.getContainerDimensions().size\n      pointerElement.style.left = dims[0] / 2 + 'px'\n      pointerElement.style.top = dims[1] / 2 + 'px'\n\n      // movements is a readable stream\n      let pointerVector = new Vector2(0, 0)\n      movements.on('data', move => {\n        pointerVector.add(new Vector2(move.dx, move.dy))\n        if (pointerVector.length() > this.zone) {\n          pointerVector.normalize().multiplyScalar(this.zone)\n        }\n        pointerElement.style.transform = `\n          translateX(${pointerVector.x - 16}px)\n          translateY(${pointerVector.y - 16}px)\n        `\n        this.mousemove({\n          pageX: (pointerVector.x) / 1.5,\n          pageY: (pointerVector.y) / 1.5\n        })\n      })\n\n      movements.on('close', function () {\n                // no more movements from this pointer-lock session.\n      })\n    })\n  }\n\n    // disable default target object behavior\n\n  this.nipplemove = function (event, data) {\n    const mockEvent = {\n      pageX: data.distance * Math.cos(data.angle.radian) * 1.5,\n      pageY: -data.distance * Math.sin(data.angle.radian) * 1.5\n    }\n    this.mousemove(mockEvent)\n    this.autoForward = true\n    this.updateMovementVector()\n  }\n\n    // internals\n\n  this.tmpQuaternion = new Quaternion()\n\n  this.moveState = {\n    up: 0,\n    down: 0,\n    left: 0,\n    right: 0,\n    forward: 0,\n    back: 0,\n    pitchUp: 0,\n    pitchDown: 0,\n    yawLeft: 0,\n    yawRight: 0,\n    rollLeft: 0,\n    rollRight: 0\n  }\n  this.moveVector = new Vector3(0, 0, 0)\n  this.rotationVector = new Vector3(0, 0, 0)\n\n  this.keydown = function (event) {\n    if (event.altKey) {\n      return\n    }\n\n        // event.preventDefault();\n\n    switch (event.keyCode) {\n      case 16: /* shift */ this.movementSpeedMultiplier = 0.1; break\n\n      case 87: /* W */ this.moveState.forward = 1; break\n      case 83: /* S */ this.moveState.back = 1; break\n\n      case 65: /* A */ this.moveState.yawLeft = 1; break\n      case 68: /* D */ this.moveState.yawRight = 1; break\n\n      case 82: /* R */ this.moveState.up = 1; break\n      case 70: /* F */ this.moveState.down = 1; break\n\n      case 38: /* up */ this.moveState.pitchUp = 1; break\n      case 40: /* down */ this.moveState.pitchDown = 1; break\n\n      case 37: /* left */ this.moveState.yawLeft = 1; break\n      case 39: /* right */ this.moveState.yawRight = 1; break\n\n      case 81: /* Q */ this.moveState.rollLeft = 1; break\n      case 69: /* E */ this.moveState.rollRight = 1; break\n\n      default: // do nothing\n    }\n\n    this.updateMovementVector()\n    this.updateRotationVector()\n  }\n\n  this.keyup = function (event) {\n    switch (event.keyCode) {\n      case 16: /* shift */ this.movementSpeedMultiplier = 1; break\n\n      case 87: /* W */ this.moveState.forward = 0; break\n      case 83: /* S */ this.moveState.back = 0; break\n\n      case 65: /* A */ this.moveState.yawLeft = 0; break\n      case 68: /* D */ this.moveState.yawRight = 0; break\n\n      case 82: /* R */ this.moveState.up = 0; break\n      case 70: /* F */ this.moveState.down = 0; break\n\n      case 38: /* up */ this.moveState.pitchUp = 0; break\n      case 40: /* down */ this.moveState.pitchDown = 0; break\n\n      case 37: /* left */ this.moveState.yawLeft = 0; break\n      case 39: /* right */ this.moveState.yawRight = 0; break\n\n      case 81: /* Q */ this.moveState.rollLeft = 0; break\n      case 69: /* E */ this.moveState.rollRight = 0; break\n\n      default: // do nothing\n    }\n\n    this.updateMovementVector()\n    this.updateRotationVector()\n  }\n\n  this.mousemove = function (event) {\n    var container = this.getContainerDimensions()\n    var halfWidth = container.size[ 0 ] / 2\n    var halfHeight = container.size[ 1 ] / 2\n\n    this.moveState.yawLeft = -event.pageX / halfWidth\n    this.moveState.rollLeft = this.moveState.yawLeft / 2 - this.object.rollAngle / 5\n    this.moveState.pitchDown = event.pageY / halfHeight\n  }\n\n  this.deltaVelocity = null\n  this.deltaPosition = null\n  this.update = (delta) => {\n    var rotMult = delta * this.rollSpeed\n\n    this.deltaVelocity = this.moveVector.clone().multiplyScalar(\n      delta / 1000 * this.acceleration\n    )\n    this.velocity.sub(\n      this.velocity.clone().multiplyScalar(\n        Math.max(\n          1,\n          this.deltaVelocity.length() ? 1 : 100 / (this.velocity.length() + 1)\n        ) * 0.01 * delta / 16.67\n      )\n    ).add(this.deltaVelocity)\n    this.deltaPosition = this.velocity.clone().multiplyScalar(delta / 1000)\n    this.object.position.add(this.deltaPosition.applyQuaternion(this.object.quaternion))\n\n    this.tmpQuaternion.set(this.rotationVector.x * rotMult, this.rotationVector.y * rotMult, this.rotationVector.z * rotMult, 1).normalize()\n    this.object.quaternion.multiply(this.tmpQuaternion)\n\n        // expose the rotation vector for convenience\n    this.object.rotation.setFromQuaternion(this.object.quaternion, this.object.rotation.order)\n\n    this.updateRotationVector()\n    this.updateMovementVector()\n  }\n\n  this.updateMovementVector = function () {\n    var forward = (this.moveState.forward || (this.autoForward && !this.moveState.back)) ? 1 : 0\n\n    this.moveVector.x = (-this.moveState.left + this.moveState.right)\n    this.moveVector.y = (-this.moveState.down + this.moveState.up)\n    this.moveVector.z = (-forward + this.moveState.back)\n\n        // console.log( 'move:', [ this.moveVector.x, this.moveVector.y, this.moveVector.z ] );\n  }\n\n  this.updateRotationVector = function () {\n    this.rotationVector.x = (-this.moveState.pitchDown + this.moveState.pitchUp)\n    this.rotationVector.y = (-this.moveState.yawRight + this.moveState.yawLeft)\n    this.rotationVector.z = (-this.moveState.rollRight + this.moveState.rollLeft)\n\n        // console.log( 'rotate:', [ this.rotationVector.x, this.rotationVector.y, this.rotationVector.z ] );\n  }\n\n  this.getContainerDimensions = function () {\n    if (this.domElement !== document) {\n      return {\n        size: [ this.domElement.offsetWidth, this.domElement.offsetHeight ],\n        offset: [ this.domElement.offsetLeft, this.domElement.offsetTop ]\n      }\n    } else {\n      return {\n        size: [ window.innerWidth, window.innerHeight ],\n        offset: [ 0, 0 ]\n      }\n    }\n  }\n\n  function bind (scope, fn) {\n    return function () {\n      fn.apply(scope, arguments)\n    }\n  }\n\n  function contextmenu (event) {\n    event.preventDefault()\n  }\n\n  this.dispose = function () {\n    this.domElement.removeEventListener('contextmenu', contextmenu, false)\n\n    window.removeEventListener('keydown', _keydown, false)\n    window.removeEventListener('keyup', _keyup, false)\n  }\n\n  var _keydown = bind(this, this.keydown)\n  var _keyup = bind(this, this.keyup)\n\n  this.domElement.addEventListener('contextmenu', contextmenu, false)\n\n  window.addEventListener('keydown', _keydown, false)\n  window.addEventListener('keyup', _keyup, false)\n\n  this.updateMovementVector()\n  this.updateRotationVector()\n};\n","import keyboardJS from 'keyboardjs'\nimport nipplejs from 'nipplejs'\nimport lock from 'pointer-lock'\nimport {mobileAndTabletcheck} from '../utils/isMobile'\nimport FlyControls from '../modules/FlyControls'\n// import {OrbitControls} from '../modules/OrbitControls'\nimport {triggerExplosion} from '../particles'\nimport PubSub from '../events'\nimport {scene, camera, renderer} from '../index'\nimport {\n  Mesh,\n  SphereBufferGeometry,\n  MeshPhongMaterial,\n  Vector3\n} from 'three'\nimport {selectNearestTargetInSight, hudElement} from '../hud'\n\nlet controls = {\n  module: null,\n  setAcceleration (value) {\n    if (this.module && value !== this.module.acceleration) {\n      this.module.acceleration = value\n      console.log('acceleration set to ', value)\n    }\n  }\n}\nlet controlsElement\nlet isMobile = mobileAndTabletcheck()\nlet controlsInitialized = false\nconst initControls = (msg, data) => {\n  if (controlsInitialized) return\n  if (isMobile) {\n    document.getElementById('touchPane').style.display = 'block'\n    const touchPaneLeft = window.document.getElementsByClassName('touchPaneLeft')[0]\n    const nippleLook = nipplejs.create({\n      zone: touchPaneLeft,\n      mode: 'static',\n      position: {left: '30%', top: '90%'},\n      color: 'white'\n    })\n\n    // display touch buttons\n    Array.from(document.getElementsByClassName('touchButton')).forEach(el => {\n      el.style.display = 'block'\n    })\n    // hide verbose text\n    document.getElementById('verbosePane').style.display = 'none'\n    // get button X\n    const buttonX = document.getElementById('buttonX')\n    const pressX = (event) => {\n      event.target.style.opacity = 0.5\n      fireBullet({button: 2})\n      setTimeout(() => { event.target.style.opacity = 0.3 }, 250)\n    }\n    buttonX.addEventListener('click', pressX, false)\n    buttonX.addEventListener('touchstart', pressX, false)\n\n    controls.module = new FlyControls(camera, touchPaneLeft, nippleLook)\n    controlsElement = touchPaneLeft\n  } else {\n    const pointer = lock(renderer.domElement)\n    controls.module = new FlyControls(camera, renderer.domElement, undefined, pointer)\n    controlsElement = renderer.domElement\n  }\n\n  controls.module.update(0)\n  PubSub.publish('x.loops.unshift', (timestamp, delta) => controls.module.update(delta))\n\n  const pilotDrone = data.pilotDrone\n\n  // keyboardJS.bind('p', e => {\n  //   if (isMobile) { return }\n  //   const NewControlsClass = controls.module.constructor.name === 'OrbitControls' ? FlyControls : OrbitControls\n  //   console.log('controlsClass', NewControlsClass)\n  //   controls.module.dispose()\n  //   const newModule = new NewControlsClass(camera, controlsElement)\n  //   window.controls = newModule\n  //   controls.module = newModule\n  //   controls.module.update(0)\n\n  //   if (NewControlsClass === OrbitControls) {\n  //     let cam = pilotDrone.position.clone()\n  //     newModule.target.set(cam.x, cam.y, cam.z)\n  //   }\n  // })\n\n  keyboardJS.bind('c', e => {\n    console.log(camera.position)\n  })\n\n  keyboardJS.bind('r', e => {\n    if (controls.module.constructor.name === 'OrbitControls') {\n      controls.module.autoRotate = !controls.module.autoRotate\n    }\n  })\n\n  keyboardJS.bind('space', e => PubSub.publish('x.toggle.play'))\n\n  const bullet = new Mesh(\n    new SphereBufferGeometry(1, 5, 5),\n    new MeshPhongMaterial({color: 0x111111})\n  )\n  const fireBullet = e => {\n    if (!pilotDrone) return\n\n    if (e.button === 0) { // left click\n      PubSub.publish('x.drones.gun.start', pilotDrone)\n      PubSub.publish('x.camera.shake.start', 5)\n      pilotDrone.gunClock.start()\n    } else if (e.button === 2) { // right click\n      const target = selectNearestTargetInSight()\n      if (target === null || target.destroyed) return\n\n      const fire = bullet.clone()\n      fire.position.copy(pilotDrone.position)\n      scene.add(fire)\n      PubSub.publish('x.drones.missile.start', fire)\n\n      const BulletContructor = function () {\n        this.alive = true\n        this.object = fire\n        this.loop = (timestamp, delta) => {\n          if (!this.alive) return\n          const vec = target.position.clone().sub(fire.position)\n          if (vec.length() < 10) {\n            this.alive = false\n            triggerExplosion(target)\n            PubSub.publish('x.drones.missile.stop', fire)\n            PubSub.publish('x.drones.explosion', target)\n            target.userData.life -= 25\n            hudElement.forceUpdate()\n          }\n          const newDir = vec.normalize().multiplyScalar(10 * delta / 16.66)\n          fire.position.add(newDir)\n        }\n      }\n\n      const callback = new BulletContructor()\n      PubSub.publish('x.loops.push', callback)\n    }\n  }\n  renderer.domElement.addEventListener('mousedown', fireBullet, false)\n  renderer.domElement.addEventListener('mouseup', (e) => {\n    if (e.button === 0) {\n      PubSub.publish('x.drones.gun.stop', pilotDrone)\n      PubSub.publish('x.camera.shake.stop')\n      pilotDrone.gunClock.stop()\n    }\n  }, false)\n}\nPubSub.subscribe('x.drones.pilotDrone.loaded', initControls)\n\nlet tmpVec = new Vector3()\nPubSub.subscribe('x.drones.collision.terrain.pilotDrone', (msg, terrainNormal) => {\n  controls.setAcceleration(0)\n  tmpVec.copy(controls.module.velocity).applyQuaternion(camera.quaternion)\n  tmpVec.reflect(terrainNormal)\n  tmpVec.add(camera.position)\n  controls.module.velocity = camera.worldToLocal(tmpVec)\n  setTimeout(() => { controls.setAcceleration(60) }, 1000)\n})\n\nexport default controls\n","const mobilecheck = function () {\n  var check = false;\n  (function (a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true })(navigator.userAgent || navigator.vendor || window.opera) // eslint-disable-line\n  return check\n}\n\nconst mobileAndTabletcheck = function () {\n  var check = false;\n  (function (a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true })(navigator.userAgent || navigator.vendor || window.opera) // eslint-disable-line\n  return check\n}\n\nexport {mobilecheck, mobileAndTabletcheck}\n","import {\n  AudioListener,\n  Audio,\n  PositionalAudio,\n  AudioLoader\n} from 'three'\nimport {camera} from '../index'\nimport PubSub from '../events'\n\nconst audioLoader = new AudioLoader()\n\nconst impacts = [\n  {url: require('./impact1.ogg')},\n  {url: require('./impact2.ogg')},\n  {url: require('./impact3.ogg')},\n  {url: require('./impact4.ogg')}\n]\n\nconst weapons = [\n  {url: require('./gatling.ogg')},\n  {url: require('./missile.ogg')}\n]\n\nconst explosions = [\n  {url: require('./explosion1.ogg')},\n  {url: require('./explosion2.ogg')}\n]\n\nconst audioMapper = sound => {\n  audioLoader.load(sound.url, buffer => { sound.buffer = buffer })\n}\n\nconst setupSound = () => {\n  camera.listener = new AudioListener()\n  camera.add(camera.listener)\n\n  impacts.map(audioMapper)\n  weapons.map(audioMapper)\n  explosions.map(audioMapper)\n\n  PubSub.subscribe('x.sound.impact', (msg, drone) => {\n    const n = Math.floor(Math.random() * impacts.length)\n    if (!impacts[n].buffer) return\n    const sound = new PositionalAudio(camera.listener)\n    sound.setBuffer(impacts[n].buffer)\n    sound.setRefDistance(100)\n    drone.add(sound)\n    sound.play()\n    // drone.remove(sound) // necessary ?\n  })\n\n  const playExplosion = (msg, drone) => {\n    const n = Math.floor(Math.random() * explosions.length)\n    if (!explosions[n].buffer) return\n    const sound = new PositionalAudio(camera.listener)\n    sound.setBuffer(explosions[n].buffer)\n    sound.setRefDistance(500)\n    drone.add(sound)\n    sound.play()\n    // drone.remove(sound) // necessary ?\n  }\n  PubSub.subscribe('x.drones.destroy', playExplosion)\n  PubSub.subscribe('x.drones.explosion', playExplosion)\n\n  const gatlingSound = new Audio(camera.listener)\n  PubSub.subscribe('x.drones.gun.start', (msg, drone) => {\n    if (!weapons[0].buffer) return\n    gatlingSound.setBuffer(weapons[0].buffer)\n    gatlingSound.setLoop(true)\n    gatlingSound.play()\n  })\n  PubSub.subscribe('x.drones.gun.stop', (msg, drone) => {\n    gatlingSound.stop()\n  })\n\n  const missileSound = new Audio(camera.listener)\n  PubSub.subscribe('x.drones.missile.start', (msg, drone) => {\n    if (!weapons[1].buffer) return\n    missileSound.setBuffer(weapons[1].buffer)\n    missileSound.play()\n  })\n  PubSub.subscribe('x.drones.missile.stop', (msg, drone) => {\n    missileSound.stop()\n  })\n}\n\nexport default setupSound\n","import {\n  Vector4,\n  Matrix4,\n  Color\n} from 'three'\nimport waterFragmentShader from './water_frag.glsl'\nimport waterVertexShader from './water_vert.glsl'\nimport underwaterFragmentShader from './underwater_frag.glsl'\nimport underwaterVertexShader from './underwater_vert.glsl'\n\nconst WaterShader = {\n\n  uniforms: {\n\n    'color': {type: 'c', value: null},\n    'reflectivity': {type: 'f', value: 0},\n    'surface': {type: 'f', value: 0},\n    'tReflectionMap': {type: 't', value: null},\n    'tRefractionMap': {type: 't', value: null},\n    'tNormalMap0': {type: 't', value: null},\n    'tNormalMap1': {type: 't', value: null},\n    'tDepth': {type: 't', value: null},\n    'textureMatrix': {type: 'm4', value: null},\n    'clipToWorldMatrix': {type: 'm4', value: null},\n    'config': {type: 'v4', value: new Vector4()}\n  },\n  vertexShader: waterVertexShader,\n  fragmentShader: waterFragmentShader\n}\n\nconst UnderwaterShader = {\n  uniforms: {\n    color: {type: 'c', value: new Color(0xffffff)},\n    reflectivity: {type: 'f', value: 0.75},\n    waterLevel: {type: 'f', value: 0},\n    tDepth: { type: 't', value: null },\n    tDiffuse: { type: 't', value: null },\n    tReflectionMap: { type: 't', value: null },\n    tReflectionDepth: { type: 't', value: null },\n    tNormalMap0: { type: 't', value: null },\n    tNormalMap1: { type: 't', value: null },\n\n    clipToWorldMatrix: { type: 'm4', value: null },\n    worldToClipMatrix: { type: 'm4', value: new Matrix4() },\n    cameraPosition: {type: 'v3', value: null},\n    sunPosition: {type: 'v3', value: null},\n    time: {type: 'f', value: 0}\n  },\n  vertexShader: underwaterVertexShader,\n  fragmentShader: underwaterFragmentShader\n}\n\nconst WiggleShader = {\n  uniforms: {\n    tDiffuse: { type: 't', value: null },\n    time: {type: 'f', value: 0}\n  },\n  vertexShader: `\n    varying vec2 vUv;\n\n    void main() {\n\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n      vUv = uv;\n\n    }\n  `,\n  fragmentShader: `\n    uniform float time;\n    uniform sampler2D tDiffuse;\n    varying vec2 vUv;\n\n    float frequency = 10.;\n    float amplitude = 0.005;\n\n    void main() {\n      vec2 uv = vUv;\n      float X = vUv.x * frequency + time;\n      float Y = vUv.y * frequency + time;\n      uv.y += cos(X + Y) * amplitude * cos(Y);\n      uv.x += sin(X - Y) * amplitude * sin(Y);\n      gl_FragColor = texture2D(tDiffuse, uv);\n    }\n  `\n}\n\nexport {WaterShader, UnderwaterShader, WiggleShader}\n","import './index.css'\nimport {\n  Scene,\n  PerspectiveCamera,\n  CubeCamera,\n  Vector2,\n  Vector3,\n  WebGLRenderer,\n  PCFSoftShadowMap,\n  Uncharted2ToneMapping,\n  FogExp2,\n  Mesh,\n  SphereBufferGeometry,\n  MeshBasicMaterial,\n  WebGLRenderTarget,\n  DepthTexture,\n  Matrix4,\n  MeshDepthMaterial,\n\n  // Water imports\n  PlaneBufferGeometry,\n  TextureLoader,\n  RepeatWrapping\n} from 'three'\nimport dat from 'dat.gui/build/dat.gui.js'\nimport Stats from 'stats.js'\nimport queryString from 'query-string'\nimport {WindowResize} from './modules/WindowResize'\n// import {ShadowMapViewer} from './modules/ShadowMapViewer'\nimport {initSky} from './sky'\nimport {initLights, dirLight} from './lights'\nimport {tileBuilder} from './loops/tileBuilder'\nimport {\n  initDoF,\n  lensFlare,\n  motionBlurShader\n} from './postprocessing'\nimport {material} from './terrain'\nimport {particleGroups} from './particles'\nimport PubSub from './events'\nimport setupDrones from './drones'\nimport controls from './controls'\nimport setupSound from './sound'\n\nimport {\n  EffectComposer,\n  ShaderPass,\n  RenderPass,\n  SavePass,\n  CopyShader,\n  BlendShader,\n  GlitchPass,\n  Water,\n  Reflector\n} from './modules'\nimport {\n  WaterShader,\n  UnderwaterShader,\n  WiggleShader\n} from './ocean'\n\nconst queryStringOptions = queryString.parse(window.location.search)\nconst options = {\n  PBR: queryStringOptions.PBR === 'true',\n  shadows: queryStringOptions.shadows === 'true',\n  postprocessing: queryStringOptions.postprocessing === 'true'\n}\nif (options.PBR) {\n  // PBR material needs an envMap\n  options.postprocessing = true\n}\nconsole.log(options)\n\nconst scene = new Scene()\nlet camera = new PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1e6)\nvar cubeCamera = new CubeCamera(1, 1e6, 1024)\n\nwindow.cube = cubeCamera\ncubeCamera.up.set(0, 0, 1)\n\ncamera.up = new Vector3(0, 0, 1)\ncamera.position.set(-70, 175, 345)\ncamera.lookAt(0, -400, 0)\ncamera.rollAngle = 0\n\nsetupSound()\n\nvar renderer = new WebGLRenderer({\n  antialias: true,\n  alpha: true\n})\n\nrenderer.gammaInput = true\nrenderer.gammaOutput = true\nrenderer.shadowMap.enabled = options.shadows\nrenderer.shadowMap.bias = 0.001\nrenderer.shadowMap.type = PCFSoftShadowMap\nrenderer.shadowMap.autoUpdate = true\nrenderer.physicallyCorrectLights = true\nrenderer.toneMapping = Uncharted2ToneMapping\n\nrenderer.setSize(window.innerWidth, window.innerHeight)\ndocument.body.appendChild(renderer.domElement)\n\nwindow.scene = scene\nwindow.renderer = renderer\nwindow.camera = camera\n\nconst gui = new dat.GUI({ autoPlace: false })\ngui.closed = true\nwindow.document.getElementsByClassName('guiPane')[0].appendChild(gui.domElement)\nwindow.gui = gui\nPubSub.publish('x.gui.init', {gui})\n\nconst rendererFolder = gui.addFolder('Level of detail')\nconst RendererController = function () {\n  this.low = () => {\n    window.location.href = window.location.pathname + '?' +\n    queryString.stringify({\n      PBR: false,\n      shadows: false,\n      postprocessing: false\n    })\n  }\n  this.lowShadow = () => {\n    window.location.href = window.location.pathname + '?' +\n    queryString.stringify({\n      PBR: false,\n      shadows: true,\n      postprocessing: false\n    })\n  }\n  this.lowShadowDoF = () => {\n    window.location.href = window.location.pathname + '?' +\n    queryString.stringify({\n      PBR: false,\n      shadows: true,\n      postprocessing: true\n    })\n  }\n  this.high = () => {\n    window.location.href = window.location.pathname + '?' +\n    queryString.stringify({\n      PBR: true,\n      shadows: true,\n      postprocessing: true\n    })\n  }\n}\nconst rendererController = new RendererController()\nconst lowController = rendererFolder.add(rendererController, 'low')\nlowController.name('low (default)')\nrendererFolder.add(rendererController, 'lowShadow')\nrendererFolder.add(rendererController, 'lowShadowDoF')\nrendererFolder.add(rendererController, 'high')\nscene.fog = new FogExp2(0x91abb5, 0.0005)\n\nconst drone = new Mesh(\n  new SphereBufferGeometry(5, 5, 5),\n  new MeshBasicMaterial({\n    color: 0xffffff\n  })\n)\ndrone.visible = false\nscene.add(drone)\n\nconst sunPosition = new Vector3()\nwindow.sunPosition = sunPosition\ninitSky(scene, sunPosition, gui)\nconst envMapScene = new Scene()\nconst sky2 = initSky(envMapScene, new Vector3().copy(sunPosition))\ninitLights(scene, sunPosition)\ndirLight.target = drone\nscene.add(lensFlare)\n\n// ##########################\nconst waterParameters = {\n  oceanSide: 20000,\n  size: 1.0,\n  distortionScale: 3.7,\n  alpha: 1.0\n}\nconst waterGeometry = new PlaneBufferGeometry(waterParameters.oceanSide * 5, waterParameters.oceanSide * 5, 10, 10)\n\nconst textureLoader = new TextureLoader().setCrossOrigin('anonymous')\nconst water = new Water(\n  waterGeometry,\n  {\n    textureWidth: 512,\n    textureHeight: 512,\n    color: 0xffffff,\n    flowDirection: new Vector2(1, 1),\n    scale: 20000 / 15.0,\n    normalMap0: textureLoader.load(require('./textures/Water_1_M_Normal.jpg')),\n    normalMap1: textureLoader.load(require('./textures/Water_2_M_Normal.jpg')),\n    clipBias: 0.00001,\n    reflectivity: 0.2,\n    shader: WaterShader,\n    flowSpeed: 0.1\n  }\n)\nwindow.water = water\nconst waterTarget = new WebGLRenderTarget(window.innerWidth, window.innerHeight)\nconst depthMaterial = new MeshDepthMaterial()\nwaterTarget.depthBuffer = true\nwaterTarget.depthTexture = new DepthTexture()\nwater.material.uniforms.tDepth.value = waterTarget.depthTexture\n\nwater.up.set(0, 0, 1)\n// water.rotation.z = -Math.PI / 2\nwater.position.z = 75\nwater.material.uniforms.surface.value = water.position.z\ngui.__folders['Sun, sky and ocean'].add(water.position, 'z', 0, 200, 1)\nwater.receiveShadow = true\nwater.userData.isWater = true\nwindow.water = water\nscene.add(water)\n\nconst underwaterReflector = new Reflector(waterGeometry, {\n  textureWidth: 512,\n  textureHeight: 512,\n  clipBias: 0.00001\n  // shader: WaterRefractionShader\n})\nunderwaterReflector.rotation.y = Math.PI\nunderwaterReflector.up.set(0, 0, -1)\nunderwaterReflector.position.copy(water.position)\nunderwaterReflector.getRenderTarget().depthBuffer = true\nunderwaterReflector.getRenderTarget().depthTexture = new DepthTexture()\nwindow.ref = underwaterReflector\nunderwaterReflector.updateMatrixWorld()\n// ##########################\n\nsetupDrones()\n\nparticleGroups.forEach(group => scene.add(group.mesh))\n// var helper = new CameraHelper( camera );\n// scene.add( helper );\n\n// const shadowMapViewer = new ShadowMapViewer(dirLight)\nlet shakeCamera = false\nlet shakeAmplitude = 1\nPubSub.subscribe('x.camera.shake.start', (msg, value = 1) => (shakeCamera = true))\nPubSub.subscribe('x.camera.shake.stop', () => (shakeCamera = false))\n\nlet loops = [\n  tileBuilder,\n  () => lensFlare.position.copy(sunPosition),\n  (timestamp, delta) => {\n    particleGroups.forEach(group => group.tick(delta / 1000))\n  },\n  () => {\n    if (shakeCamera) {\n      camera.position.add({\n        x: (Math.random() - 0.5) * shakeAmplitude,\n        y: (Math.random() - 0.5) * shakeAmplitude,\n        z: (Math.random() - 0.5) * shakeAmplitude\n      })\n      glitch.enabled = true\n      motionPass.renderToScreen = false\n    } else {\n      glitch.enabled = false\n      motionPass.renderToScreen = true\n    }\n  },\n  (timestamp, delta) => {\n    if (camera.position.z < water.position.z) {\n      underwaterPass.enabled = true\n      wigglePass.enabled = true\n      water.visible = false\n      underwaterReflector.onBeforeRender(renderer, scene, camera)\n      underwaterPass.material.uniforms.time.value = timestamp / 1000\n      wigglePass.material.uniforms.time.value = timestamp / 1000\n      controls.setAcceleration(30)\n    } else {\n      underwaterPass.enabled = false\n      wigglePass.enabled = false\n      water.visible = true\n      controls.setAcceleration(60)\n    }\n  }\n]\nconst removeLoop = (loop) => {\n  loops = loops.filter(item => item !== loop)\n}\nPubSub.subscribe('x.loops.remove', (msg, loop) => removeLoop(loop))\nPubSub.subscribe('x.loops.push', (msg, loop) => loops.push(loop))\nPubSub.subscribe('x.loops.unshift', (msg, loop) => loops.unshift(loop))\n\nwindow.loops = loops\nPubSub.publish('x.loops.loaded')\nconst cleanLoops = () => {\n  loops.forEach(loop => {\n    if (loop.alive !== undefined && loop.alive === false && loop.object) {\n      scene.remove(loop.object)\n    }\n  })\n  loops = loops.filter(loop => loop.alive === undefined || loop.alive === true)\n}\n\n// postprocessing\nconst dofEffect = options.postprocessing ? initDoF(scene, renderer, camera, gui) : null\n// ###################################\n// EFFECTS\n// define a render target with a depthbuffer\nconst target = new WebGLRenderTarget(window.innerWidth, window.innerHeight)\ntarget.depthBuffer = true\ntarget.depthTexture = new DepthTexture()\n\nconst composer = new EffectComposer(renderer, target)\n\n// initial render pass\nconst renderPass = new RenderPass(scene, camera)\ncomposer.addPass(renderPass)\n\n// add an underwater shader pass\nconst underwaterPass = new ShaderPass(UnderwaterShader)\nunderwaterPass.enabled = false\nunderwaterPass.material.uniforms.waterLevel.value = water.position.z\nunderwaterPass.material.uniforms.tDepth.value = waterTarget.depthTexture\nunderwaterPass.material.uniforms.cameraPosition.value = camera.position\nunderwaterPass.material.uniforms.sunPosition.value = sunPosition\nunderwaterPass.material.uniforms.tReflectionMap.value = underwaterReflector.getRenderTarget().texture\nunderwaterPass.material.uniforms.tReflectionDepth.value = underwaterReflector.getRenderTarget().depthTexture\nlet tNormalMap0 = underwaterPass.material.uniforms.tNormalMap0\nlet tNormalMap1 = underwaterPass.material.uniforms.tNormalMap1\ntNormalMap0.value = textureLoader.load(require('./textures/Water_1_M_Normal.jpg'))\ntNormalMap1.value = textureLoader.load(require('./textures/Water_2_M_Normal.jpg'))\ntNormalMap0.value.wrapS = tNormalMap0.value.wrapT = RepeatWrapping\ntNormalMap1.value.wrapS = tNormalMap1.value.wrapT = RepeatWrapping\ncomposer.addPass(underwaterPass)\nwindow.upass = underwaterPass\n\n// add an underwater wiggle pass\nconst wigglePass = new ShaderPass(WiggleShader)\nwigglePass.enabled = false\ncomposer.addPass(wigglePass)\n\n// add a motion blur pass\nconst motionPass = new ShaderPass(motionBlurShader, 'tColor')\nmotionPass.renderToScreen = true\nmotionPass.material.uniforms.tDepth.value = waterTarget.depthTexture\nmotionPass.material.uniforms.velocityFactor.value = 1\ncomposer.addPass(motionPass)\n\n// define variables used by the motion blur pass\nlet previousMatrixWorldInverse = new Matrix4()\nlet previousProjectionMatrix = new Matrix4()\nlet previousCameraPosition = new Vector3()\nlet tmpMatrix = new Matrix4()\n\n// add a glitch pass\nconst glitch = new GlitchPass()\nglitch.renderToScreen = true\ncomposer.addPass(glitch)\n// ###################################\n\n// Start the app\nrenderer.setPixelRatio(1.0)\n\nconst stats = new Stats()\ndocument.body.appendChild(stats.dom)\n\nlet play = true\nPubSub.subscribe('x.toggle.play', () => { play = !play })\n\nlet lastTimestamp = 0\nvar mainLoop = (timestamp) => {\n  requestAnimationFrame(mainLoop)\n  let delta = timestamp - lastTimestamp\n  lastTimestamp = timestamp\n\n  if (play) {\n    loops.forEach(loop => {\n      loop.loop ? loop.loop(timestamp, delta) : loop(timestamp, delta)\n    })\n\n    if (options.postprocessing) {\n      water.visible = false\n      sky2.material.uniforms.sunPosition.value = sunPosition\n      cubeCamera.update(renderer, envMapScene)\n      const envMap = cubeCamera.renderTarget\n      material.uniforms.envMap.value = envMap.texture\n\n      dofEffect.renderDepth()\n      dofEffect.composer.render()\n    } else {\n      // render to depth target\n      scene.overrideMaterial = depthMaterial\n      water.visible = false\n      renderer.render(scene, camera, waterTarget)\n      water.visible = true\n      scene.overrideMaterial = null\n\n      // update motion blur shader uniforms\n      motionPass.material.uniforms.delta.value = delta\n      // tricky part to compute the clip-to-world and world-to-clip matrices\n      motionPass.material.uniforms.clipToWorldMatrix.value\n        .getInverse(camera.matrixWorldInverse).multiply(tmpMatrix.getInverse(camera.projectionMatrix))\n      motionPass.material.uniforms.previousWorldToClipMatrix.value\n        .copy(previousProjectionMatrix.multiply(previousMatrixWorldInverse))\n      motionPass.material.uniforms.cameraMove.value.copy(camera.position).sub(previousCameraPosition)\n\n      // water uniforms\n      water.material.uniforms.clipToWorldMatrix.value = motionPass.material.uniforms.clipToWorldMatrix.value\n      underwaterPass.material.uniforms.clipToWorldMatrix.value = motionPass.material.uniforms.clipToWorldMatrix.value\n      underwaterPass.material.uniforms.worldToClipMatrix.value\n        .copy(camera.projectionMatrix).multiply(camera.matrixWorldInverse)\n\n      // render the postprocessing passes\n      composer.render(delta)\n\n      // save some values for the next render pass\n      previousMatrixWorldInverse.copy(camera.matrixWorldInverse)\n      previousProjectionMatrix.copy(camera.projectionMatrix)\n      previousCameraPosition.copy(camera.position)\n    }\n\n    // if (dirLight.shadow && dirLight.shadow.map) {\n    //   shadowMapViewer.render(renderer)\n    // }\n  }\n\n  cleanLoops()\n\n  stats.update()\n}\n\nmainLoop(0)\n\nWindowResize(renderer, camera)\n\nexport {renderer, scene, camera, drone, sunPosition, gui, options, loops}\n","import PubSub from '../events'\n\nconst WindowResize = function (renderer, camera, dimension) {\n  dimension = dimension || function () { return { width: window.innerWidth, height: window.innerHeight } }\n  var callback = function () {\n        // fetch target renderer size\n    var rendererSize = dimension()\n        // notify the renderer of the size change\n    renderer.setSize(rendererSize.width, rendererSize.height)\n        // update the camera\n    camera.aspect = rendererSize.width / rendererSize.height\n    camera.updateProjectionMatrix()\n\n    PubSub.publish('x.screen.resized', rendererSize)\n  }\n    // bind the resize event\n  window.addEventListener('resize', callback, false)\n    // return .stop() the function to stop watching window resize\n  return {\n    trigger: function () {\n      callback()\n    },\n        /**\n         * Stop watching window resize\n        */\n    destroy: function () {\n      window.removeEventListener('resize', callback)\n    }\n  }\n}\n\nexport {WindowResize}\n"],"sourceRoot":""}