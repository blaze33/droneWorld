(this.webpackJsonp=this.webpackJsonp||[]).push([[0],[,,,function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return i}),n.d(t,"a",function(){return a}),n.d(t,"f",function(){return r}),n.d(t,"e",function(){return l}),n.d(t,"c",function(){return s}),n.d(t,"d",function(){return c}),n.d(t,"g",function(){return u});var o=n(0);e.THREE=o,n(73),n(74),n(75),n(76),n(77),n(78),n(79),n(80),n(81),n(82),n(83),n(84),n(85),n(86),n(87),n(88),n(89),n(90),n(91);var i=e.THREE.GLTFLoader,a=(e.THREE.Sky,e.THREE.Octree,e.THREE.BlendShader,e.THREE.CopyShader,e.THREE.WaterRefractionShader,e.THREE.BokehShader,e.THREE.EffectComposer),r=e.THREE.ShaderPass,l=e.THREE.RenderPass,s=(e.THREE.SavePass,e.THREE.GlitchPass),c=(e.THREE.Lensflare,e.THREE.LensflareElement,e.THREE.Reflector),u=(e.THREE.Refractor,e.THREE.Water);e.THREE.SimplifyModifier,e.THREE.MarchingCubes}).call(this,n(4))},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){e.exports=n.p+"static/media/Rock_08_UV_H_CM_1.da494a88.jpg"},function(e,t,n){e.exports=n.p+"static/media/Rock_08_UV_H_CM_1_normal.6085c2f7.jpg"},function(e,t,n){e.exports=n.p+"static/media/GrassGreenTexture0003.78621f63.jpg"},function(e,t,n){e.exports=n.p+"static/media/GrassGreenTexture0003_normal.002f20c3.jpg"},,,,,,,,function(e,t,n){e.exports=n.p+"static/media/Water_1_M_Normal.a33d50da.jpg"},function(e,t,n){e.exports=n.p+"static/media/Water_2_M_Normal.639428cf.jpg"},,,,function(e,t,n){e.exports=function(){return new Worker(n.p+"38ac1dece4b7088e71bc.worker.js")}},function(e,t){e.exports="#define PHYSICAL\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\tvarying vec3 vNormal2;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#include <envmap_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\t#include <envmap_vertex>\n\n\tvNormal2 = normal;\n}\n"},function(e,t){e.exports="#define PHYSICAL\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n// ####### custom uniforms #########\nuniform sampler2D rockTexture;\nuniform sampler2D rockTextureNormal;\n// #################################\n\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vWorldPosition;\nvarying vec3 vNormal2;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvec4 physicalColor(sampler2D map, sampler2D normalMap, float roughness, float metalness) {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t// #include <specularmap_fragment>\n\t// #include <envmap_fragment>\n\t// return vec4(envColor.rgb, 1.0);\n\treturn vec4(outgoingLight, diffuseColor.a);\n}\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 grassColor = physicalColor(map, normalMap, roughness, metalness);\n\tvec4 rockColor = physicalColor(rockTexture, rockTextureNormal, 0.4, 0.15);\n\tvec3 normal = normalize( vNormal2 );\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\tfloat flatness = dot(normal, vec3(0.0, 0.0, 1.0));\n\tvec4 colorTerrain = mix(\n\t\trockColor,\n\t\t// rockColor,\n\t\tgrassColor,\n\t\tsmoothstep(0.6, 0.7, flatness)\n\t);\n\tgl_FragColor = colorTerrain;\n\t// gl_FragColor = vec4(vec3(vWorldPosition.z/100.0), 1.0);\n\tvec3 outgoingLight = gl_FragColor.rgb;\n\t#include <specularmap_fragment>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4(outgoingLight.rgb, gl_FragColor.a);\n\n\n\t// gl_FragColor = vec4(material.specularColor, 1.0);\n\t// gl_FragColor = vec4(reflectedLight.indirectDiffuse, 1.0);\n\t// gl_FragColor = vec4(directLight.direction, 1.0);\n\t// // gl_FragColor = texture2D(map, vUv);\n\t// gl_FragColor = vec4(normal, 1.0);\n\t// gl_FragColor = vec4(material.diffuseColor, 1.0);\n\t// gl_FragColor = vec4(metalness, metalness, metalness, 1.0);\n\t// gl_FragColor = vec4(diffuseColor.rgb * ( 1.0 - metalnessFactor ), 1.0);\n\t// gl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n\t//  FOG\n\t// #include <fog_fragment>\n\treflectVec = refract( cameraToVertex, worldNormal, 1.0 );\n\tvec4 fogColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\tfogFactor = mix(fogFactor, fogFactor / 10.0, smoothstep(100.0, 300.0, vWorldPosition.z));\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor.rgb, fogFactor );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n"},function(e,t){e.exports="#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\nvarying vec3 vNormal2;\nvarying float flatness;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n\tvNormal2 = normalize(normal);\n\tflatness = dot(normal, vec3(0.0, 0.0, 1.0));\n}\n"},function(e,t){e.exports="#define STANDARD\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n// ####### custom uniforms #########\nuniform sampler2D rockTexture;\nuniform sampler2D rockTextureNormal;\n// #################################\n\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vWorldPosition;\nvarying vec3 vNormal2;\nvarying float flatness;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n\n// #include <normalmap_pars_fragment>\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvec4 physicalColor(sampler2D map, sampler2D normalMap, float roughness, float metalness) {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t// #include <specularmap_fragment>\n\t// #include <envmap_fragment>\n\t// return vec4(envColor.rgb, 1.0);\n\treturn vec4(outgoingLight, diffuseColor.a);\n}\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 grassColor = physicalColor(map, normalMap, roughness, metalness);\n\tvec4 rockColor = physicalColor(rockTexture, rockTextureNormal, 0.4, 0.15);\n\tvec4 colorTerrain = mix(\n\t\trockColor,\n\t\tgrassColor,\n\t\tsmoothstep(0.6, 0.7, flatness)\n\t);\n\tgl_FragColor = colorTerrain;\n\t// gl_FragColor = vec4(vec3(vWorldPosition.z/100.0), 1.0);\n\tvec3 outgoingLight = gl_FragColor.rgb;\n\t#include <specularmap_fragment>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4(outgoingLight.rgb, gl_FragColor.a);\n\n\n\t// gl_FragColor = vec4(material.specularColor, 1.0);\n\t// gl_FragColor = vec4(reflectedLight.indirectDiffuse, 1.0);\n\t// gl_FragColor = vec4(directLight.direction, 1.0);\n\t// // gl_FragColor = texture2D(map, vUv);\n\t// gl_FragColor = vec4(normal, 1.0);\n\t// gl_FragColor = vec4(material.diffuseColor, 1.0);\n\t// gl_FragColor = vec4(metalness, metalness, metalness, 1.0);\n\t// gl_FragColor = vec4(diffuseColor.rgb * ( 1.0 - metalnessFactor ), 1.0);\n\t// gl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n\t#include <fog_fragment>\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n\t// gl_FragColor = vec4(normal, 1.0);\n\n}\n"},,,,,function(e,t){e.exports="#include <common>\n#include <fog_pars_fragment>\n\nuniform sampler2D tReflectionMap;\nuniform sampler2D tRefractionMap;\nuniform sampler2D tNormalMap0;\nuniform sampler2D tNormalMap1;\nuniform sampler2D tDepth;\n\n#ifdef USE_FLOWMAP\nuniform sampler2D tFlowMap;\n#else\nuniform vec2 flowDirection;\n#endif\n\nuniform vec3 color;\nuniform float reflectivity;\nuniform float surface;\nuniform vec4 config;\nuniform mat4 clipToWorldMatrix;\n\nvarying vec4 vCoord;\nvarying vec2 vUv;\nvarying vec3 vToEye;\n\nvec3 surfaceColor = vec3(0.0078, 0.5176, 0.7);\nvec3 shoreColor = vec3(0.0078, 0.5176, 0.7);\nvec3 depthColor = vec3(0.0039, 0.00196, 0.145);\n// Description : Water color based on water depth and color extinction\n//\n// based on Rendering Water as a Post-process Effect by Wojciech Toman\n//\n\n// waterTransparency - x = , y = water visibility along eye vector,\n// waterDepthValues - x = water depth in world space, y = view/accumulated water depth in world space\nvec3 DepthRefraction(float waterDepth, float viewWaterDepth, vec3 refractionColor)\n{\n  float waterClarity = 0.75;\n  float visibility = 200.;\n  float shoreRange = 50.;\n  float horizontalExtinction = 200.;\n\n  float accDepth = viewWaterDepth * waterClarity; // accumulated water depth\n  float accDepthExp = saturate(accDepth / (2.5 * visibility));\n  accDepthExp *= (1.0 - accDepthExp) * accDepthExp * accDepthExp + 1.0; // out cubic\n\n  surfaceColor = mix(shoreColor, surfaceColor, saturate(waterDepth / shoreRange));\n  vec3 waterColor = mix(surfaceColor, depthColor, saturate(waterDepth / horizontalExtinction));\n\n  refractionColor = mix(refractionColor, surfaceColor * waterColor, saturate(accDepth / visibility));\n  refractionColor = mix(refractionColor, depthColor, accDepthExp);\n  refractionColor = mix(refractionColor, depthColor * waterColor, saturate(waterDepth / horizontalExtinction));\n  return refractionColor;\n}\n\nvoid main() {\n\n  float flowMapOffset0 = config.x;\n  float flowMapOffset1 = config.y;\n  float halfCycle = config.z;\n  float scale = config.w;\n\n  vec3 toEye = normalize( vToEye );\n  vec3 surfacePosition = cameraPosition - vToEye;\n\n  // determine flow direction\n  vec2 flow;\n  #ifdef USE_FLOWMAP\n  flow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;\n  #else\n  flow = flowDirection;\n  #endif\n  flow.x *= - 1.0;\n\n  // sample normal maps (distort uvs with flowdata)\n  vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );\n  vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );\n\n  // linear interpolate to get the final normal color\n  float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;\n  vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\n\n  // calculate normal vector\n  //  vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n  vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0,  normalColor.g * 2.0 - 1.0, normalColor.b ));\n\n  // calculate the fresnel term to blend reflection and refraction maps\n  float theta = max( dot( toEye, normal ), 0.0 );\n  float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );\n\n  // calculate final uv coords\n  vec3 coord = vCoord.xyz / vCoord.w;\n  vec2 uv = coord.xy + coord.z * normal.xy * 0.1;\n\n  vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );\n  vec4 refractColor = texture2D( tRefractionMap, uv );\n\n  // water depth\n\n  float zOverW = texture2D(tDepth, coord.xy).x;\n  // clipPosition is the viewport position at this pixel in the range -1 to 1.\n  vec4 clipPosition = vec4(coord.xy * 2. - 1., zOverW * 2. - 1., 1.);\n  vec4 worldPosition = clipToWorldMatrix * clipPosition;\n  worldPosition /= worldPosition.w;\n\n  float waterDepth = surfacePosition.z - worldPosition.z;\n  float viewWaterDepth = length(surfacePosition - worldPosition.xyz);\n\n  float depthDensity = 0.01;\n  float depthFactor = whiteCompliment( exp2( - depthDensity * depthDensity * viewWaterDepth * viewWaterDepth * LOG2 ) );\n  refractColor.rgb = mix( refractColor.rgb, depthColor, depthFactor );\n  // refractColor.rgb = DepthRefraction(waterDepth, viewWaterDepth, refractColor.rgb);\n\n  // multiply water color with the mix of both textures\n  gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );\n  // gl_FragColor = refractColor;\n  // gl_FragColor = vec4(vec3(waterDepth/500.), 1.0);\n\n  // #include <tonemapping_fragment>\n  // #include <encodings_fragment>\n  // #include <fog_fragment>\n\n}"},function(e,t){e.exports="#include <fog_pars_vertex>\n\nuniform mat4 textureMatrix;\n\nvarying vec4 vCoord;\nvarying vec2 vUv;\nvarying vec3 vToEye;\n\nvoid main() {\n\n  vUv = uv;\n  vCoord = textureMatrix * vec4( position, 1.0 );\n\n  vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n  vToEye = cameraPosition - worldPosition.xyz;\n\n  vec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex\n  gl_Position = projectionMatrix * mvPosition;\n\n  #include <fog_vertex>\n\n}"},function(e,t){e.exports="#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\nuniform sampler2D tReflectionMap;\nuniform sampler2D tReflectionDepth;\nuniform sampler2D tNormalMap0;\nuniform sampler2D tNormalMap1;\n\n#ifdef USE_FLOWMAP\nuniform sampler2D tFlowMap;\n#else\nuniform vec2 flowDirection;\n#endif\n\nuniform vec3 color;\nuniform float reflectivity;\nuniform float time;\nuniform float waterLevel;\nuniform vec4 config;\nuniform vec3 sunPosition;\nuniform mat4 clipToWorldMatrix;\nuniform mat4 worldToClipMatrix;\n\nvarying vec4 vCoord;\nvarying vec2 vUv;\nvarying vec3 vToEye;\n\n// vec3 depthColor = vec3(0.0039, 0.00196, 0.145);\nvec3 depthColor = vec3(0.0117, 0.0117, 0.325);\n\n#define TAU 6.28318530718\n#define MAX_ITER 5\nvec3 caustic(vec2 uv) {\n  vec2 p = mod(uv*TAU, TAU)-250.0;\n\n  vec2 i = vec2(p);\n  float c = 1.0;\n  float inten = .005;\n\n  for (int n = 0; n < MAX_ITER; n++) {\n    float t = time * (1.0 - (3.5 / float(n+1)));\n    i = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));\n    c += 1.0/length(vec2(p.x / (sin(i.x+t)/inten),p.y / (cos(i.y+t)/inten)));\n  }\n\n  c /= float(MAX_ITER);\n  c = 1.17-pow(c, 1.4);\n  vec3 color = vec3(pow(abs(c), 8.0));\n  // color = clamp(color + vec3(0.0, 0.35, 0.5), 0.0, 1.0);\n  color = mix(color, vec3(1.0,1.0,1.0),0.5);\n\n  return color;\n}\n\nfloat causticX(float x, float power, float gtime) {\n  float p = mod(x*TAU, TAU)-250.0;\n\n  float i = p;;\n  float c = 1.0;\n  float inten = .005;\n\n  for (int n = 0; n < MAX_ITER/2; n++) {\n    float t = gtime * (1.0 - (3.5 / float(n+1)));\n    i = p + cos(t - i) + sin(t + i);\n    c += 1.0/length(p / (sin(i+t)/inten));\n  }\n  c /= float(MAX_ITER);\n  c = 1.17-pow(c, power);\n\n  return c;\n}\n\nfloat GodRays(vec2 uv) {\n  float light = 0.0;\n  vec4 uvSun = worldToClipMatrix * vec4(sunPosition, 1.);\n  uvSun /= uvSun.w;\n  uvSun = uvSun / 2. + 0.5;\n  vec2 uv2 = vec2(\n    dot(normalize(uv - uvSun.xy), vec2(1., 0.)),\n    length(uv - uvSun.xy)\n  );\n\n  light += pow(causticX((uv2.x + 0.08 * uv2.y) / 1.7 + 0.5, 1.8, time * 0.65), 10.0) * 0.05;\n  light += pow(causticX(sin(uv2.x), 0.3, time * 0.7), 9.0) * 0.4;\n  light += pow(causticX(cos(uv2.x * 2.3), 0.3, time * 1.3), 4.0) * 0.1;\n\n  light *= smoothstep(0., .3, uv2.y) * smoothstep(0., .3, uv2.y);\n  light = clamp(light, 0.0, 1.0);\n\n  return light;\n}\n\n#define HASHSCALE1 .1031\n#define HASHSCALE3 vec3(.1031, .1030, .0973)\nfloat hash11(float p)\n{\n  vec3 p3  = fract(vec3(p) * HASHSCALE1);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.x + p3.y) * p3.z);\n}\nvec3 hash33(vec3 p3)\n{\n  p3 = fract(p3 * HASHSCALE3);\n    p3 += dot(p3, p3.yxz+19.19);\n    return fract((p3.xxy + p3.yxx)*p3.zyx);\n}\n\nconst int   STAR_VOXEL_STEPS = 8;\nconst float STAR_VOXEL_STEP_SIZE = 3.;\n\nfloat distanceRayPoint(vec3 ro, vec3 rd, vec3 p, out float h) {\n    h = dot(p - ro, rd);\n    return length(p - ro - rd * h);\n}\nvec3 getDotColour(float t)\n{\n  return vec3(t*.57,t*.3,t*.05);\n  return vec3(t*.9,t*.9,t*.9);\n  return vec3(t*.3,t*.6,t*.5);\n}\n\n// This code is the starfield stuff from iapafoto\n// https://www.shadertoy.com/view/Xl2BRR\nvec4 detritus(in vec3 ro, in vec3 rd, in float tmax) {\n\n  float d =  0.;\n\n  vec3 ros = ro + rd*d;\n  ros /= STAR_VOXEL_STEP_SIZE;\n  vec3 pos = floor(ros),\n       mm, ri = 1./rd,\n       rs = sign(rd),\n       dis = (pos - ros + 0.5 + rs * 0.5) * ri;\n\n  float dint;\n  vec3 offset, id;\n  vec4 col = vec4(0);\n  vec4 sum = vec4(0);\n\n  for(int i = 0; i < STAR_VOXEL_STEPS; i++) {\n    id = hash33(pos);\n    float size  = hash11(float(i))*.02 + .005;\n    offset = clamp(id + .2 * cos(id + id.x * time), size, 1. - size);\n    d = distanceRayPoint(ros, rd, pos + offset, dint);\n\n    if (dint > 0. && dint * STAR_VOXEL_STEP_SIZE < tmax) {\n      col = vec4(getDotColour(id.x), .8) * smoothstep(size, 0.0, d);\n      col.a *= smoothstep(float(STAR_VOXEL_STEPS), 0., dint);\n      col.rgb *= col.a / dint;\n      sum += (1. - sum.a) * col;\n      if (sum.a>.99) break;\n    }\n\n    mm = step(dis.xyz, dis.yxy) * step(dis.xyz, dis.zzx);\n    dis += mm * rs * ri;\n    pos += mm * rs;\n  }\n\n  return sum * .75;\n}\n\n\nvoid main() {\n\n  float flowMapOffset0 = config.x;\n  float flowMapOffset1 = config.y;\n  float halfCycle = config.z;\n  float scale = config.w;\n\n  float depth = texture2D(tDepth, vUv).x;\n  float w;\n  // float logDepthBufFC = 2.0 / log2( 1000000. + 1.0 );\n  // float w = pow(2.0, (2. * depth / logDepthBufFC)) - 1.0;\n  // depth = viewZToPerspectiveDepth(-w, 1., 1000000.);\n\n  vec4 world = clipToWorldMatrix * vec4(vUv * 2. - 1., depth * 2. - 1., 1.0);\n  world /= world.w;\n  float worldDistance = length(world.xyz - cameraPosition);\n\n  vec3 dir = normalize(world.xyz - cameraPosition);\n  vec3 hitPoint = linePlaneIntersect(cameraPosition, dir, vec3(0., 0., waterLevel), vec3(0., 0., -1.));\n  float hitDirection = dot(hitPoint - cameraPosition, dir);\n  float hitDistance = hitDirection > 0. ? length(hitPoint - cameraPosition) : 1e7;\n\n  float dist = min(hitDistance, worldDistance);\n  float fogDensity = 0.007;\n  float fogFactor;\n  vec3 nearestPoint = dist == hitDistance ? hitPoint : world.xyz;\n  float waterDepth = waterLevel - nearestPoint.z;\n\n  // sample normal maps (distort uvs with flowdata)\n  vec2 nUV = fract(hitPoint.xy / 15.);\n  vec2 flow = vec2(1., 1.);\n  vec4 normalColor0 = texture2D( tNormalMap0, nUV + flow * time / 10.);\n  vec4 normalColor1 = texture2D( tNormalMap1, nUV + flow * time / 10.);\n\n  // linear interpolate to get the final normal color\n  float flowLerp = sin(time) / 2. + 0.5;\n  vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\n\n  // calculate normal vector\n  vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0,  normalColor.g * 2.0 - 1.0, -normalColor.b ));\n  vec3 waterNormal = normalize(normal);\n  vec4 coord = worldToClipMatrix * vec4(hitPoint.xy + waterNormal.xy * waterNormal.z * 3., hitPoint.z, 1.0);\n  coord /= coord.w;\n  coord = coord / 2.0 + 0.5;\n  // coord.xy = vUv;\n\n  if (worldDistance < hitDistance) {\n    gl_FragColor = texture2D(tDiffuse, vUv);\n    gl_FragColor.rgb *= caustic(nearestPoint.xy / 10.);\n  } else {\n\n    // calculate the fresnel term to blend reflection and refraction maps\n    float theta = max( dot( -dir, waterNormal ), 0.0 );\n    float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );\n    reflectance = (1. - length(refract(dir, waterNormal, 1.33))) * reflectance;\n    reflectance = clamp(reflectance, 0.15, 0.85);\n\n    vec4 reflectColor = texture2D( tReflectionMap, vec2(1. - coord.x, coord.y) );\n    vec4 reflectDepth = texture2D( tReflectionDepth, vec2(1.0 - coord.x, coord.y) );\n    vec4 refractColor = texture2D( tDiffuse, coord.xy );\n\n    // w = pow(2.0, (2. * reflectDepth.x / logDepthBufFC)) - 1.0;\n    // w = -perspectiveDepthToViewZ(reflectDepth.x, 1., 1000000.);\n    // reflectDepth.x = viewZToPerspectiveDepth(-w, 1., 1000000.);\n    w = 500. * reflectDepth.x + dist;\n\n    fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * w * w * LOG2 ) );\n    reflectColor.rgb = mix(reflectColor.rgb, depthColor, fogFactor);\n\n    // multiply water color with the mix of both textures\n    gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );\n    // gl_FragColor = vec4(vec3(reflectance), 1.0);\n    // gl_FragColor = reflectColor;\n    // gl_FragColor = reflectDepth;\n    // gl_FragColor = vec4(vec3(w/500.), 1.0);\n    // gl_FragColor = vec4(vec3(w/100.), 1.0);\n\n}\n\n// float fogDepth = dist + waterDepth * min(1., waterDepth / 100.);\nfloat fogDepth = dist + clamp(waterLevel - cameraPosition.z, 0., 100.);\nfogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\ngl_FragColor.rgb = mix(gl_FragColor.rgb, depthColor, fogFactor);\n\ngl_FragColor.rgb += GodRays(vUv) * (1. - smoothstep(0., 100., waterLevel - cameraPosition.z));\n\nvec4 star = detritus(cameraPosition, dir,  min(40., dist / STAR_VOXEL_STEP_SIZE));\ngl_FragColor.rgb = gl_FragColor.rgb * (1.0 - star.a)+star.rgb;\n\n\n// gl_FragColor = texture2D(tReflectionMap, vec2(1.0 - vUv.x, vUv.y));\n// gl_FragColor = vec4(dir, 1.);\n// gl_FragColor = vec4( vec3(dist /1000.), 1.0 );\n// gl_FragColor = vec4( vec3(hitDistance/100.), 1.0 );\n// gl_FragColor = vec4( vec3(dist/100.), 1.0 );\n\n}"},function(e,t){e.exports=" #include <fog_pars_vertex>\n\nuniform mat4 textureMatrix;\n\nvarying vec4 vCoord;\nvarying vec2 vUv;\nvarying vec3 vToEye;\n\nvoid main() {\n\nvUv = uv;\nvCoord = textureMatrix * vec4( position, 1.0 );\n\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nvToEye = cameraPosition - worldPosition.xyz;\n\nvec4 mvPosition = viewMatrix * worldPosition; // used in fog_vertex\ngl_Position = projectionMatrix * mvPosition;\n\n#include <fog_vertex>\n\n}"},function(e,t,n){e.exports=n(114)},function(e,t,n){},,,,function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAIAAABMXPacAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6Qzk3MDg1MDY1MzMzMTFFMDkwN0M4OEMxQ0JGNjFGQkIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6Qzk3MDg1MDc1MzMzMTFFMDkwN0M4OEMxQ0JGNjFGQkIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDOTcwODUwNDUzMzMxMUUwOTA3Qzg4QzFDQkY2MUZCQiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDOTcwODUwNTUzMzMxMUUwOTA3Qzg4QzFDQkY2MUZCQiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Po4pkJAAAA9KSURBVHja7F0JdqMw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"},,,,,,,function(e,t,n){e.exports=n.p+"static/media/Explosion_002_Tile_8x8_256x256.d28fc70f.png"},function(e,t,n){e.exports=n.p+"static/media/smokeparticle.4939a8d2.png"},function(e,t){e.exports="data:image/png;base64,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"},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gIBEhghhPTbNQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAABF0lEQVQ4y62TsU7DQBBE39opHKS4AuUrkjKlC/qUlPxcSij5A5cuyVdYSZVIGCGZoRlLF8sBJDjpdNZ6Zm92bzaYWJKW/hzOFiAi2jE2JshroAJWwNzhDtgDdUS8XiSQFBEh37oBHnzeAYVx78ABaIBnoBnUzJJkG+ARuAdKIE8UFsACuE2SvgySQ9Ja0k7SUVIv6fPK7o3ZuVRmblRlBWVy67g/cqw0tpLUZv6xcs35teYmsdzYFUBmBXPXNkWcSlSYs8z448psks5PpV9wZGwHtIOCvd+5T0BTRIw5mENmQ9Q2ySkBarSH2MnY+sLakraSnvzOHyM/9I4djdkOvNSJTWLbH638f8P0zTgvgBuH3oDz1Dh/AWVJt7banagAAAAAAElFTkSuQmCC"},,,,,,,,,,,,,,,,,,,,,,,function(e,t){},,function(e,t){},,,,,,,,,function(e,t,n){e.exports=n.p+"static/media/impact1.db06d2c4.ogg"},function(e,t,n){e.exports=n.p+"static/media/impact2.7d720129.ogg"},function(e,t,n){e.exports=n.p+"static/media/impact3.7a5b4e82.ogg"},function(e,t,n){e.exports=n.p+"static/media/impact4.43348926.ogg"},function(e,t,n){e.exports=n.p+"static/media/gatling.b8ff47f4.ogg"},function(e,t,n){e.exports=n.p+"static/media/missile.f0faf674.ogg"},function(e,t,n){e.exports=n.p+"static/media/explosion1.2f1ab236.ogg"},function(e,t,n){e.exports=n.p+"static/media/explosion2.752472e3.ogg"},function(e,t,n){"use strict";n.r(t);n(58);var o=n(0),i=n(41),a=n.n(i),r=n(42),l=n.n(r),s=n(9),c=n.n(s),u=n(43),d=n.n(u).a,p=function e(){var t=e.SkyShader,n=new o.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:o.UniformsUtils.clone(t.uniforms),side:o.BackSide});o.Mesh.call(this,new o.SphereBufferGeometry(1,32,15),n)};p.prototype=Object.create(o.Mesh.prototype),p.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new o.Vector3}},vertexShader:"\n        uniform vec3 sunPosition;\n        uniform float rayleigh;\n        uniform float turbidity;\n        uniform float mieCoefficient;\n\n        varying vec3 vWorldPosition;\n        varying vec3 vSunDirection;\n        varying float vSunfade;\n        varying vec3 vBetaR;\n        varying vec3 vBetaM;\n        varying float vSunE;\n\n        const vec3 up = vec3( 0.0, 0.0, 1.0 );\n\n        // constants for atmospheric scattering\n        const float e = 2.71828182845904523536028747135266249775724709369995957;\n        const float pi = 3.141592653589793238462643383279502884197169;\n\n        // wavelength of used primaries, according to preetham\n        const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\n        // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\n        // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\n        const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\n\n        // mie stuff\n        // K coefficient for the primaries\n        const float v = 4.0;\n        const vec3 K = vec3( 0.686, 0.678, 0.666 );\n        // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\n        const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\n\n        // earth shadow hack\n        // cutoffAngle = pi / 1.95;\n        const float cutoffAngle = 1.6110731556870734;\n        const float steepness = 1.5;\n        const float EE = 1000.0;\n\n        float sunIntensity( float zenithAngleCos ) {\n        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\n        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\n        }\n\n        vec3 totalMie( float T ) {\n        float c = ( 0.2 * T ) * 10E-18;\n        return 0.434 * c * MieConst;\n        }\n\n        void main() {\n\n        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n        vWorldPosition = worldPosition.xyz;\n\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n        vSunDirection = normalize( sunPosition );\n\n        vSunE = sunIntensity( dot( vSunDirection, up ) );\n\n        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.z / 450000.0 ) ), 0.0, 1.0 );\n\n        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\n\n        // extinction (absorbtion + out scattering)\n        // rayleigh coefficients\n        vBetaR = totalRayleigh * rayleighCoefficient;\n\n        // mie coefficients\n        vBetaM = totalMie( turbidity ) * mieCoefficient;\n\n        }\n    ",fragmentShader:"\n        varying vec3 vWorldPosition;\n        varying vec3 vSunDirection;\n        varying float vSunfade;\n        varying vec3 vBetaR;\n        varying vec3 vBetaM;\n        varying float vSunE;\n\n        uniform float luminance;\n        uniform float mieDirectionalG;\n\n        const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );\n\n        // constants for atmospheric scattering\n        const float pi = 3.141592653589793238462643383279502884197169;\n\n        const float n = 1.0003; // refractive index of air\n        const float N = 2.545E25; // number of molecules per unit volume for air at\n                                    // 288.15K and 1013mb (sea level -45 celsius)\n\n        // optical length at zenith for molecules\n        const float rayleighZenithLength = 8.4E3;\n        const float mieZenithLength = 1.25E3;\n        const vec3 up = vec3( 0.0, 0.0, 1.0 );\n        // 66 arc seconds -> degrees, and the cosine of that\n        const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\n\n        // 3.0 / ( 16.0 * pi )\n        const float THREE_OVER_SIXTEENPI = 0.05968310365946075;\n        // 1.0 / ( 4.0 * pi )\n        const float ONE_OVER_FOURPI = 0.07957747154594767;\n\n        float rayleighPhase( float cosTheta ) {\n        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\n        }\n\n        float hgPhase( float cosTheta, float g ) {\n        float g2 = pow( g, 2.0 );\n        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\n        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\n        }\n\n        // Filmic ToneMapping http://filmicgames.com/archives/75\n        const float A = 0.15;\n        const float B = 0.50;\n        const float C = 0.10;\n        const float D = 0.20;\n        const float E = 0.02;\n        const float F = 0.30;\n\n        const float whiteScale = 1.0748724675633854; // 1.0 / Uncharted2Tonemap(1000.0)\n\n        vec3 Uncharted2Tonemap( vec3 x ) {\n        return ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;\n        }\n\n\n        void main() {\n        // optical length\n        // cutoff angle at 90 to avoid singularity in next formula.\n        float zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );\n        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\n        float sR = rayleighZenithLength * inverse;\n        float sM = mieZenithLength * inverse;\n\n        // combined extinction factor\n        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\n\n        // in scattering\n        float cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );\n\n        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\n        vec3 betaRTheta = vBetaR * rPhase;\n\n        float mPhase = hgPhase( cosTheta, mieDirectionalG );\n        vec3 betaMTheta = vBetaM * mPhase;\n\n        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\n        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\n\n        // nightsky\n        vec3 direction = normalize( vWorldPosition - cameraPos );\n        float theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]\n        float phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]\n        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\n        vec3 L0 = vec3( 0.1 ) * Fex;\n\n        // composition + solar disc\n        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\n        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;\n\n        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\n\n        vec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );\n        vec3 color = curr * whiteScale;\n\n        vec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\n\n        gl_FragColor = vec4( retColor, 1.0 );\n\n        }"};var f=new o.DirectionalLight(16777215,4);window.dirLight=f;var m=new o.HemisphereLight(16777147,526368,.1);m.position.set(0,0,1),m.up.set(0,0,1),m.needsUpdate=!0;var v=new o.AmbientLight(4210752,.1),h=function(){f.position.copy(f.sunPosition),f.position.normalize(),f.position.multiplyScalar(1600),f.position.add(An.position)};function g(e,t,n){var i=new p;i.scale.setScalar(45e4),e.add(i);for(var a=new o.SphereGeometry(1e5,8,8),r=0;r<a.faces.length;r++){var l=a.faces[r],s=l.a;l.a=l.c,l.c=s}var c=new o.MeshBasicMaterial({opacity:0}),u=new o.Mesh(a,c);u.material.side=o.BackSide,e.add(u);var d={turbidity:10,rayleigh:2,mieCoefficient:.005,mieDirectionalG:.8,luminance:1,inclination:.32,azimuth:.2,sun:!1};if(n){var m=function(){var e=i.material.uniforms;e.turbidity.value=d.turbidity,e.rayleigh.value=d.rayleigh,e.luminance.value=d.luminance,e.mieCoefficient.value=d.mieCoefficient,e.mieDirectionalG.value=d.mieDirectionalG;var n=Math.PI*(d.inclination-.5),o=2*Math.PI*(d.azimuth-.5);t.x=v*Math.cos(o),t.z=v*Math.sin(o)*Math.sin(n),t.y=v*Math.sin(o)*Math.cos(n),e.sunPosition.value.copy(t),t.copy(t),f.position.copy(t),f.position.normalize(),f.position.multiplyScalar(2e3)},v=4e5,h=n.addFolder("Sun, sky and ocean");h.add(d,"turbidity",1,20,.1).onChange(m),h.add(d,"rayleigh",0,4,.001).onChange(m),h.add(d,"mieCoefficient",0,.1,.001).onChange(m),h.add(d,"mieDirectionalG",0,1,.001).onChange(m),h.add(d,"luminance",0,2).onChange(m),h.add(d,"inclination",0,1,1e-4).onChange(m),h.add(d,"azimuth",0,1,1e-4).onChange(m),h.add(d,"sun").onChange(m),m()}return i}var w=n(8),x=n(44),y=n.n(x),b=n(6),C=n(45),A=n.n(C),D=n(46),M=n.n(D),S=(new o.TextureLoader).setCrossOrigin("anonymous"),E=S.load(n(28)),P=S.load(n(29)),_=S.load(n(30)),T=S.load(n(31));E.wrapS=E.wrapT=o.RepeatWrapping,E.offset.set(0,0),E.repeat.set(20,20),P.wrapS=P.wrapT=o.RepeatWrapping,_.wrapS=_.wrapT=o.RepeatWrapping,T.wrapS=T.wrapT=o.RepeatWrapping;var k=n(47),z=n.n(k),R=n(48),L=n.n(R),F=(new o.TextureLoader).setCrossOrigin("anonymous"),U=F.load(n(28)),V=F.load(n(29)),B=F.load(n(30)),I=F.load(n(31));U.wrapS=U.wrapT=o.RepeatWrapping,U.offset.set(0,0),U.repeat.set(20,20),V.wrapS=V.wrapT=o.RepeatWrapping,B.wrapS=B.wrapT=o.RepeatWrapping,I.wrapS=I.wrapT=o.RepeatWrapping;var H,N,W=function(e,t){var n=new o.ShaderMaterial({uniforms:Object(b.a)({roughness:{value:.7},metalness:{value:0}},o.UniformsLib.common,o.UniformsLib.lights,o.UniformsLib.envmap,o.UniformsLib.normalmap,o.UniformsLib.fog,{rockTexture:{value:U},rockTextureNormal:{value:V}},t),defines:{STANDARD:"",USE_MAP:"",USE_NORMALMAP:""},vertexShader:z.a,fragmentShader:L.a,extensions:{derivatives:!0},wireframe:!1,lights:!0,fog:!0});return n.uniforms.map.value=B,n.uniforms.normalMap.value=I,n.roughness=.7,n.metalness=0,n.isShaderMaterial=!1,n.isMeshStandardMaterial=!0,n.uniforms.uvTransform.value=(new o.Matrix3).multiplyScalar(20),n.needsUpdate=!0,n}(),O=45.8671,j={x:(H=7.3087,N=10,(H+180)/360*Math.pow(2,N)),y:function(e,t){return(1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t)}(O,10)};window.chamonix=j;for(var G=function(e,t){var n=t.split(",").map(function(e){return parseInt(e,10)}),o=n[0],i=n[1],a=n[2],r=n[5],l=function(e){return{x:j.x/Math.pow(2,10-e),y:j.y/Math.pow(2,10-e)}}(o);e.position.set(i*r-(l.x%1-.5)*r-800*(1-j.x%1),-a*r+(l.y%1-.5)*r+800*(1-j.y%1),0)},Q=function(e,t){var n=new o.ShaderMaterial({uniforms:Object(b.a)({opacity:{value:1},clearCoat:{value:0},clearCoatRoughness:{value:0},roughness:{value:0},metalness:{value:0}},o.UniformsLib.common,o.UniformsLib.lights,o.UniformsLib.specularMap,o.UniformsLib.envmap,o.UniformsLib.aomap,o.UniformsLib.lightmap,o.UniformsLib.emissivemap,o.UniformsLib.bumpmap,o.UniformsLib.normalmap,o.UniformsLib.displacementmap,o.UniformsLib.roughnessmap,o.UniformsLib.metalnessmap,o.UniformsLib.gradientmap,o.UniformsLib.fog,o.UniformsLib.points,{rockTexture:{value:E},rockTextureNormal:{value:P}},t),defines:{PHYSICAL:"",USE_MAP:"",USE_NORMALMAP:"",USE_ENVMAP:"",ENVMAP_TYPE_CUBE:"",ENVMAP_BLENDING_MULTIPLY:"",TONE_MAPPING:""},vertexShader:A.a,fragmentShader:M.a,extensions:{derivatives:!0},wireframe:!1,lights:!0,fog:!0});return n.uniforms.map.value=_,n.uniforms.normalMap.value=T,n.uniforms.toneMappingExposure={value:3},n.uniforms.toneMappingWhitePoint={value:5},n.opacity=1,n.roughness=1,n.metalness=0,n.lightMapIntensity=1,n.aoMapIntensity=1,n.emissiveIntensity=1,n.envMapIntensity=1,n.refractionRatio=.98,n.bumpscale=1,n.normalScale=new o.Vector2(5,5),n.uniforms.reflectivity.value=.5,n.clearCoatRoughness=0,n.isShaderMaterial=!1,n.isMeshStandardMaterial=!0,n.isMeshPhysicalMaterial=!0,n.uniforms.uvTransform.value=(new o.Matrix3).multiplyScalar(20),n.needsUpdate=!0,n}(0,{}),Z=function(e){var t=new o.BufferGeometry,n=new Float32Array(e.data.positions),i=new Float32Array(e.data.normals),a=new(0,{2:Uint16Array,4:Uint32Array}[e.data.bpe.indices])(e.data.indices),r=new Float32Array(n.length/3*2),l=Math.sqrt(n.length/3);r=r.map(function(e,t){return t%2?Math.floor(t/2/l)/l:t/2%l/l}),t.addAttribute("position",new o.BufferAttribute(n,3)),t.addAttribute("normal",new o.BufferAttribute(i,3)),t.addAttribute("uv",new o.BufferAttribute(r,2)),t.setIndex(new o.BufferAttribute(a,1)),t.computeBoundingBox();var s=vn.PBR?Q:W,c=new o.Mesh(t,s);c.key=e.data.key,c.castShadow=!0,c.receiveShadow=!0,G(c,e.data.key),hn.add(c),xn.shadowMap.needsUpdate=!0},Y=[],K=navigator.hardwareConcurrency-1||3,q=0;q<K;q++){var X=new y.a;X.onmessage=Z,Y.push(X)}var J=0;Y.postMessage=function(e){Y[J].postMessage(e),J=J===K-1?0:J+1};var $=new o.Vector3(0,0,0),ee=[];window.tiles={},window.pngs={};var te=new o.Vector3,ne={uniforms:{textureWidth:{value:1},textureHeight:{value:1},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},tColor:{value:null},tDepth:{value:null},maxblur:{value:1},showFocus:{value:0},manualdof:{value:0},vignetting:{value:0},depthblur:{value:0},threshold:{value:.5},gain:{value:2},bias:{value:.5},fringe:{value:.7},znear:{value:.1},zfar:{value:100},noise:{value:1},dithering:{value:1e-4},pentagon:{value:0},shaderFocus:{value:1},focusCoords:{value:new o.Vector2}},vertexShader:"\n\n        varying vec2 vUv;\n\n        void main() {\n\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n        }",fragmentShader:"\n\n#include <common>\n\nvarying vec2 vUv;\n\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nuniform float textureWidth;\nuniform float textureHeight;\n\nuniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below\nuniform float focalLength; //focal length in mm\nuniform float fstop; //f-stop value\nuniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)\n\n/*\nmake sure that these two values are the same for your camera, otherwise distances will be wrong.\n*/\n\nuniform float znear; // camera clipping start\nuniform float zfar; // camera clipping end\n\n//------------------------------------------\n//user variables\n\nconst int samples = SAMPLES; //samples on the first ring\nconst int rings = RINGS; //ring count\n\nconst int maxringsamples = rings * samples;\n\nuniform bool manualdof; // manual dof calculation\nfloat ndofstart = 1.0; // near dof blur start\nfloat ndofdist = 2.0; // near dof blur falloff distance\nfloat fdofstart = 1.0; // far dof blur start\nfloat fdofdist = 3.0; // far dof blur falloff distance\n\nfloat CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)\n\nuniform bool vignetting; // use optical lens vignetting\n\nfloat vignout = 1.3; // vignetting outer border\nfloat vignin = 0.0; // vignetting inner border\nfloat vignfade = 22.0; // f-stops till vignete fades\n\nuniform bool shaderFocus;\n// disable if you use external focalDepth value\n\nuniform vec2 focusCoords;\n// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)\n// if center of screen use vec2(0.5, 0.5);\n\nuniform float maxblur;\n//clamp value of max blur (0.0 = no blur, 1.0 default)\n\nuniform float threshold; // highlight threshold;\nuniform float gain; // highlight gain;\n\nuniform float bias; // bokeh edge bias\nuniform float fringe; // bokeh chromatic aberration / fringing\n\nuniform bool noise; //use noise instead of pattern for sample dithering\n\nuniform float dithering;\n\nuniform bool depthblur; // blur the depth buffer\nfloat dbsize = 1.25; // depth blur size\n\n/*\nnext part is experimental\nnot looking good with small sample and ring count\nlooks okay starting from samples = 4, rings = 4\n*/\n\nuniform bool pentagon; //use pentagon as bokeh shape?\nfloat feather = 0.4; //pentagon shape feather\n\n//------------------------------------------\n\nfloat penta(vec2 coords) {\n    //pentagonal shape\n    float scale = float(rings) - 1.3;\n    vec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);\n    vec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);\n    vec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);\n    vec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);\n    vec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);\n    vec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);\n\n    vec4  one = vec4( 1.0 );\n\n    vec4 P = vec4((coords),vec2(scale, scale));\n\n    vec4 dist = vec4(0.0);\n    float inorout = -4.0;\n\n    dist.x = dot( P, HS0 );\n    dist.y = dot( P, HS1 );\n    dist.z = dot( P, HS2 );\n    dist.w = dot( P, HS3 );\n\n    dist = smoothstep( -feather, feather, dist );\n\n    inorout += dot( dist, one );\n\n    dist.x = dot( P, HS4 );\n    dist.y = HS5.w - abs( P.z );\n\n    dist = smoothstep( -feather, feather, dist );\n    inorout += dist.x;\n\n    return clamp( inorout, 0.0, 1.0 );\n}\n\nfloat bdepth(vec2 coords) {\n    // Depth buffer blur\n    float d = 0.0;\n    float kernel[9];\n    vec2 offset[9];\n\n    vec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;\n\n    offset[0] = vec2(-wh.x,-wh.y);\n    offset[1] = vec2( 0.0, -wh.y);\n    offset[2] = vec2( wh.x -wh.y);\n\n    offset[3] = vec2(-wh.x,  0.0);\n    offset[4] = vec2( 0.0,   0.0);\n    offset[5] = vec2( wh.x,  0.0);\n\n    offset[6] = vec2(-wh.x, wh.y);\n    offset[7] = vec2( 0.0,  wh.y);\n    offset[8] = vec2( wh.x, wh.y);\n\n    kernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;\n    kernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;\n    kernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;\n\n\n    for( int i=0; i<9; i++ ) {\n        float tmp = texture2D(tDepth, coords + offset[i]).r;\n        d += tmp * kernel[i];\n    }\n\n    return d;\n}\n\n\nvec3 color(vec2 coords,float blur) {\n    //processing the sample\n\n    vec3 col = vec3(0.0);\n    vec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);\n\n    col.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;\n    col.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;\n    col.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;\n\n    vec3 lumcoeff = vec3(0.299,0.587,0.114);\n    float lum = dot(col.rgb, lumcoeff);\n    float thresh = max((lum-threshold)*gain, 0.0);\n    return col+mix(vec3(0.0),col,thresh*blur);\n}\n\nvec3 debugFocus(vec3 col, float blur, float depth) {\n    float edge = 0.002*depth; //distance based edge smoothing\n    float m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);\n    float e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);\n\n    col = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);\n    col = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);\n\n    return col;\n}\n\nfloat linearize(float depth) {\n    return -zfar * znear / (depth * (zfar - znear) - zfar);\n}\n\n\nfloat vignette() {\n    float dist = distance(vUv.xy, vec2(0.5,0.5));\n    dist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);\n    return clamp(dist,0.0,1.0);\n}\n\nfloat gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {\n    float rings2 = float(rings);\n    float step = PI*2.0 / float(ringsamples);\n    float pw = cos(j*step)*i;\n    float ph = sin(j*step)*i;\n    float p = 1.0;\n    if (pentagon) {\n        p = penta(vec2(pw,ph));\n    }\n    col += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;\n    return 1.0 * mix(1.0, i /rings2, bias) * p;\n}\n\nvoid main() {\n    //scene depth calculation\n\n    float depth = linearize(texture2D(tDepth,vUv.xy).x);\n\n    // Blur depth?\n    if (depthblur) {\n        depth = linearize(bdepth(vUv.xy));\n    }\n\n    //focal plane calculation\n\n    float fDepth = focalDepth;\n\n    if (shaderFocus) {\n\n        fDepth = linearize(texture2D(tDepth,focusCoords).x);\n\n    }\n\n    // dof blur factor calculation\n\n    float blur = 0.0;\n\n    if (manualdof) {\n        float a = depth-fDepth; // Focal plane\n        float b = (a-fdofstart)/fdofdist; // Far DoF\n        float c = (-a-ndofstart)/ndofdist; // Near Dof\n        blur = (a>0.0) ? b : c;\n    } else {\n        float f = focalLength; // focal length in mm\n        float d = fDepth*1000.0; // focal plane in mm\n        float o = depth*1000.0; // depth in mm\n\n        float a = (o*f)/(o-f);\n        float b = (d*f)/(d-f);\n        float c = (d-f)/(d*fstop*CoC);\n\n        blur = abs(a-b)*c;\n    }\n\n    blur = clamp(blur,0.0,1.0);\n\n    // calculation of pattern for dithering\n\n    vec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;\n\n    // getting blur x and y step factor\n\n    float w = (1.0/textureWidth)*blur*maxblur+noise.x;\n    float h = (1.0/textureHeight)*blur*maxblur+noise.y;\n\n    // calculation of final color\n\n    vec3 col = vec3(0.0);\n\n    if(blur < 0.05) {\n        //some optimization thingy\n        col = texture2D(tColor, vUv.xy).rgb;\n    } else {\n        col = texture2D(tColor, vUv.xy).rgb;\n        float s = 1.0;\n        int ringsamples;\n\n        for (int i = 1; i <= rings; i++) {\n            /*unboxstart*/\n            ringsamples = i * samples;\n\n            for (int j = 0 ; j < maxringsamples ; j++) {\n                if (j >= ringsamples) break;\n                s += gather(float(i), float(j), ringsamples, col, w, h, blur);\n            }\n            /*unboxend*/\n        }\n\n        col /= s; //divide by sample count\n    }\n\n    if (showFocus) {\n        col = debugFocus(col, blur, depth);\n    }\n\n    if (vignetting) {\n        col *= vignette();\n    }\n\n    gl_FragColor.rgb = col;\n    // gl_FragColor.rgb = vec3(blur);\n    // gl_FragColor.rgb = texture2D(tDepth,vUv.xy).xyz;\n    // gl_FragColor.rgb = texture2D(tColor,vUv.xy).xyz;\n    gl_FragColor.a = 1.0;\n}\n"},oe={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},ie=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(ie.prototype,{setSize:function(e,t){},render:function(e,t,n,o,i){console.error("Pass: .render() must be implemented in derived pass.")}});var ae=ie,re=function(e,t){ae.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof o.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=o.UniformsUtils.clone(e.uniforms),this.material=new o.ShaderMaterial({defines:e.defines||{},uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.camera=new o.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new o.Scene,this.quad=new o.Mesh(new o.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};re.prototype=Object.assign(Object.create(ae.prototype),{constructor:re,render:function(e,t,n,o,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,this.clear)}});var le=re,se=function(e,t){ae.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1};se.prototype=Object.assign(Object.create(ae.prototype),{constructor:se,render:function(e,t,n,o,i){var a,r,l=e.context,s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),this.inverse?(a=0,r=1):(a=1,r=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(l.REPLACE,l.REPLACE,l.REPLACE),s.buffers.stencil.setFunc(l.ALWAYS,a,4294967295),s.buffers.stencil.setClear(r),e.render(this.scene,this.camera,n,this.clear),e.render(this.scene,this.camera,t,this.clear),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setFunc(l.EQUAL,1,4294967295),s.buffers.stencil.setOp(l.KEEP,l.KEEP,l.KEEP)}});var ce=function(){ae.call(this),this.needsSwap=!1};ce.prototype=Object.create(ae.prototype),Object.assign(ce.prototype,{render:function(e,t,n,o,i){e.state.buffers.stencil.setTest(!1)}});var ue=function(e,t){if(this.renderer=e,void 0===t){var n={minFilter:o.LinearFilter,magFilter:o.LinearFilter,format:o.RGBAFormat,stencilBuffer:!1},i=e.getDrawingBufferSize();(t=new o.WebGLRenderTarget(i.width,i.height,n)).texture.name="EffectComposer.rt1"}this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===oe&&console.error("EffectComposer relies on CopyShader"),void 0===le&&console.error("EffectComposer relies on ShaderPass"),this.copyPass=new le(oe)};Object.assign(ue.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e);var t=this.renderer.getDrawingBufferSize();e.setSize(t.width,t.height)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(e){var t=!1,n=this.passes.length,o=n,i=n;for(o=0;o<i;o++)if(!1!==(n=this.passes[o]).enabled){if(n.render(this.renderer,this.writeBuffer,this.readBuffer,e,t),n.needsSwap){if(t){var a=this.renderer.context;a.stencilFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),a.stencilFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==se&&(n instanceof se?t=!0:n instanceof ce&&(t=!1))}},reset:function(e){if(void 0===e){var t=this.renderer.getDrawingBufferSize();(e=this.renderTarget1.clone()).setSize(t.width,t.height)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this.renderTarget1.setSize(e,t),this.renderTarget2.setSize(e,t);for(var n=0;n<this.passes.length;n++)this.passes[n].setSize(e,t)}});var de=ue,pe=function(e,t,n,o,i){ae.call(this),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=o,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};pe.prototype=Object.assign(Object.create(ae.prototype),{constructor:pe,render:function(e,t,n,o,i){var a,r,l=e.autoClear;e.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(a=e.getClearColor().getHex(),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.render(this.scene,this.camera,this.renderToScreen?null:n,this.clear),this.clearColor&&e.setClearColor(a,r),this.scene.overrideMaterial=null,e.autoClear=l}});var fe=pe,me={shaderFocus:!0,fstop:3,maxblur:3,showFocus:!1,focalDepth:130,manualdof:!1,vignetting:!1,depthblur:!1,threshold:.5,gain:2,bias:.5,fringe:.7,focalLength:15,noise:!0,pentagon:!1,dithering:1e-4},ve=function(e,t,n,i){var a=new de(t),r=new fe(e,n);r.overrideMaterial=new o.MeshDepthMaterial,a.addPass(r);var l=new de(t),s=new fe(e,n);l.addPass(s);var c={};c.uniforms=o.UniformsUtils.clone(ne.uniforms),c.vertexShader=ne.vertexShader,c.fragmentShader=ne.fragmentShader,c.uniforms.focusCoords={value:new o.Vector2(.5,.5)},c.uniforms.textureWidth={value:window.innerWidth},c.uniforms.textureHeight={value:window.innerHeight},c.defines={RINGS:3,SAMPLES:3};var u=new le(c,"tColor");if(u.renderToScreen=!0,l.addPass(u),i){var d=function(){for(var e in me)e in u.uniforms&&(u.uniforms[e].value=me[e]);u.uniforms.znear.value=n.near,u.uniforms.zfar.value=n.far,n.setFocalLength(me.focalLength)},p=i.addFolder("Depth of Field");p.add(me,"fstop",.1,10,.001).onChange(d),p.add(me,"maxblur",0,5,.025).onChange(d),p.add(me,"showFocus").onChange(d),p.add(me,"vignetting").onChange(d),p.add(me,"threshold",0,1,.001).onChange(d),p.add(me,"gain",0,100,.001).onChange(d),p.add(me,"bias",0,3,.001).onChange(d),p.add(me,"fringe",0,5,.001).onChange(d),p.add(me,"focalLength",16,80,.001).onChange(d),d()}return{composerDepth:a,renderDepth:function(){a.render(),u.uniforms.tDepth.value=a.renderTarget2.texture},composer:l}},he=function e(){o.Mesh.call(this,e.Geometry,new o.MeshBasicMaterial({opacity:0,transparent:!0})),this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;var t=new o.Vector3,n=new o.DataTexture(new Uint8Array(768),16,16,o.RGBFormat);n.minFilter=o.NearestFilter,n.magFilter=o.NearestFilter,n.wrapS=o.ClampToEdgeWrapping,n.wrapT=o.ClampToEdgeWrapping,n.needsUpdate=!0;var i=new o.DataTexture(new Uint8Array(768),16,16,o.RGBFormat);i.minFilter=o.NearestFilter,i.magFilter=o.NearestFilter,i.wrapS=o.ClampToEdgeWrapping,i.wrapT=o.ClampToEdgeWrapping,i.needsUpdate=!0;var a=e.Geometry,r=new o.RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","void main() {","   gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","void main() {","   gl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );","}"].join("\n"),depthTest:!0,depthWrite:!1,transparent:!1}),l=new o.RawShaderMaterial({uniforms:{map:{value:n},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","   vUV = uv;","   gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","varying vec2 vUV;","void main() {","   gl_FragColor = texture2D( map, vUV );","}"].join("\n"),depthTest:!1,depthWrite:!1,transparent:!1}),s=new o.Mesh(a,r),c=[],u=ge.Shader,d=new o.RawShaderMaterial({uniforms:{map:{value:null},occlusionMap:{value:i},color:{value:new o.Color(16777215)},scale:{value:new o.Vector2},screenPosition:{value:new o.Vector3}},vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:o.AdditiveBlending,transparent:!0,depthWrite:!1}),p=new o.Mesh(a,d);this.addElement=function(e){c.push(e)};var f=new o.Vector2,m=new o.Vector2,v=new o.Box2,h=new o.Vector4;this.onBeforeRender=function(e,o,u){h.copy(e.getCurrentViewport());var g=h.w/h.z,w=h.z/2,x=h.w/2,y=16/h.w;if(f.set(y*g,y),v.min.set(h.x,h.y),v.max.set(h.x+(h.z-16),h.y+(h.w-16)),t.setFromMatrixPosition(this.matrixWorld),t.applyMatrix4(u.matrixWorldInverse),t.applyMatrix4(u.projectionMatrix),m.x=h.x+t.x*w+w-8,m.y=h.y+t.y*x+x-8,v.containsPoint(m)){e.copyFramebufferToTexture(m,n),(M=r.uniforms).scale.value=f,M.screenPosition.value=t,e.renderBufferDirect(u,null,a,r,s,null),e.copyFramebufferToTexture(m,i),(M=l.uniforms).scale.value=f,M.screenPosition.value=t,e.renderBufferDirect(u,null,a,l,s,null);for(var b=2*-t.x,C=2*-t.y,A=0,D=c.length;A<D;A++){var M,S=c[A];(M=d.uniforms).color.value.copy(S.color),M.map.value=S.texture,M.screenPosition.value.x=t.x+b*S.distance,M.screenPosition.value.y=t.y+C*S.distance;y=S.size/h.w,g=h.w/h.z;M.scale.value.set(y*g,y),d.uniformsNeedUpdate=!0,e.renderBufferDirect(u,null,a,d,p,null)}}},this.dispose=function(){r.dispose(),l.dispose(),d.dispose(),n.dispose(),i.dispose();for(var e=0,t=c.length;e<t;e++)c[e].texture.dispose()}};(he.prototype=Object.create(o.Mesh.prototype)).constructor=he,he.prototype.isLensflare=!0;var ge=function(e,t,n,i){this.texture=e,this.size=t||1,this.distance=n||0,this.color=i||new o.Color(16777215)};ge.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform sampler2D occlusionMap;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","   vUV = uv;","   vec2 pos = position.xy;","   vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","   visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","   visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","   visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","   visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","   visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","   visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","   visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","   visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","   vVisibility =        visibility.r / 9.0;","   vVisibility *= 1.0 - visibility.g / 9.0;","   vVisibility *=       visibility.b / 9.0;","   gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","   vec4 texture = texture2D( map, vUV );","   texture.a *= vVisibility;","   gl_FragColor = texture;","   gl_FragColor.rgb *= color;","}"].join("\n")},he.Geometry=function(){var e=new o.BufferGeometry,t=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),n=new o.InterleavedBuffer(t,5);return e.setIndex([0,1,2,0,2,3]),e.addAttribute("position",new o.InterleavedBufferAttribute(n,3,0,!1)),e.addAttribute("uv",new o.InterleavedBufferAttribute(n,2,3,!1)),e}();var we=(new o.TextureLoader).load(n(62)),xe=new he;xe.addElement(new ge(we,60,.6)),xe.addElement(new ge(we,70,.7)),xe.addElement(new ge(we,120,.9)),xe.addElement(new ge(we,70,1));var ye=xe,be={uniforms:{tDepth:{type:"t",value:null},tColor:{type:"t",value:null},velocityFactor:{type:"f",value:1},delta:{type:"f",value:16.67},clipToWorldMatrix:{type:"m4",value:new o.Matrix4},previousWorldToClipMatrix:{type:"m4",value:new o.Matrix4},cameraMove:{type:"v3",value:new o.Vector3}},vertexShader:"\n\tvarying vec2 vUv;\n\t\t\t\n\tvoid main() {\n\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\tvUv = uv;\n\n\t}",fragmentShader:"\n\tvarying vec2 vUv;\n\n\tuniform sampler2D tDepth;\n\tuniform sampler2D tColor;\n\n\tuniform mat4 clipToWorldMatrix;\n\tuniform mat4 previousWorldToClipMatrix;\n\n\tuniform vec3 cameraMove;\n\n\tuniform float velocityFactor;\n\tuniform float delta;\n\n\tvoid main() {\n\n\t\tfloat zOverW = texture2D(tDepth, vUv).x;\n\n\t\t// clipPosition is the viewport position at this pixel in the range -1 to 1.\n\t\tvec4 clipPosition = vec4(vUv.x * 2. - 1., vUv.y * 2. - 1., zOverW * 2. - 1., 1.);\n\n\t\tvec4 worldPosition = clipToWorldMatrix * clipPosition;\n\t\tworldPosition /= worldPosition.w;\n\t\t\n\t\tvec4 previousClipPosition = worldPosition;\n\n\t\t// Reduce motion blur due to camera translation especially at the screen center.\n\t\tpreviousClipPosition.xyz -= cameraMove * (\n\t\t\t1. - smoothstep(.3, 1., clamp(length(clipPosition.xy), 0., 1.))\n\t\t);\n\t\t\n\t\tpreviousClipPosition = previousWorldToClipMatrix * previousClipPosition;\n\t\tpreviousClipPosition /= previousClipPosition.w;\n\t\t\n\t\tvec2 velocity = velocityFactor * (clipPosition - previousClipPosition).xy / delta * 16.67;\n\n\t\tvec4 finalColor = vec4(0.);\n\t\tvec2 offset = vec2(0.); \n\t\tfloat weight = 0.;\n\t\tconst int samples = 20;\n\t\tfor(int i = 0; i < samples; i++) {  \n    \t\t\toffset = velocity * (float(i) / (float(samples) - 1.) - .5);\n    \t\t\tvec4 c = texture2D(tColor, vUv + offset);\n\t\t\tfinalColor += c;\n\t\t}  \n\t\tfinalColor /= float(samples);\n\t\tgl_FragColor = vec4(finalColor.rgb, 1.);\n\n\t\t// debug: view velocity values\n\t\t// gl_FragColor = vec4(abs(velocity), 0., 1.);\n\n\t\t// debug: view depth buffer\n\t\t// gl_FragColor = vec4(vec3(zOverW), 1.);\n\t}"},Ce=n(21),Ae=n(2),De=n.n(Ae),Me=n(16),Se=n(17),Ee=n(20),Pe=n(18),_e=n(19),Te=n(1),ke=n.n(Te),ze=n(49),Re=n.n(ze),Le=n(50),Fe=n.n(Le);var Ue,Ve,Be,Ie=function(e){var t=function(e){var t=e.clone(),n=window.innerWidth/2,o=window.innerHeight/2;return t.project(gn),t.x=t.x*n+n,t.y=-t.y*o+o,t}(e);return{x:Math.min(Math.max(10,t.x),window.innerWidth-10),y:Math.min(Math.max(10,t.y),window.innerHeight-10),z:t.z}},He=function(e){function t(){return Object(Me.a)(this,t),Object(Ee.a)(this,Object(Pe.a)(t).apply(this,arguments))}return Object(_e.a)(t,e),Object(Se.a)(t,[{key:"render",value:function(){return ke.a.createElement("svg",{x:this.props.x-this.props.size/2,y:this.props.y-this.props.size/2,viewBox:"-10 -10 415 415",width:this.props.size,height:this.props.size},ke.a.createElement("g",this.props,ke.a.createElement("circle",{cx:"202.224",cy:"202.228",r:"26.686"}),ke.a.createElement("path",{d:"M83.807,49.322L50.87,4.891c-9.519-9.527-30.71-3.78-40.236,5.747S-4.64,41.347,4.887,50.874 l44.431,32.937c9.519,9.519,24.963,9.527,34.49,0C93.334,74.284,93.326,58.84,83.807,49.322z"}),ke.a.createElement("path",{d:"M393.823,10.638c-9.527-9.527-30.71-15.274-40.236-5.747l-32.937,44.431 c-9.527,9.527-9.527,24.963,0,34.49c9.527,9.527,24.963,9.519,34.49,0l44.431-32.937 C409.096,41.347,403.349,20.164,393.823,10.638z"}),ke.a.createElement("path",{d:"M355.139,320.645c-9.527-9.527-24.963-9.527-34.49,0c-9.527,9.527-9.527,24.963,0,34.49 l32.937,44.431c9.527,9.519,30.71,3.78,40.236-5.747s15.274-30.71,5.747-40.236L355.139,320.645z"}),ke.a.createElement("path",{d:"M49.318,320.645L4.887,353.582c-9.527,9.527-3.78,30.71,5.747,40.236s30.71,15.274,40.236,5.747 l32.937-44.431c9.527-9.519,9.527-24.963,0-34.49C74.28,311.127,58.844,311.127,49.318,320.645z"})))}}]),t}(Te.PureComponent),Ne=[],We=new Set,Oe=new Set,je=new o.Vector2(window.innerWidth/2,window.innerHeight/2);d.subscribe("x.screen.resized",function(e,t){je=new o.Vector2(t.width/2,t.height/2)});var Ge=function(e){function t(e){var n;return Object(Me.a)(this,t),(n=Object(Ee.a)(this,Object(Pe.a)(t).call(this,e))).state={time:0,gunHeat:0,lockLevel:0,pilot:null},n}return Object(_e.a)(t,e),Object(Se.a)(t,[{key:"componentDidMount",value:function(){d.publish("x.hud.mounted")}},{key:"gunHeat",value:function(){if(!Ue||!Ue.gunClock.running)return Math.max(0,this.state.gunHeat-.01);var e=Ue.gunClock.getDelta(),t=this.state.gunHeat+e/1.5;return t>=1&&(d.publish("x.drones.gun.stop",Ue),d.publish("x.camera.shake.stop"),Ue.gunClock.stop()),Math.min(t,1)}},{key:"lockLevel",value:function(){var e=this;if(0===We.size)return Math.max(0,this.state.lockLevel-.02);var t=[];return We.forEach(function(n){var o=n.lockClock.getDelta();t.push(e.state.lockLevel+o/2)}),Math.min(Math.max.apply(Math,t),1)}},{key:"update",value:function(e,t){var n=this.gunHeat(),o=this.lockLevel();this.setState(Object(b.a)({},t,{time:e,gunHeat:n,lockLevel:o,lock:1===o,pilot:Ue?Ue.userData:null}))}},{key:"render",value:function(){var e=this,t=Ne.map(function(e){return Object.assign(Fe()(e.userData),{id:e.id})});return ke.a.createElement("div",null,ke.a.createElement("div",{id:"limiter"}),ke.a.createElement("div",{id:"pointer"}),ke.a.createElement("div",{id:"focal",style:this.state.focalStyle}),ke.a.createElement("div",{id:"horizon",style:this.state.horizonStyle}),this.state.pilot?ke.a.createElement("div",{id:"messages"},ke.a.createElement("div",null,this.state.pilot.altitude.toFixed(0)," m"),ke.a.createElement("div",null,this.state.pilot.speed.toFixed(0)," m/s")):null,ke.a.createElement("svg",{className:"vector"},ke.a.createElement(He,{size:"30",x:je.x,y:je.y,fill:"transparent",stroke:"#0f0",strokeWidth:"17",opacity:"0.8"}),ke.a.createElement("circle",{cx:je.x,cy:je.y,r:160,stroke:"#666",opacity:.8,strokeWidth:"10",fill:"transparent",strokeDasharray:"140 1000",transform:"rotate(155 ".concat(je.x," ").concat(je.y,")"),strokeLinecap:"round"}),this.state.lockLevel?ke.a.createElement("circle",{cx:je.x,cy:je.y,r:160,stroke:"#0f0",opacity:.8,strokeWidth:"10",fill:"transparent",strokeDasharray:"".concat(140*this.state.lockLevel," 1000"),transform:"rotate(155 ".concat(je.x," ").concat(je.y,")"),strokeLinecap:"round"}):null,ke.a.createElement("circle",{cx:je.x,cy:je.y,r:160,stroke:"#666",opacity:.8,strokeWidth:"10",fill:"transparent",strokeDasharray:"140 1000",strokeLinecap:"round",transform:"rotate(205 ".concat(je.x," ").concat(je.y,") translate(").concat(2*je.x,", 0) scale(-1, 1)")}),this.state.gunHeat?ke.a.createElement("circle",{cx:je.x,cy:je.y,r:160,stroke:"orange",opacity:.8,strokeWidth:"10",fill:"transparent",strokeDasharray:"".concat(140*this.state.gunHeat," 1000"),strokeLinecap:"round",transform:"rotate(205 ".concat(je.x," ").concat(je.y,") translate(").concat(2*je.x,", 0) scale(-1, 1)")}):null,Ne.map(function(t){return t.gunHud?ke.a.createElement("g",{key:t.id},ke.a.createElement("path",{d:"M ".concat(t.hudPosition.x," ").concat(t.hudPosition.y,"\n                    l ").concat(t.direction.x," ").concat(t.direction.y),strokeWidth:"1",stroke:t===e.state.gunTarget?"#0f0":"orange",fill:"transparent"}),t===e.state.gunTarget?ke.a.createElement(He,{size:"30",x:t.hudPosition.x+t.direction.x,y:t.hudPosition.y+t.direction.y,fill:"#0f0",fillOpacity:"0.6",stroke:"#0f0",strokeWidth:"17",strokeOpacity:"1"}):null):null})),ke.a.createElement("div",{id:"targets"},t.map(function(e){return ke.a.createElement("div",{className:"target",key:e.id,id:"target-"+e.id,style:e.hud.element.style},ke.a.createElement("div",{className:"life",style:{width:e.life/100*20}}),ke.a.createElement("div",{className:"arrow",style:e.hud.arrow.style}),ke.a.createElement("div",{className:"distance"},e.hud.distance.innerHTML),ke.a.createElement("div",{className:"name"},"drone-",e.id))})))}}]),t}(Te.Component);d.subscribe("x.hud.register.target",function(e,t){var n,i,a,r,l,s;Ne.push(t),t.userData.hud={element:{style:{}},arrow:{style:{}},distance:{style:{}}};var c=function(e,c){et.mounted&&((n=Ie(t.position)).z>1?(n.x=window.innerWidth-n.x,n.y=window.innerHeight-10,t.userData.hud.element.style.borderColor="red",t.userData.hud.arrow.style.borderBottomColor="red"):(t.userData.hud.element.style.borderColor="orange",t.userData.hud.arrow.style.borderBottomColor="orange"),t.hudPosition=n,(r=new o.Vector2(n.x,n.y).sub(je)).length()>400&&r.normalize().multiplyScalar(400),t.userData.hud.arrow.style.opacity=.8*(1-(400-r.length())/50),l=gn.position.clone().sub(t.position),a=l.length(),t.userData.hud.distance.innerHTML=a.toFixed(0),t.userData.hud.distance.style.color=a<500?"#0f0":"orange",t.userData.hud.element.style.transform="\n      translateX(".concat(r.x+je.x,"px)\n      translateY(").concat(r.y+je.y,"px)\n      scale(").concat(1.1-Math.min(.2,a/2e3),")\n    "),t.userData.hud.arrow.style.transform="\n      translateY(2px)\n      rotate(".concat(r.angle()/Math.PI*180+90,"deg)\n    "),i=r.length(),!t.destroyed&&"orange"===t.userData.hud.element.style.borderColor&&i<150?(t.userData.hud.arrow.style.borderBottomColor="#0f0",We.add(t),t.lockClock.running||t.lockClock.start()):(We.delete(t),t.lockClock.stop()),!t.destroyed&&i<390?Oe.add(t):Oe.delete(t),n.z<=1&&i<320?(s=Ie(t.position.clone().add(t.velocity.clone().multiplyScalar(Math.min(1,(a+l.clone().add(t.velocity).length())/2/500)))),t.gunHud=!0,t.direction={x:s.x-(r.x+je.x),y:s.y-(r.y+je.y)}):t.gunHud=!1)};c.id=t.id;d.subscribe("x.drones.destroy",function(e,n){n.id===t.id&&(hn.remove(n),d.publish("x.loops.remove",c),Ne=Ne.filter(function(e){return e.id!==n.id}),We.delete(t),et.forceUpdate())}),d.publish("x.loops.push",c)});var Qe,Ze,Ye,Ke,qe,Xe=new o.Vector3,Je=function(e){Qe=new o.Vector3(1,0,0).applyQuaternion(gn.quaternion),Ze=new o.Vector3(0,1,0).applyQuaternion(gn.quaternion),Ye=Math.PI/2-gn.up.angleTo(Qe)*Math.sign(gn.up.dot(Ze)),gn.rollAngle=Ye,Ke=gn.up.dot(gn.getWorldDirection(Xe)),qe=Ye/Math.PI*180,Ve={transform:"translateX(-50%) translateY(".concat(Ke*window.innerHeight/2,"px) rotate(").concat(qe,"deg)")},Be=et.state.lock?{boxShadow:"0 0 75px #0f0"}:{boxShadow:""},et.update(e,{horizonStyle:Ve,focalStyle:Be,gunTarget:$e()})};d.subscribe("x.hud.mounted",function(){d.publish("x.loops.push",Je),et.mounted=!0}),d.subscribe("x.drones.pilotDrone.loaded",function(e,t){Ue=t.pilotDrone}),d.subscribe("x.drones.missile.start",function(e,t){et.setState(function(e){return Object(b.a)({},e,{lockLevel:0,lock:!1})})});var $e=function(){if(0===We.size)return null;var e=[];return We.forEach(function(t){return e.push([new o.Vector2(t.hudPosition.x,t.hudPosition.y).sub(je).add(new o.Vector2(t.direction.x,t.direction.y)).length(),t])}),e.sort(function(e,t){return e[0]>t[0]}),e[0][1]},et=Re.a.render(ke.a.createElement(Ge,null),document.getElementById("hud")),tt=new o.TextureLoader,nt={texture:{value:tt.load(n(69)),frames:new o.Vector2(8,8),loop:1},depthTest:!0,depthWrite:!1,blending:o.AdditiveBlending,scale:600,maxParticleCount:25e3},ot={texture:{value:tt.load(n(70))},depthTest:!0,depthWrite:!1,blending:o.NormalBlending,maxParticleCount:25e3},it={texture:{value:tt.load(n(71))},depthTest:!0,depthWrite:!1,blending:o.NormalBlending,maxParticleCount:25e3},at={texture:{value:tt.load(n(72))},depthTest:!0,depthWrite:!1,blending:o.NormalBlending,maxParticleCount:25e3},rt={particleCount:200,type:De.a.distributions.DISC,position:{radius:5,spread:new o.Vector3(5)},maxAge:{value:2,spread:0},duration:1,activeMultiplier:2e3,velocity:{value:new o.Vector3(40)},rotation:{axis:new o.Vector3(0,0,1),angle:.5*Math.PI,static:!0},size:{value:2},color:{value:[new o.Color(.4,.2,.1),new o.Color(.2,.2,.2)]},opacity:{value:[.5,.2,0]}},lt={particleCount:100,type:De.a.distributions.SPHERE,position:{radius:.1},maxAge:{value:2},duration:1,activeMultiplier:40,velocity:{value:new o.Vector3(100)},acceleration:{value:new o.Vector3(0,0,-20),distribution:De.a.distributions.BOX},wiggle:3,size:{value:2,spread:5},angle:{spread:2*Math.PI},drag:{value:1},color:{value:[new o.Color(1,1,1),new o.Color(1,1,0),new o.Color(1,0,0),new o.Color(.4,.2,.1)]},opacity:{value:[1,1,0]}},st={particleCount:20,type:De.a.distributions.SPHERE,position:{radius:5},maxAge:{value:2},duration:1,activeMultiplier:20,velocity:{value:new o.Vector3(10)},size:{value:[20,100]},color:{value:[new o.Color(.5,.1,.05),new o.Color(.2,.2,.2)]},opacity:{value:[.5,.35,.1,0]}},ct={particleCount:100,position:{spread:new o.Vector3(15,15,15),distribution:De.a.distributions.SPHERE},maxAge:{value:2},duration:1,activeMultiplier:2e3,velocity:{value:new o.Vector3(8,3,10),distribution:De.a.distributions.SPHERE},size:{value:40},color:{value:new o.Color(.2,.2,.2)},opacity:{value:[0,0,.4,0]}},ut={duration:1,particleCount:50,position:{spread:new o.Vector3(5,5,5)},velocity:{spread:new o.Vector3(30),distribution:De.a.distributions.SPHERE},size:{value:[40,20,20,20]},maxAge:{value:2},activeMultiplier:2e3,opacity:{value:[1,1,0,0]}},dt={particleCount:1e3,position:{spread:new o.Vector3(1,1,1)},maxAge:{value:10},velocity:{value:new o.Vector3(4,2,5),distribution:De.a.distributions.SPHERE},size:{value:[20,60]},color:{value:new o.Color(.9,.9,.9)},opacity:{value:[.4,.4,.4,0]}},pt={particleCount:1e3,position:{spread:new o.Vector3(1,1,1)},maxAge:{value:5},velocity:{value:new o.Vector3(4,2,5),distribution:De.a.distributions.SPHERE},size:{value:[5,10]},color:{value:new o.Color(1,1,1)},opacity:{value:[.4,.4,.4,0]}},ft={particleCount:35,type:De.a.distributions.BOX,position:{radius:.1},maxAge:{value:1},duration:null,activeMultiplier:1,velocity:{value:new o.Vector3(100),spread:new o.Vector3(20,20,20)},acceleration:{value:0},size:{value:1},color:{value:[new o.Color(1,1,1),new o.Color(1,1,0)]},opacity:{value:1}},mt={particleCount:10,type:De.a.distributions.SPHERE,position:{radius:.1},maxAge:{value:.3},duration:.3,activeMultiplier:1e3,velocity:{value:new o.Vector3(100)},acceleration:{value:0},wiggle:30,size:{value:[3,1,.5]},color:{value:[new o.Color(1,1,1),new o.Color(1,1,0)]},opacity:{value:1}},vt=new De.a.Group(nt),ht=new De.a.Group(nt),gt=new De.a.Group(it),wt=new De.a.Group(ot),xt=new De.a.Group(ot),yt=new De.a.Group(ot),bt=new De.a.Group(ot),Ct=new De.a.Group(at),At=new De.a.Group(it);vt.addPool(25,ut,!1),ht.addPool(25,st,!1),gt.addPool(25,lt,!1),wt.addPool(25,rt,!1),xt.addPool(25,ct,!1),yt.addPool(25,dt,!1),bt.addPool(25,pt,!1),Ct.addPool(25,ft,!1),At.addPool(25,mt,!1);var Dt=[vt,ht,gt,wt,xt,yt,bt,Ct,At];Dt.forEach(function(e){e.mesh.renderOrder=2}),yt.mesh.renderOrder=1,Dt.forEach(function(e){e.mesh.frustumCulled=!1}),window.smokeGroup=yt;var Mt=new o.Vector3,St=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=e.getFromPool();if(null!==r){var l,s,c,u,p,f;r.position.value=a?t.position.clone().add(gn.getWorldDirection(Mt).multiplyScalar(5)):t.position.clone(),i&&(r.velocity.value=i());var m=new o.Vector3,v=function(e){return function(t,n,o){var i=Math.floor(o/e);return t[i]||(t[i]=[]),t[i].push(n),t}},h={loop:function(e,n){r.position.value=a?t.position.clone().add(gn.getWorldDirection(Mt).multiplyScalar(5)):t.position.clone(),i&&(r.velocity.value=i(),l=r.attributes.position.typedArray.array.slice(3*r.attributeOffset,3*r.activationEnd).reduce(v(3),[]),c=r.attributes.velocity.typedArray.array.slice(3*r.attributeOffset,3*r.activationEnd).reduce(v(3),[]),s=r.paramsArray.slice(4*r.attributeOffset,4*r.activationEnd).reduce(v(4),[]),u=s.map(function(e,t){return e[0]?Object(Ce.a)(o.Vector3,Object(w.a)(l[t])).add(Object(Ce.a)(o.Vector3,Object(w.a)(c[t])).multiplyScalar(e[1])):null}),p=[],u.forEach(function(e,t){null!==e&&Oe.forEach(function(i){f=new o.Line3(e,e.clone().add(Object(Ce.a)(o.Vector3,Object(w.a)(c[t])).multiplyScalar(n/1e3))),f.closestPointToPoint(i.position,!0,m).sub(i.position).length()<10&&p.push([i,e])})}),p.length&&p.forEach(function(e){d.publish("x.sound.impact",e[0]),Pt({position:e[1]}),e[0].userData.life-=5}))},alive:!0,id:t.id};return n&&!t.destroyed&&(d.publish("x.loops.push",h),d.subscribe("x.drones.destroy",function(n,o){o.id===t.id&&(h.alive=!1,r.disable(),e.releaseIntoPool(r))})),r.loop=h,r.enable(),r.duration&&setTimeout(function(){r.disable(),n&&(h.alive=!1),e.releaseIntoPool(r)},1e3*(r.duration+r.maxAge.value+r.maxAge.spread)),r}console.log("SPE.Group pool ran out.")},Et=function(e){St(vt,e),St(ht,e),St(gt,e),St(xt,e)};d.subscribe("x.drones.explode",function(e,t){return Et(t)});d.subscribe("x.drones.smoke.start",function(e,t){var n;(n=t).smoking||(n.smoking=!0,St(yt,n,!0))});d.subscribe("x.drones.missile.start",function(e,t){return function(e){if(!e.smoking){e.smoking=!0;var t=St(bt,e,!0);d.subscribe("x.drones.missile.stop",function(e,n){t.loop.alive=!1,t.disable(),bt.releaseIntoPool(t)})}}(t)});var Pt=function(e){St(At,e)},_t=new o.Vector3,Tt=new o.Vector3;d.subscribe("x.drones.gun.start",function(e,t){var n=$e();t.gunEmitter=St(Ct,t,!0,function(){if(null!==n&&n.gunHud)_t.copy(n.position).sub(t.position),_t.add(n.velocity.clone().multiplyScalar(_t.length()/500)),_t.normalize().multiplyScalar(500),Tt.copy(_t);else{Tt=gn.getWorldDirection(Mt).multiplyScalar(500);var e=new o.Vector3(0,1,0).applyQuaternion(gn.quaternion);Tt=Tt.add(e.multiplyScalar(24))}return Tt},!0)}),d.subscribe("x.drones.gun.stop",function(e,t){t.gunEmitter&&(t.gunEmitter.loop.alive=!1,t.gunEmitter.disable(),Ct.releaseIntoPool(t.gunEmitter))});var kt,zt=n(3),Rt=new zt.b,Lt=function(){Rt.load("./assets/drone/scene.gltf",function(e){kt=e.scene.children[0],d.publish("x.assets.drone.loaded",{mesh:kt})})},Ft={ready:!1},Ut={x:0,y:0,z:0};d.subscribe("x.gui.init",function(e,t){return function(e){window.droneController=Ut;var t=e.addFolder("drone");t.add(Ut,"x",0,2*Math.PI),t.add(Ut,"y",0,2*Math.PI),t.add(Ut,"z",0,2*Math.PI)}(t.gui)});var Vt=function(e,t){(Ft=function(){var e=t.mesh.clone();return e.up.set(0,0,1),e.rotation.x=0,e.scale.set(.1,.1,.1),e}).ready=!0,d.publish("x.drones.factory.ready")};d.subscribe("x.assets.drone.loaded",Vt);d.subscribe("x.drones.factory.ready",function(){var e,t,n,i=Ft();i.gunClock=new o.Clock(!1),i.userData.altitude=NaN,i.userData.speed=0,i.userData.lastPosition=i.position.clone(),hn.add(i),window.pilotDrone=i;var a,r=new o.Vector3,l=new o.Raycaster,s=new o.Vector3(0,0,-1),c=new o.Vector3(0,0,100),u=0;Fn.push(function(p,f){r=gn.getWorldDirection(r),t=gn.position.clone().add(r.multiplyScalar(20)),e=new o.Vector3(0,1,0).applyQuaternion(gn.quaternion),n=t.sub(e.multiplyScalar(8)),i.position.copy(n),i.lookAt(t.add(r).add({x:0,y:0,z:60})),i.rotation.x+=Ut.x,i.rotation.y+=Ut.y,i.rotation.z+=Ut.z,i.userData.velocity=i.position.clone().sub(i.userData.lastPosition).multiplyScalar(1e3/f),i.userData.speed=i.userData.velocity.length(),i.userData.lastPosition.copy(i.position),p-u>200&&(u=p,l.set(i.position.clone().add(c),s),(a=l.intersectObjects(gn.userData.terrainTileUnder?[gn.userData.terrainTileUnder]:[])).length>0&&(i.userData.altitude=a[0].distance-c.length(),i.userData.groundNormal=a[0].face.normal),i.userData.altitude<5&&(d.publish("x.drones.explode.pilotDrone",i),d.publish("x.drones.collision.terrain.pilotDrone",i.userData.groundNormal)))}),d.publish("x.drones.pilotDrone.loaded",{pilotDrone:i})});var Bt=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ft();n.lockClock=new o.Clock(!1),n.userData.life=100,hn.add(n),n.lastPosition=n.position.clone();var i=new o.Vector3,a=function(o,a){if(n){e?n.position.set(300*Math.cos(o/1e3/3+t),300*Math.sin(o/1e3/3+t),300+50*Math.cos(o/1e3+t)):n.position.copy(gn.position.clone().add(gn.getWorldDirection(i).multiplyScalar(100))),n.velocity=n.position.clone().sub(n.lastPosition).multiplyScalar(1e3/a),n.lastPosition=n.position.clone(),!n.destroyed&&n.userData.life<=50&&d.publish("x.drones.smoke.start",n),!n.destroyed&&n.userData.life<=0&&(d.publish("x.drones.destroy",n),n.destroyed=!0,Et(n))}};d.subscribe("x.drones.destroy",function(e,t){t.id===n.id&&d.publish("x.loops.remove",a)}),d.publish("x.hud.register.target",n),Fn.push(a)};d.subscribe("x.drones.factory.ready",function(){Bt(!0),Bt(!0,Math.PI/8),Bt(!0,Math.PI/4),Bt(!0,Math.PI/2),Bt(!0,Math.PI)}),d.subscribe("x.drones.destroy",function(){return Bt(!0,2*Math.random()*Math.PI)});var It=Lt,Ht=n(22),Nt=n.n(Ht),Wt=n(51),Ot=n.n(Wt),jt=n(52),Gt=n.n(jt);function Qt(e,t,n,i){var a=this;if(this.object=e,this.domElement=void 0!==t?t:document,t&&this.domElement.setAttribute("tabindex",-1),this.movementSpeed=.1,this.rollSpeed=.001,this.dragToLook=!1,this.autoForward=!1,this.nipple=n,this.nipple&&(this.nipple.on("move",function(e,t){return a.nipplemove(e,t)}),this.nipple.on("end",function(e,t){a.autoForward=!1,a.updateMovementVector()})),this.acceleration=60,this.velocity=new o.Vector3(0,0,0),this.pointer=i,this.pointer){var r=document.getElementById("pointer");this.zone=400,this.pointer.on("attain",function(e){var t=a.getContainerDimensions().size;r.style.left=t[0]/2+"px",r.style.top=t[1]/2+"px";var n=new o.Vector2(0,0);e.on("data",function(e){n.add(new o.Vector2(e.dx,e.dy)),n.length()>a.zone&&n.normalize().multiplyScalar(a.zone),r.style.transform="\n          translateX(".concat(n.x-16,"px)\n          translateY(").concat(n.y-16,"px)\n        "),a.mousemove({pageX:n.x/1.5,pageY:n.y/1.5})}),e.on("close",function(){})})}function l(e,t){return function(){t.apply(e,arguments)}}function s(e){e.preventDefault()}this.nipplemove=function(e,t){var n={pageX:t.distance*Math.cos(t.angle.radian)*1.5,pageY:-t.distance*Math.sin(t.angle.radian)*1.5};this.mousemove(n),this.autoForward=!0,this.updateMovementVector()},this.tmpQuaternion=new o.Quaternion,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new o.Vector3(0,0,0),this.rotationVector=new o.Vector3(0,0,0),this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.yawLeft=1;break;case 68:this.moveState.yawRight=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.yawLeft=0;break;case 68:this.moveState.yawRight=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousemove=function(e){var t=this.getContainerDimensions(),n=t.size[0]/2,o=t.size[1]/2;this.moveState.yawLeft=-e.pageX/n,this.moveState.rollLeft=this.moveState.yawLeft/2-this.object.rollAngle/5,this.moveState.pitchDown=e.pageY/o},this.deltaVelocity=null,this.deltaPosition=null,this.update=function(e){var t=e*a.rollSpeed;a.deltaVelocity=a.moveVector.clone().multiplyScalar(e/1e3*a.acceleration),a.velocity.sub(a.velocity.clone().multiplyScalar(.01*Math.max(1,a.deltaVelocity.length()?1:100/(a.velocity.length()+1))*e/16.67)).add(a.deltaVelocity),a.deltaPosition=a.velocity.clone().multiplyScalar(e/1e3),a.object.position.add(a.deltaPosition.applyQuaternion(a.object.quaternion)),a.tmpQuaternion.set(a.rotationVector.x*t,a.rotationVector.y*t,a.rotationVector.z*t,1).normalize(),a.object.quaternion.multiply(a.tmpQuaternion),a.object.rotation.setFromQuaternion(a.object.quaternion,a.object.rotation.order),a.updateRotationVector(),a.updateMovementVector()},this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!==document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",s,!1),window.removeEventListener("keydown",c,!1),window.removeEventListener("keyup",u,!1)};var c=l(this,this.keydown),u=l(this,this.keyup);this.domElement.addEventListener("contextmenu",s,!1),window.addEventListener("keydown",c,!1),window.addEventListener("keyup",u,!1),this.updateMovementVector(),this.updateRotationVector()}var Zt={module:null,setAcceleration:function(e){this.module&&e!==this.module.acceleration&&(this.module.acceleration=e,console.log("acceleration set to ",e))}},Yt=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t}();d.subscribe("x.drones.pilotDrone.loaded",function(e,t){if(Yt){document.getElementById("touchPane").style.display="block";var n=window.document.getElementsByClassName("touchPaneLeft")[0],i=Ot.a.create({zone:n,mode:"static",position:{left:"30%",top:"90%"},color:"white"});Array.from(document.getElementsByClassName("touchButton")).forEach(function(e){e.style.display="block"}),document.getElementById("verbosePane").style.display="none";var a=document.getElementById("buttonX"),r=function(e){e.target.style.opacity=.5,u({button:2}),setTimeout(function(){e.target.style.opacity=.3},250)};a.addEventListener("click",r,!1),a.addEventListener("touchstart",r,!1),Zt.module=new Qt(gn,n,i),n}else{var l=Gt()(xn.domElement);Zt.module=new Qt(gn,xn.domElement,void 0,l),xn.domElement}Zt.module.update(0),d.publish("x.loops.unshift",function(e,t){return Zt.module.update(t)});var s=t.pilotDrone;Nt.a.bind("c",function(e){console.log(gn.position)}),Nt.a.bind("r",function(e){"OrbitControls"===Zt.module.constructor.name&&(Zt.module.autoRotate=!Zt.module.autoRotate)}),Nt.a.bind("space",function(e){return d.publish("x.toggle.play")});var c=new o.Mesh(new o.SphereBufferGeometry(1,5,5),new o.MeshPhongMaterial({color:1118481})),u=function(e){if(s)if(0===e.button)d.publish("x.drones.gun.start",s),d.publish("x.camera.shake.start",5),s.gunClock.start();else if(2===e.button){var t=function(){if(0===We.size||!et.state.lock)return null;var e=[];return We.forEach(function(t){return e.push([gn.position.distanceTo(t.position),t])}),e.sort(function(e,t){return e[0]>t[0]}),e[0][1]}();if(null===t||t.destroyed)return;var n=c.clone();n.position.copy(s.position),hn.add(n),d.publish("x.drones.missile.start",n);var o=new function(){var e=this;this.alive=!0,this.object=n,this.loop=function(o,i){if(e.alive){var a=t.position.clone().sub(n.position);a.length()<10&&(e.alive=!1,Et(t),d.publish("x.drones.missile.stop",n),d.publish("x.drones.explosion",t),t.userData.life-=25,et.forceUpdate());var r=a.normalize().multiplyScalar(10*i/16.66);n.position.add(r)}}};d.publish("x.loops.push",o)}};xn.domElement.addEventListener("mousedown",u,!1),xn.domElement.addEventListener("mouseup",function(e){0===e.button&&(d.publish("x.drones.gun.stop",s),d.publish("x.camera.shake.stop"),s.gunClock.stop())},!1)});var Kt=new o.Vector3;d.subscribe("x.drones.collision.terrain.pilotDrone",function(e,t){Zt.setAcceleration(0),Kt.copy(Zt.module.velocity).applyQuaternion(gn.quaternion),Kt.reflect(t),Kt.add(gn.position),Zt.module.velocity=gn.worldToLocal(Kt),setTimeout(function(){Zt.setAcceleration(60)},1e3)});var qt=Zt,Xt=new o.AudioLoader,Jt=[{url:n(106)},{url:n(107)},{url:n(108)},{url:n(109)}],$t=[{url:n(110)},{url:n(111)}],en=[{url:n(112)},{url:n(113)}],tn=function(e){Xt.load(e.url,function(t){e.buffer=t})},nn=function(){gn.listener=new o.AudioListener,gn.add(gn.listener),Jt.map(tn),$t.map(tn),en.map(tn),d.subscribe("x.sound.impact",function(e,t){var n=Math.floor(Math.random()*Jt.length);if(Jt[n].buffer){var i=new o.PositionalAudio(gn.listener);i.setBuffer(Jt[n].buffer),i.setRefDistance(100),t.add(i),i.play()}});var e=function(e,t){var n=Math.floor(Math.random()*en.length);if(en[n].buffer){var i=new o.PositionalAudio(gn.listener);i.setBuffer(en[n].buffer),i.setRefDistance(500),t.add(i),i.play()}};d.subscribe("x.drones.destroy",e),d.subscribe("x.drones.explosion",e);var t=new o.Audio(gn.listener);d.subscribe("x.drones.gun.start",function(e,n){$t[0].buffer&&(t.setBuffer($t[0].buffer),t.setLoop(!0),t.play())}),d.subscribe("x.drones.gun.stop",function(e,n){t.stop()});var n=new o.Audio(gn.listener);d.subscribe("x.drones.missile.start",function(e,t){$t[1].buffer&&(n.setBuffer($t[1].buffer),n.play())}),d.subscribe("x.drones.missile.stop",function(e,t){n.stop()})},on=n(53),an=n.n(on),rn=n(54),ln=n.n(rn),sn=n(55),cn=n.n(sn),un=n(56),dn=n.n(un),pn={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},surface:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},tDepth:{type:"t",value:null},textureMatrix:{type:"m4",value:null},clipToWorldMatrix:{type:"m4",value:null},config:{type:"v4",value:new o.Vector4}},vertexShader:ln.a,fragmentShader:an.a},fn={uniforms:{color:{type:"c",value:new o.Color(16777215)},reflectivity:{type:"f",value:.75},waterLevel:{type:"f",value:0},tDepth:{type:"t",value:null},tDiffuse:{type:"t",value:null},tReflectionMap:{type:"t",value:null},tReflectionDepth:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},clipToWorldMatrix:{type:"m4",value:null},worldToClipMatrix:{type:"m4",value:new o.Matrix4},cameraPosition:{type:"v3",value:null},sunPosition:{type:"v3",value:null},time:{type:"f",value:0}},vertexShader:dn.a,fragmentShader:cn.a};n.d(t,"renderer",function(){return xn}),n.d(t,"scene",function(){return hn}),n.d(t,"camera",function(){return gn}),n.d(t,"drone",function(){return An}),n.d(t,"sunPosition",function(){return Dn}),n.d(t,"gui",function(){return yn}),n.d(t,"options",function(){return vn}),n.d(t,"loops",function(){return Fn});var mn=c.a.parse(window.location.search),vn={PBR:"true"===mn.PBR,shadows:"true"===mn.shadows,postprocessing:"true"===mn.postprocessing};vn.PBR&&(vn.postprocessing=!0),console.log(vn);var hn=new o.Scene,gn=new o.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1e6),wn=new o.CubeCamera(1,1e6,1024);window.cube=wn,wn.up.set(0,0,1),gn.up=new o.Vector3(0,0,1),gn.position.set(-70,175,345),gn.lookAt(0,-400,0),gn.rollAngle=0,nn();var xn=new o.WebGLRenderer({antialias:!0,alpha:!0});xn.gammaInput=!0,xn.gammaOutput=!0,xn.shadowMap.enabled=vn.shadows,xn.shadowMap.bias=.001,xn.shadowMap.type=o.PCFSoftShadowMap,xn.shadowMap.autoUpdate=!0,xn.physicallyCorrectLights=!0,xn.toneMapping=o.Uncharted2ToneMapping,xn.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(xn.domElement),window.scene=hn,window.renderer=xn,window.camera=gn;var yn=new a.a.GUI({autoPlace:!1});yn.closed=!0,window.document.getElementsByClassName("guiPane")[0].appendChild(yn.domElement),window.gui=yn,d.publish("x.gui.init",{gui:yn});var bn=yn.addFolder("Level of detail"),Cn=new function(){this.low=function(){window.location.href=window.location.pathname+"?"+c.a.stringify({PBR:!1,shadows:!1,postprocessing:!1})},this.lowShadow=function(){window.location.href=window.location.pathname+"?"+c.a.stringify({PBR:!1,shadows:!0,postprocessing:!1})},this.lowShadowDoF=function(){window.location.href=window.location.pathname+"?"+c.a.stringify({PBR:!1,shadows:!0,postprocessing:!0})},this.high=function(){window.location.href=window.location.pathname+"?"+c.a.stringify({PBR:!0,shadows:!0,postprocessing:!0})}};bn.add(Cn,"low").name("low (default)"),bn.add(Cn,"lowShadow"),bn.add(Cn,"lowShadowDoF"),bn.add(Cn,"high"),hn.fog=new o.FogExp2(9546677,5e-4);var An=new o.Mesh(new o.SphereBufferGeometry(5,5,5),new o.MeshBasicMaterial({color:16777215}));An.visible=!1,hn.add(An);var Dn=new o.Vector3;window.sunPosition=Dn,g(hn,Dn,yn);var Mn=new o.Scene,Sn=g(Mn,(new o.Vector3).copy(Dn));!function(e,t){f.sunPosition=t,f.updatePosition=h,f.updatePosition(),f.up.set(0,0,1),f.name="sunlight",f.castShadow=!0,f.shadow.mapSize.width=f.shadow.mapSize.height=1024;var n=1024;f.shadow.camera.left=-n,f.shadow.camera.right=n,f.shadow.camera.top=n,f.shadow.camera.bottom=-n,f.shadow.camera.far=3200,f.shadow.bias=-1e-4,f.needsUpdate=!0,e.add(f),e.add(m),e.add(v)}(hn,Dn),f.target=An,hn.add(ye);var En=2e4,Pn=new o.PlaneBufferGeometry(5*En,5*En,10,10),_n=(new o.TextureLoader).setCrossOrigin("anonymous"),Tn=new zt.g(Pn,{textureWidth:512,textureHeight:512,color:16777215,flowDirection:new o.Vector2(1,1),scale:2e4/15,normalMap0:_n.load(n(39)),normalMap1:_n.load(n(40)),clipBias:1e-5,reflectivity:.2,shader:pn,flowSpeed:.1});window.water=Tn;var kn=new o.WebGLRenderTarget(window.innerWidth,window.innerHeight),zn=new o.MeshDepthMaterial;kn.depthBuffer=!0,kn.depthTexture=new o.DepthTexture,Tn.material.uniforms.tDepth.value=kn.depthTexture,Tn.up.set(0,0,1),Tn.position.z=75,Tn.material.uniforms.surface.value=Tn.position.z,yn.__folders["Sun, sky and ocean"].add(Tn.position,"z",0,200,1),Tn.receiveShadow=!0,Tn.userData.isWater=!0,window.water=Tn,hn.add(Tn);var Rn=new zt.d(Pn,{textureWidth:512,textureHeight:512,clipBias:1e-5});Rn.rotation.y=Math.PI,Rn.up.set(0,0,-1),Rn.position.copy(Tn.position),Rn.getRenderTarget().depthBuffer=!0,Rn.getRenderTarget().depthTexture=new o.DepthTexture,window.ref=Rn,Rn.updateMatrixWorld(),It(),Dt.forEach(function(e){return hn.add(e.mesh)});var Ln=!1;d.subscribe("x.camera.shake.start",function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Ln=!0}),d.subscribe("x.camera.shake.stop",function(){return Ln=!1});var Fn=[function(e){var t=gn.position;te=gn.getWorldDirection(te);var n=t.clone();if(n=n.add(te.multiplyScalar(400*Math.max(1,Math.abs(t.z)/400))),An.position.set(n.x,n.y,200),f.updatePosition(),t.distanceTo($)>10){$=t.clone();var i,a=Math.min(7,Math.floor(Math.sqrt(Math.abs(t.z))/28)),r=10-a,l=800*Math.pow(2,a),s=Math.round(n.x/l),c=-Math.round(n.y/l),u=t.z>2e3?127:255,d=t.z>2e3?31:63,p=3*l,m=new o.Vector3,v=new o.Vector3,h=new o.Vector3,g=[[r,s,c,u,0,l],[r,s,c+1,u,0,l],[r,s+1,c,u,0,l],[r,s+1,c+1,u,0,l],[r,s-1,c-1,d,0,l],[r,s-1,c-0,d,0,l],[r,s-1,c+1,d,0,l],[r,s-1,c+2,d,0,l],[r,s+2,c-1,d,0,l],[r,s+2,c-0,d,0,l],[r,s+2,c+1,d,0,l],[r,s+2,c+2,d,0,l],[r,s,c-1,d,0,l],[r,s,c+2,d,0,l],[r,s+1,c-1,d,0,l],[r,s+1,c+2,d,0,l],[r,s-2,c-2,15,0,l],[r,s-2,c-1,15,0,l],[r,s-2,c-0,15,0,l],[r,s-2,c+1,15,0,l],[r,s-2,c+2,15,0,l],[r,s-2,c+3,15,0,l],[r,s+3,c-2,15,0,l],[r,s+3,c-1,15,0,l],[r,s+3,c-0,15,0,l],[r,s+3,c+1,15,0,l],[r,s+3,c+2,15,0,l],[r,s+3,c+3,15,0,l],[r,s-1,c-2,15,0,l],[r,s-1,c+3,15,0,l],[r,s,c-2,15,0,l],[r,s,c+3,15,0,l],[r,s+1,c-2,15,0,l],[r,s+1,c+3,15,0,l],[r,s+2,c-2,15,0,l],[r,s+2,c+3,15,0,l]],x=g.map(function(e){return e.toString()}),y=ee.map(function(e){return e.toString()}),b=x.slice(0,4),C=hn.children.filter(function(e){return b.includes(e.key)}),A=function(e){return m.subVectors(e.position,gn.position).length()};C.sort(function(e,t){return A(e)-A(t)}),gn.userData.terrainKeysUnder=b,gn.userData.terrainTileUnder=C[0];var D=x.filter(function(e){return y.indexOf(e)<0}),M=hn.children.filter(function(e){return e.key}).map(function(e){return e.key});D.forEach(function(e){if(M.includes(e))console.log(e," already exists!");else{var t=e.split(",").map(function(e){return parseInt(e,10)});(function(e,t,n,o,i,a){Y.postMessage([e,t,n,o,i,a])}).apply(void 0,Object(w.a)(t))}}),hn.children.filter(function(e){return e.key}).forEach(function(e){i=m.subVectors(h.set(e.position.x,e.position.y,0),v.set(gn.position.x,gn.position.y,0)).length(),e.userData.distanceToCamera=i,i<p&&x.includes(e.key)?e.visible=!0:window.setTimeout(function(){e.visible=!1},750)}),hn.children.filter(function(e){return e.key}).sort(function(e,t){return e.userData.distanceToCamera-t.userData.distanceToCamera}).slice(128).forEach(function(e){e.markedForDeletion||(window.setTimeout(function(){return function(e){hn.remove(e),e.geometry.dispose(),e.geometry=null,e.material.dispose(),e.material=null}(e)},750),e.markedForDeletion=!0)}),ee=g.slice(0)}},function(){return ye.position.copy(Dn)},function(e,t){Dt.forEach(function(e){return e.tick(t/1e3)})},function(){Ln?(gn.position.add({x:1*(Math.random()-.5),y:1*(Math.random()-.5),z:1*(Math.random()-.5)}),Kn.enabled=!0,jn.renderToScreen=!1):(Kn.enabled=!1,jn.renderToScreen=!0)},function(e,t){gn.position.z<Tn.position.z?(Hn.enabled=!0,On.enabled=!0,Tn.visible=!1,Rn.onBeforeRender(xn,hn,gn),Hn.material.uniforms.time.value=e/1e3,On.material.uniforms.time.value=e/1e3,qt.setAcceleration(30)):(Hn.enabled=!1,On.enabled=!1,Tn.visible=!0,qt.setAcceleration(60))}];d.subscribe("x.loops.remove",function(e,t){return function(e){Fn=Fn.filter(function(t){return t!==e})}(t)}),d.subscribe("x.loops.push",function(e,t){return Fn.push(t)}),d.subscribe("x.loops.unshift",function(e,t){return Fn.unshift(t)}),window.loops=Fn,d.publish("x.loops.loaded");var Un=vn.postprocessing?ve(hn,xn,gn,yn):null,Vn=new o.WebGLRenderTarget(window.innerWidth,window.innerHeight);Vn.depthBuffer=!0,Vn.depthTexture=new o.DepthTexture;var Bn=new zt.a(xn,Vn),In=new zt.e(hn,gn);Bn.addPass(In);var Hn=new zt.f(fn);Hn.enabled=!1,Hn.material.uniforms.waterLevel.value=Tn.position.z,Hn.material.uniforms.tDepth.value=kn.depthTexture,Hn.material.uniforms.cameraPosition.value=gn.position,Hn.material.uniforms.sunPosition.value=Dn,Hn.material.uniforms.tReflectionMap.value=Rn.getRenderTarget().texture,Hn.material.uniforms.tReflectionDepth.value=Rn.getRenderTarget().depthTexture;var Nn=Hn.material.uniforms.tNormalMap0,Wn=Hn.material.uniforms.tNormalMap1;Nn.value=_n.load(n(39)),Wn.value=_n.load(n(40)),Nn.value.wrapS=Nn.value.wrapT=o.RepeatWrapping,Wn.value.wrapS=Wn.value.wrapT=o.RepeatWrapping,Bn.addPass(Hn),window.upass=Hn;var On=new zt.f({uniforms:{tDiffuse:{type:"t",value:null},time:{type:"f",value:0}},vertexShader:"\n    varying vec2 vUv;\n\n    void main() {\n\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n      vUv = uv;\n\n    }\n  ",fragmentShader:"\n    uniform float time;\n    uniform sampler2D tDiffuse;\n    varying vec2 vUv;\n\n    float frequency = 10.;\n    float amplitude = 0.005;\n\n    void main() {\n      vec2 uv = vUv;\n      float X = vUv.x * frequency + time;\n      float Y = vUv.y * frequency + time;\n      uv.y += cos(X + Y) * amplitude * cos(Y);\n      uv.x += sin(X - Y) * amplitude * sin(Y);\n      gl_FragColor = texture2D(tDiffuse, uv);\n    }\n  "});On.enabled=!1,Bn.addPass(On);var jn=new zt.f(be,"tColor");jn.renderToScreen=!0,jn.material.uniforms.tDepth.value=kn.depthTexture,jn.material.uniforms.velocityFactor.value=1,Bn.addPass(jn);var Gn=new o.Matrix4,Qn=new o.Matrix4,Zn=new o.Vector3,Yn=new o.Matrix4,Kn=new zt.c;Kn.renderToScreen=!0,Bn.addPass(Kn),xn.setPixelRatio(1);var qn=new l.a;document.body.appendChild(qn.dom);var Xn=!0;d.subscribe("x.toggle.play",function(){Xn=!Xn});var Jn=0;!function e(t){requestAnimationFrame(e);var n=t-Jn;if(Jn=t,Xn)if(Fn.forEach(function(e){e.loop?e.loop(t,n):e(t,n)}),vn.postprocessing){Tn.visible=!1,Sn.material.uniforms.sunPosition.value=Dn,wn.update(xn,Mn);var o=wn.renderTarget;Q.uniforms.envMap.value=o.texture,Un.renderDepth(),Un.composer.render()}else hn.overrideMaterial=zn,Tn.visible=!1,xn.render(hn,gn,kn),Tn.visible=!0,hn.overrideMaterial=null,jn.material.uniforms.delta.value=n,jn.material.uniforms.clipToWorldMatrix.value.getInverse(gn.matrixWorldInverse).multiply(Yn.getInverse(gn.projectionMatrix)),jn.material.uniforms.previousWorldToClipMatrix.value.copy(Qn.multiply(Gn)),jn.material.uniforms.cameraMove.value.copy(gn.position).sub(Zn),Tn.material.uniforms.clipToWorldMatrix.value=jn.material.uniforms.clipToWorldMatrix.value,Hn.material.uniforms.clipToWorldMatrix.value=jn.material.uniforms.clipToWorldMatrix.value,Hn.material.uniforms.worldToClipMatrix.value.copy(gn.projectionMatrix).multiply(gn.matrixWorldInverse),Bn.render(n),Gn.copy(gn.matrixWorldInverse),Qn.copy(gn.projectionMatrix),Zn.copy(gn.position);Fn.forEach(function(e){void 0!==e.alive&&!1===e.alive&&e.object&&hn.remove(e.object)}),Fn=Fn.filter(function(e){return void 0===e.alive||!0===e.alive}),qn.update()}(0),function(e,t,n){n=n||function(){return{width:window.innerWidth,height:window.innerHeight}};var o=function(){var o=n();e.setSize(o.width,o.height),t.aspect=o.width/o.height,t.updateProjectionMatrix(),d.publish("x.screen.resized",o)};window.addEventListener("resize",o,!1)}(xn,gn)}],[[57,1,2]]]);
//# sourceMappingURL=main.9d1df240.chunk.js.map